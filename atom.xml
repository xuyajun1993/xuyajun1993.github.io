<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è¥¿è¥¿å¼—çš„ç¥è¯</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xuyajun.cn/"/>
  <updated>2017-05-28T12:55:45.000Z</updated>
  <id>http://xuyajun.cn/</id>
  
  <author>
    <name>yajun xu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring-aop</title>
    <link href="http://xuyajun.cn/2017/05/28/Spring-aop/"/>
    <id>http://xuyajun.cn/2017/05/28/Spring-aop/</id>
    <published>2017-05-28T12:45:46.000Z</published>
    <updated>2017-05-28T12:55:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç«¯åˆèŠ‚å‡æœŸçš„ç¬¬ä¸€å¤©ï¼Œä¸€å¤§æ—©å†³å®šå¥½æ¥ä¸‹æ¥ä¸‰å¤©çš„èœè°±ï¼Œåˆ—ä¸ªèœå•ï¼Œå»è¶…å¸‚å±¯äº†ä¸‰å¤©çš„é£Ÿç²®ã€‚ä¸­åˆè¦å¥½å¥½çŠ’åŠ³è‡ªå·±ï¼ŒæŒ‰ç…§å’ŒğŸ‘¶çš„æ–°çº¦å®šï¼Œä»Šæ™š10ç‚¹å‰è¦å†™å‡ºä¸€ç¯‡æœ‰è´¨é‡çš„åšæ–‡ï¼Œä¸ç„¶å°±è¦ç»™ğŸ‘¶å‘çº¢åŒ…ã€‚æœ¬æƒ³å‘çº¢åŒ…äº†äº‹ï¼Œå‡æœŸç¬¬ä¸€å¤©è¿˜æ˜¯æƒ³èˆ’èˆ’æœæœçš„ç©ç©æ¸¸æˆï¼Œçœ‹çœ‹å¥‡è‘©è¯´ï¼Œè¿½è¿½å‰§å•¥çš„ã€‚ç„¶åˆšå¥½è¿™æœŸå¥‡è‘©è¯´æ¿€è¾©æ— ä¸Šè¿›å¿ƒæ˜¯å¦æ˜¯é”™ã€‚å¾—å˜ï¼Œæˆ‘é”™äº†ï¼ŒèƒŒä¸Šåˆšä¹°çš„å°èƒŒåŒ…ï¼Œè¸ä¸Šå›¾ä¹¦é¦†ä¹‹æ—…ã€‚ã€‚ã€‚<br><a id="more"></a></p>
<p>ä»Šå¤©æ¥çœ‹ä¸‹ AOP å§ï¼Œè™½ç„¶ Java ä¹Ÿæ¥è§¦äº†ä¸‰å¹´äº†ï¼Œä½†ä¼¼ä¹ä¸€ç›´å¿½ç•¥äº† AOPã€‚åˆ‡é¢ï¼Œé€šçŸ¥è¿™äº›åŸºæœ¬è¦ç´ ä¹Ÿéƒ½å¿˜çš„å·®ä¸å¤šäº†ã€‚ä»Šå¤©æ¥æ›´æ·±åˆ»çš„è®¤è¯†ä¸€ä¸‹å§ã€‚</p>
<h2 id="æœ¯è¯­é‡æ¸©"><a href="#æœ¯è¯­é‡æ¸©" class="headerlink" title="æœ¯è¯­é‡æ¸©"></a>æœ¯è¯­é‡æ¸©</h2><p>å…ˆæ¥é€šè¿‡<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#aop" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>é‡æ¸©ä¸€ä¸‹å‡ ä¸ª AOP æœ¯è¯­ï¼š</p>
<ol>
<li>åˆ‡é¢ï¼ˆAspectï¼‰ï¼šä¸€ä¸ªæ¨ªå‘é€»è¾‘çš„æ¨¡å—ï¼Œå®ƒä¼šåŒ…æ‹¬åˆ‡å…¥ç‚¹ï¼Œé€šçŸ¥ç­‰ä¸‹é¢çš„æœ¯è¯­ã€‚</li>
<li>è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰ï¼šç¨‹åºæ‰§è¡ŒæœŸé—´çš„ä¸€ä¸ªç‚¹,å¦‚ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œæˆ–å¼‚å¸¸çš„å¤„ç†ã€‚åœ¨Spring AOP,è¿æ¥ç‚¹æ€»æ˜¯ä»£è¡¨ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œã€‚</li>
<li>é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šåˆ‡é¢åœ¨æŸä¸ªå…·ä½“çš„è¿æ¥ç‚¹é‡‡å–çš„è¡Œä¸ºæˆ–è¡ŒåŠ¨ï¼Œç§°ä¸ºé€šçŸ¥ã€‚åˆ†ä¸ºå‰ç½®é€šçŸ¥ï¼Œè¿”å›é€šçŸ¥ï¼Œå¼‚å¸¸é€šçŸ¥ï¼Œåç½®é€šçŸ¥ï¼Œç¯ç»•é€šçŸ¥ã€‚</li>
<li>åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰ï¼šè¦ç»‡å…¥é€šçŸ¥çš„æ‰€æœ‰è¿æ¥ç‚¹çš„é›†åˆã€‚</li>
<li>å¼•å…¥ï¼ˆIntroductionï¼‰ï¼šé€šè¿‡å¼•å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­åŠ å…¥æ–°çš„æ–¹æ³•å’Œå±æ€§ï¼Œè€Œä¸ç”¨ä¿®æ”¹å®ƒçš„ç¨‹åºï¼Œå³åœ¨æ‰§è¡Œæ—¶æœŸåŠ¨æ€åŠ å…¥ä¸€äº›æ–¹æ³•æˆ–è¡Œä¸ºã€‚</li>
<li>ç›®æ ‡å¯¹è±¡ï¼ˆTarget objectï¼‰ï¼šè¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢é€šçŸ¥çš„å¯¹è±¡ã€‚å› ä¸º Spring AOP æ˜¯é€šè¿‡è¿è¡Œæ—¶ä»£ç†å®ç°çš„ï¼Œè¿™ä¸ªå¯¹è±¡æ°¸è¿œæ˜¯ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ã€‚</li>
<li>ä»£ç†ï¼ˆAOP proxyï¼‰ï¼šç”± AOP æ¡†æ¶åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨æ¥å®ç°åˆ‡é¢å¥‘çº¦ï¼ˆåŒ…æ‹¬é€šçŸ¥æ–¹æ³•æ‰§è¡Œç­‰åŠŸèƒ½ï¼‰ã€‚ åœ¨ Spring ä¸­ï¼ŒAOP ä»£ç†å¯ä»¥æ˜¯ JDK åŠ¨æ€ä»£ç†æˆ–è€… CGLIB ä»£ç†ã€‚</li>
<li>ç»‡å…¥ï¼ˆWeavingï¼‰ï¼šæŠŠåˆ‡é¢è¿æ¥åˆ°å…¶å®ƒå¯¹è±¡ä¸Šï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¢«é€šçŸ¥çš„å¯¹è±¡ï¼Œè¿™æ ·çš„è¡Œä¸ºå°±å«åšç»‡å…¥ã€‚å¯ä»¥åœ¨ç¼–è¯‘æ—¶ï¼ˆä½¿ç”¨ AspectJï¼‰ï¼Œç±»åŠ è½½æ—¶å’Œè¿è¡Œæ—¶å®Œæˆã€‚ Spring å’Œå…¶ä»–çº¯ Java AOP æ¡†æ¶ä¸€æ ·ï¼Œåœ¨è¿è¡Œæ—¶å®Œæˆç»‡å…¥ ã€‚</li>
</ol>
<p>ç¡®å®ï¼Œè¿™äº›æœ¯è¯­ä¸å¤ªç›´è§‚ï¼Œéœ€è¦ä»”ç»†æ¨æ•²åŠ ä¸Šä»£ç  demo æ‰èƒ½ç†è§£ã€‚è¦æƒ³ once for all ï¼Œè¿˜æ˜¯å¾—ç²—æš´çš„è¿›å…¥æºç ã€‚æ¥ï¼Œä¸€èµ·ã€‚</p>
<h2 id="æºç çª¥æ¢"><a href="#æºç çª¥æ¢" class="headerlink" title="æºç çª¥æ¢"></a>æºç çª¥æ¢</h2><p>ä»å“ªçœ‹èµ·å‘¢ï¼Œä¹‹å‰éƒ½æ˜¯è‡ªå·±è‚‰çœ¼å…ˆæ‰«æä¸‹æ¯ä¸ªç±»ï¼Œæ¥å¼ºè¡Œæ¢³ç†å‡ºä¸€ä¸ªé€»è¾‘ã€‚ä½† AOP ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œé‚£ä¹ˆå¤šä¸ª class æ–‡ä»¶ï¼Œè¿˜è¿™æ ·åšï¼Œæœªå…å¤ªä½æ•ˆã€‚å·®ç‚¹å¿˜è®°æœ‰ã€Š spring æºç æ·±åº¦è§£æã€‹è¿™æœ¬ä¹¦ï¼Œå­¦ä¹ ä¸‹ä½œè€…çš„æ€è·¯ã€‚æ¥ï¼Œä»¥ \<aop:aspectj-autoproxy> è¿™å¥é…ç½®ä½œä¸ºå…¥å£ã€‚<br>å…¨å±€æœç´¢ä¸‹ aspectj-autoproxy ï¼Œæ‰¾åˆ°è¿™ä¸ªé…ç½®çš„è§£æå™¨ã€‚ä¸éš¾å‘ç° AopNamespaceHandler è¿™ä¸ªç±»ã€‚çœ‹è¿™è¡Œä»£ç ç»§ç»­æº¯æºï¼š</aop:aspectj-autoproxy></p>
<blockquote>
<pre><code>registerBeanDefinitionParser(&quot;aspectj-autoproxy&quot;, new AspectJAutoProxyBeanDefinitionParser());
</code></pre></blockquote>
<p>OKï¼Œå…ˆæ¥åˆ†æ AspectJAutoProxyBeanDefinitionParser è¿™ä¸ªç±»åšäº†äº›ä»€ä¹ˆã€‚</p>
<h3 id="AspectJAutoProxyBeanDefinitionParser"><a href="#AspectJAutoProxyBeanDefinitionParser" class="headerlink" title="AspectJAutoProxyBeanDefinitionParser"></a>AspectJAutoProxyBeanDefinitionParser</h3><p>æ‰€æœ‰è§£æå™¨éƒ½å®ç°äº† BeanDefinitionParser æ¥å£ï¼Œå…¥å£æ–¹æ³•parser() ï¼Œè€Œè¯¥æ–¹æ³•ç»§ç»­è°ƒç”¨äº† registerAspectJAnnotationAutoProxyCreatorIfNecessaryï¼ˆï¼‰æ–¹æ³•ï¼Œè´´ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code>public static void registerAspectJAnnotationAutoProxyCreatorIfNecessary(
        ParserContext parserContext, Element sourceElement) {

    BeanDefinition beanDefinition = AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(
            parserContext.getRegistry(), parserContext.extractSource(sourceElement));
    useClassProxyingIfNecessary(parserContext.getRegistry(), sourceElement);
    registerComponentIfNecessary(beanDefinition, parserContext);
}
</code></pre><p>ä¸€å…±ä¸‰è¡Œï¼Œæ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªé€»è¾‘ã€‚</p>
<ol>
<li><p>æ³¨å†Œæˆ–è€…å‡çº§ AnnotationAwareAspectJAutoProxyCreator</p>
<p> ç»§ç»­è´´ä¸‹ä¸€æ­¥çš„ä»£ç   </p>
<pre><code>public static BeanDefinition registerAspectJAnnotationAutoProxyCreatorIfNecessary(BeanDefinitionRegistry registry, Object source) {
    return registerOrEscalateApcAsRequired(AnnotationAwareAspectJAutoProxyCreator.class, registry, source);
}

private static BeanDefinition registerOrEscalateApcAsRequired(Class cls, BeanDefinitionRegistry registry, Object source) {
    Assert.notNull(registry, &quot;BeanDefinitionRegistry must not be null&quot;);
    if (registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)) {
    BeanDefinition apcDefinition = registry.getBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME);
    if (!cls.getName().equals(apcDefinition.getBeanClassName())) {
        int currentPriority = findPriorityForClass(apcDefinition.getBeanClassName());
        int requiredPriority = findPriorityForClass(cls);
        if (currentPriority &lt; requiredPriority) {
            apcDefinition.setBeanClassName(cls.getName());
        }
    }
    return null;
    }
    RootBeanDefinition beanDefinition = new RootBeanDefinition(cls);
    beanDefinition.setSource(source);
    beanDefinition.getPropertyValues().add(&quot;order&quot;, Ordered.HIGHEST_PRECEDENCE);
    beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);
    registry.registerBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME, beanDefinition);
    return beanDefinition;
}
</code></pre></li>
</ol>
<pre><code>å¦‚æœå·²ç»æœ‰äº†è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ï¼Œåˆ™é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„åˆ›å»ºå™¨ã€‚è‡³äºè¿™ä¸ªè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ï¼Œåœ¨æ¸©ä¹ å‡ ä¸ªæœ¯è¯­çš„æ—¶å€™å·²ç»çŸ¥é“ï¼Œè¦æƒ³å¯¹ä¸€ä¸ªç±»è¿›è¡ŒåŠŸèƒ½å¢å¼ºï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œå› ä¸º spring æœ¬èº«å°±æ˜¯åŸºäºä»£ç†çš„ç³»ç»Ÿï¼Œæ‰€ä»¥ AOP çš„åŠŸèƒ½å°±æ˜¯ä»£ç†ä¸­çš„ä»£ç†å»åˆ›å»ºç±»ã€‚ã€‚ã€‚
</code></pre><ol>
<li><p>å¤„ç† proxy-target-class å’Œ expose-proxy å±æ€§</p>
<pre><code>private static void useClassProxyingIfNecessary(BeanDefinitionRegistry registry, Element sourceElement) {
    if (sourceElement != null) {
        boolean proxyTargetClass = Boolean.valueOf(sourceElement.getAttribute(PROXY_TARGET_CLASS_ATTRIBUTE));
        if (proxyTargetClass) {
            AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);
        }
        boolean exposeProxy = Boolean.valueOf(sourceElement.getAttribute(EXPOSE_PROXY_ATTRIBUTE));
        if (exposeProxy) {
            AopConfigUtils.forceAutoProxyCreatorToExposeProxy(registry);
        }
    }
}
</code></pre><p> å¦‚æœ proxy-target-class è®¾ç½®ä¸º trueï¼Œåˆ™å¼ºåˆ¶ä½¿ç”¨ cglib ä»£ç†ã€‚å¦‚æœ expose-proxy è®¾ç½®ä¸º trueï¼Œåˆ™æ”¯æŒç›®æ ‡å¯¹è±¡å†…éƒ¨çš„è‡ªæˆ‘æ–¹æ³•è°ƒç”¨ä¹Ÿèƒ½å¢å¼ºã€‚ï¼ˆä¸Šé¢è¯´äº†ï¼Œç±»åŠŸèƒ½çš„å¢å¼ºæ˜¯é€šè¿‡ä»£ç†ç±»ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨å†…éƒ¨çš„æ–¹æ³•ï¼Œåˆ™èµ°çš„ä¸æ˜¯ä»£ç†ï¼Œé€ æˆæ–¹æ³•å¢å¼ºå¤±æ•ˆï¼è¿™å—å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ä¸­å…³äº AOP ä»£ç†è¿™ä¸€å°èŠ‚ï¼‰ </p>
</li>
<li><p>æ³¨å†Œç»„å»ºé€šçŸ¥ï¼ˆå…·ä½“ä¸è¯¦ç©¶ï¼‰</p>
</li>
</ol>
<h3 id="AspectJAwareAdvisorAutoProxyCreator"><a href="#AspectJAwareAdvisorAutoProxyCreator" class="headerlink" title="AspectJAwareAdvisorAutoProxyCreator"></a>AspectJAwareAdvisorAutoProxyCreator</h3><p>ä¸Šé¢è¯´åˆ°æ‰“å¼€äº† AOP é…ç½®çš„å¼€å…³åï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯åˆ›å»ºè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ã€‚ä¸‹é¢å°±æ¥çœ‹çœ‹è¿™ä¸ªåˆ›å»ºå™¨æ˜¯æ€ä¹ˆæ‰«æ aop æ³¨è§£å¹¶åˆ›å»ºä»£ç†å¢å¼ºç±»çš„åŠŸèƒ½çš„ï¼ˆé«˜èƒ½é¢„è­¦ï¼Œä¸‹é¢æ˜¯ä¸€æ®µæ¼«é•¿çš„è¿½å¯»ä¹‹è·¯ï¼‰ã€‚<br>AspectJAwareAdvisorAutoProxyCreator ç»§æ‰¿äº† BeanPostProcessorï¼Œæ‰€ä»¥ä»¥ postProcessAfterInitialization è¿™ä¸ªæ–¹æ³•ä¸ºå…¥å£ã€‚</p>
<pre><code>public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
    if (bean != null) {
        Object cacheKey = getCacheKey(bean.getClass(), beanName);
        if (!this.earlyProxyReferences.containsKey(cacheKey)) {
            return wrapIfNecessary(bean, beanName, cacheKey);
        }
    }
    return bean;
}
</code></pre><p>å¦‚æœæ²¡æœ‰å°è£…è¿‡ï¼Œåˆ™å°è£…è¿™ä¸ª beanã€‚</p>
<pre><code>protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {
    if (beanName != null &amp;&amp; this.targetSourcedBeans.containsKey(beanName)) {
        return bean;
    }
    if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) {
        return bean;
    }
    if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) {
        this.advisedBeans.put(cacheKey, Boolean.FALSE);
        return bean;
    }

    // Create proxy if we have advice.
    Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);
    if (specificInterceptors != DO_NOT_PROXY) {
        this.advisedBeans.put(cacheKey, Boolean.TRUE);
        Object proxy = createProxy(bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));
        this.proxyTypes.put(cacheKey, proxy.getClass());
        return proxy;
    }

    this.advisedBeans.put(cacheKey, Boolean.FALSE);
    return bean;
}
</code></pre><p>å¦‚æœä¸æ˜¯ AOP çš„åŸºç¡€ç±»ï¼Œåˆ™äºˆä»¥ä»£ç†ã€‚ä¼¼ä¹åˆ°æ­¤ç»“æŸï¼Œæ¯•ç«Ÿçœ‹åˆ°äº†ä¸ºéœ€è¦çš„æ–¹æ³•åˆ›å»ºä»£ç†æˆ‘ä»¬å°±æ”¾å¿ƒäº†ã€‚åˆ«æ€¥ï¼Œé‡ç‚¹åœ¨äºæ€ä¹ˆè·å–éœ€è¦å¢å¼ºçš„æ–¹æ³•ã€‚</p>
<pre><code>protected Object[] getAdvicesAndAdvisorsForBean(Class beanClass, String beanName, TargetSource targetSource) {
    List advisors = findEligibleAdvisors(beanClass, beanName);
    if (advisors.isEmpty()) {
        return DO_NOT_PROXY;
    }
    return advisors.toArray();
}
</code></pre><p>ç»§ç»­è¿½ findEligibleAdvisorsï¼ˆï¼‰ã€‚</p>
<pre><code>protected List&lt;Advisor&gt; findEligibleAdvisors(Class beanClass, String beanName) {
    List&lt;Advisor&gt; candidateAdvisors = findCandidateAdvisors();
    List&lt;Advisor&gt; eligibleAdvisors = findAdvisorsThatCanApply(candidateAdvisors, beanClass, beanName);
    extendAdvisors(eligibleAdvisors);
    if (!eligibleAdvisors.isEmpty()) {
        eligibleAdvisors = sortAdvisors(eligibleAdvisors);
    }
    return eligibleAdvisors;
}
</code></pre><ol>
<li><p>é¦–å…ˆè·å–å€™é€‰çš„å¢å¼ºå™¨</p>
<pre><code>public List&lt;Advisor&gt; findAdvisorBeans() {
    // Determine list of advisor bean names, if not cached already.
    String[] advisorNames = null;
    synchronized (this) {
        advisorNames = this.cachedAdvisorBeanNames;
        if (advisorNames == null) {
            // Do not initialize FactoryBeans here: We need to leave all regular beans
            // uninitialized to let the auto-proxy creator apply to them!
            advisorNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(
                    this.beanFactory, Advisor.class, true, false);
            this.cachedAdvisorBeanNames = advisorNames;
        }
    }
    if (advisorNames.length == 0) {
        return new LinkedList&lt;Advisor&gt;();
    }

    List&lt;Advisor&gt; advisors = new LinkedList&lt;Advisor&gt;();
    for (String name : advisorNames) {
        if (isEligibleBean(name)) {
            if (this.beanFactory.isCurrentlyInCreation(name)) {
                if (logger.isDebugEnabled()) {
                    logger.debug(&quot;Skipping currently created advisor &apos;&quot; + name + &quot;&apos;&quot;);
                }
            }
            else {
                try {
                    advisors.add(this.beanFactory.getBean(name, Advisor.class));
                }
                catch (BeanCreationException ex) {
                    Throwable rootCause = ex.getMostSpecificCause();
                    if (rootCause instanceof BeanCurrentlyInCreationException) {
                        BeanCreationException bce = (BeanCreationException) rootCause;
                        if (this.beanFactory.isCurrentlyInCreation(bce.getBeanName())) {
                            if (logger.isDebugEnabled()) {
                                logger.debug(&quot;Skipping advisor &apos;&quot; + name +
                                        &quot;&apos; with dependency on currently created bean: &quot; + ex.getMessage());
                            }
                            // Ignore: indicates a reference back to the bean we&apos;re trying to advise.
                            // We want to find advisors other than the currently created bean itself.
                            continue;
                        }
                    }
                    throw ex;
                }
            }
        }
    }
    return advisors;
}
</code></pre></li>
<li><p>ç­›é€‰å‡ºé€‚ç”¨äº bean çš„å¢å¼ºå™¨</p>
<pre><code>public static List&lt;Advisor&gt; findAdvisorsThatCanApply(List&lt;Advisor&gt; candidateAdvisors, Class&lt;?&gt; clazz) {
    if (candidateAdvisors.isEmpty()) {
        return candidateAdvisors;
    }
    List&lt;Advisor&gt; eligibleAdvisors = new LinkedList&lt;Advisor&gt;();
    for (Advisor candidate : candidateAdvisors) {
        if (candidate instanceof IntroductionAdvisor &amp;&amp; canApply(candidate, clazz)) {
            eligibleAdvisors.add(candidate);
        }
    }
    boolean hasIntroductions = !eligibleAdvisors.isEmpty();
    for (Advisor candidate : candidateAdvisors) {
        if (candidate instanceof IntroductionAdvisor) {
            // already processed
            continue;
        }
        if (canApply(candidate, clazz, hasIntroductions)) {
            eligibleAdvisors.add(candidate);
        }
    }
    return eligibleAdvisors;
}
</code></pre><p> é¦–å…ˆå¤„ç†å¼•å…¥å¢å¼ºï¼Œç„¶åå¤„ç†å…¶ä»–çš„ã€‚æœ€ç»ˆçš„åŒ¹é…åœ¨ä¸‹é¢æ–¹æ³•ä¸­å¤„ç†ã€‚</p>
<pre><code>    public static boolean canApply(Pointcut pc, Class&lt;?&gt; targetClass, boolean hasIntroductions) {
    Assert.notNull(pc, &quot;Pointcut must not be null&quot;);
    if (!pc.getClassFilter().matches(targetClass)) {
        return false;
    }

    MethodMatcher methodMatcher = pc.getMethodMatcher();
    IntroductionAwareMethodMatcher introductionAwareMethodMatcher = null;
    if (methodMatcher instanceof IntroductionAwareMethodMatcher) {
        introductionAwareMethodMatcher = (IntroductionAwareMethodMatcher) methodMatcher;
    }

    Set&lt;Class&gt; classes = new LinkedHashSet&lt;Class&gt;(ClassUtils.getAllInterfacesForClassAsSet(targetClass));
    classes.add(targetClass);
    for (Class&lt;?&gt; clazz : classes) {
        Method[] methods = clazz.getMethods();
        for (Method method : methods) {
            if ((introductionAwareMethodMatcher != null &amp;&amp;
                    introductionAwareMethodMatcher.matches(method, targetClass, hasIntroductions)) ||
                    methodMatcher.matches(method, targetClass)) {
                return true;
            }
        }
    }

    return false;
}
</code></pre></li>
<li><p>åˆ›å»ºä»£ç†</p>
<pre><code>protected Object createProxy(
        Class&lt;?&gt; beanClass, String beanName, Object[] specificInterceptors, TargetSource targetSource) {

    ProxyFactory proxyFactory = new ProxyFactory();
    // Copy our properties (proxyTargetClass etc) inherited from ProxyConfig.
    proxyFactory.copyFrom(this);

    if (!shouldProxyTargetClass(beanClass, beanName)) {
        // Must allow for introductions; can&apos;t just set interfaces to
        // the target&apos;s interfaces only.
        Class&lt;?&gt;[] targetInterfaces = ClassUtils.getAllInterfacesForClass(beanClass, this.proxyClassLoader);
        for (Class&lt;?&gt; targetInterface : targetInterfaces) {
            proxyFactory.addInterface(targetInterface);
        }
    }

    Advisor[] advisors = buildAdvisors(beanName, specificInterceptors);
    for (Advisor advisor : advisors) {
        proxyFactory.addAdvisor(advisor);
    }

    proxyFactory.setTargetSource(targetSource);
    customizeProxyFactory(proxyFactory);

    proxyFactory.setFrozen(this.freezeProxy);
    if (advisorsPreFiltered()) {
        proxyFactory.setPreFiltered(true);
    }

    return proxyFactory.getProxy(this.proxyClassLoader);
}
</code></pre><p> åˆ°è¿™é‡Œä¼¼ä¹æœ‰ç‚¹ç†Ÿæ‚‰çš„ä»£ç†ä»£ç çš„å½±å­äº†ã€‚</p>
<ul>
<li>æ·»åŠ å½“å‰ç±»çš„å±æ€§</li>
<li>æ‰«æç±»çš„æ‰€æœ‰æ¥å£ï¼Œæ·»åŠ è¿›ä»£ç†</li>
<li>å°è£…å¢å¼ºå™¨åŠ å…¥ä»£ç†</li>
<li>è®¾ç½®è¦ä»£ç†çš„ç±»</li>
<li>å®šåˆ¶åŒ–</li>
<li><p>è¿”å›ä»£ç†ç±»</p>
<p>åœ¨æœ€åä¸€æ­¥è¿”å›ä»£ç†ç±»ï¼Œä¼šé¦–å…ˆåˆ¤æ–­é€‰æ‹©ä»£ç†æ–¹å¼ï¼Œæœ‰ä¸¤ç§å®ç°ï¼Œåˆ†åˆ«æ˜¯ jdk åŠ¨æ€ä»£ç†æˆ–è€… cglibã€‚ç›´æ¥æŠŠä»£ç†è´´å‡ºæ¥å§ï¼š</p>
<p>  public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {</p>
<pre><code>    if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {
        Class targetClass = config.getTargetClass();
        if (targetClass == null) {
            throw new AopConfigException(&quot;TargetSource cannot determine target class: &quot; +
                    &quot;Either an interface or a target is required for proxy creation.&quot;);
        }
        if (targetClass.isInterface()) {
            return new JdkDynamicAopProxy(config);
        }
        return CglibProxyFactory.createCglibProxy(config);
    }
    else {
        return new JdkDynamicAopProxy(config);
    }
}
</code></pre></li>
</ul>
<p>jdk åŠ¨æ€ä»£ç†åˆ›å»ºå¯¹è±¡çš„å®ç°ï¼š</p>
<pre><code> public Object getProxy(ClassLoader classLoader) {
    if (logger.isDebugEnabled()) {
        logger.debug(&quot;Creating JDK dynamic proxy: target source is &quot; + this.advised.getTargetSource());
    }
    Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(this.advised);
    findDefinedEqualsAndHashCodeMethods(proxiedInterfaces);
    return Proxy.newProxyInstance(classLoader, proxiedInterfaces, this);
}
</code></pre><p> cglib ä»£ç†åˆ›å»ºå¯¹è±¡çš„å®ç°ï¼š</p>
<pre><code>public Object getProxy(ClassLoader classLoader) {
    if (logger.isDebugEnabled()) {
        logger.debug(&quot;Creating CGLIB proxy: target source is &quot; + this.advised.getTargetSource());
    }

    try {
        Class&lt;?&gt; rootClass = this.advised.getTargetClass();
        Assert.state(rootClass != null, &quot;Target class must be available for creating a CGLIB proxy&quot;);

        Class&lt;?&gt; proxySuperClass = rootClass;
        if (ClassUtils.isCglibProxyClass(rootClass)) {
            proxySuperClass = rootClass.getSuperclass();
            Class&lt;?&gt;[] additionalInterfaces = rootClass.getInterfaces();
            for (Class&lt;?&gt; additionalInterface : additionalInterfaces) {
                this.advised.addInterface(additionalInterface);
            }
        }

        // Validate the class, writing log messages as necessary.
        validateClassIfNecessary(proxySuperClass);

        // Configure CGLIB Enhancer...
        Enhancer enhancer = createEnhancer();
        if (classLoader != null) {
            enhancer.setClassLoader(classLoader);
            if (classLoader instanceof SmartClassLoader &amp;&amp;
                    ((SmartClassLoader) classLoader).isClassReloadable(proxySuperClass)) {
                enhancer.setUseCache(false);
            }
        }
        enhancer.setSuperclass(proxySuperClass);
        enhancer.setInterfaces(AopProxyUtils.completeProxiedInterfaces(this.advised));
        enhancer.setNamingPolicy(SpringNamingPolicy.INSTANCE);
        enhancer.setStrategy(new MemorySafeUndeclaredThrowableStrategy(UndeclaredThrowableException.class));
        enhancer.setInterceptDuringConstruction(false);

        Callback[] callbacks = getCallbacks(rootClass);
        Class&lt;?&gt;[] types = new Class&lt;?&gt;[callbacks.length];
        for (int x = 0; x &lt; types.length; x++) {
            types[x] = callbacks[x].getClass();
        }
        enhancer.setCallbackFilter(new ProxyCallbackFilter(
                this.advised.getConfigurationOnlyCopy(), this.fixedInterceptorMap, this.fixedInterceptorOffset));
        enhancer.setCallbackTypes(types);
        enhancer.setCallbacks(callbacks);

        // Generate the proxy class and create a proxy instance.
        Object proxy;
        if (this.constructorArgs != null) {
            proxy = enhancer.create(this.constructorArgTypes, this.constructorArgs);
        }
        else {
            proxy = enhancer.create();
        }

        return proxy;
    }
    catch (CodeGenerationException ex) {
        throw new AopConfigException(&quot;Could not generate CGLIB subclass of class [&quot; +
                this.advised.getTargetClass() + &quot;]: &quot; +
                &quot;Common causes of this problem include using a final class or a non-visible class&quot;,
                ex);
    }
    catch (IllegalArgumentException ex) {
        throw new AopConfigException(&quot;Could not generate CGLIB subclass of class [&quot; +
                this.advised.getTargetClass() + &quot;]: &quot; +
                &quot;Common causes of this problem include using a final class or a non-visible class&quot;,
                ex);
    }
    catch (Exception ex) {
        // TargetSource.getTarget() failed
        throw new AopConfigException(&quot;Unexpected AOP exception&quot;, ex);
    }
}
</code></pre></li>
</ol>
<p>ä¸çŸ¥ä¸è§‰å·²åˆ°å‚æ™šï¼Œè·Ÿç€ä¹¦èµ°äº†ä¸€éæºç ï¼Œç„¶è€Œè¿˜æ˜¯å¾ˆåƒåŠ›ï¼Œä¸€äº›ç»†èŠ‚è¿˜æ˜¯ä¸èƒ½å‡†ç¡®åˆ†æã€‚å½“ç„¶ï¼Œä¹Ÿæ²¡å¿…è¦æ·±ç©¶åˆ°æ¯ä¸€è¡Œä»£ç ï¼Œaop çš„æ„æˆï¼Œä»£ç†çš„é€‰æ‹©ç­‰ä¸»å¹²è·¯èµ°è¿‡å°±è¡Œã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç«¯åˆèŠ‚å‡æœŸçš„ç¬¬ä¸€å¤©ï¼Œä¸€å¤§æ—©å†³å®šå¥½æ¥ä¸‹æ¥ä¸‰å¤©çš„èœè°±ï¼Œåˆ—ä¸ªèœå•ï¼Œå»è¶…å¸‚å±¯äº†ä¸‰å¤©çš„é£Ÿç²®ã€‚ä¸­åˆè¦å¥½å¥½çŠ’åŠ³è‡ªå·±ï¼ŒæŒ‰ç…§å’ŒğŸ‘¶çš„æ–°çº¦å®šï¼Œä»Šæ™š10ç‚¹å‰è¦å†™å‡ºä¸€ç¯‡æœ‰è´¨é‡çš„åšæ–‡ï¼Œä¸ç„¶å°±è¦ç»™ğŸ‘¶å‘çº¢åŒ…ã€‚æœ¬æƒ³å‘çº¢åŒ…äº†äº‹ï¼Œå‡æœŸç¬¬ä¸€å¤©è¿˜æ˜¯æƒ³èˆ’èˆ’æœæœçš„ç©ç©æ¸¸æˆï¼Œçœ‹çœ‹å¥‡è‘©è¯´ï¼Œè¿½è¿½å‰§å•¥çš„ã€‚ç„¶åˆšå¥½è¿™æœŸå¥‡è‘©è¯´æ¿€è¾©æ— ä¸Šè¿›å¿ƒæ˜¯å¦æ˜¯é”™ã€‚å¾—å˜ï¼Œæˆ‘é”™äº†ï¼ŒèƒŒä¸Šåˆšä¹°çš„å°èƒŒåŒ…ï¼Œè¸ä¸Šå›¾ä¹¦é¦†ä¹‹æ—…ã€‚ã€‚ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Springæºç " scheme="http://xuyajun.cn/categories/Spring%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-contextï¼ˆscheduleï¼‰</title>
    <link href="http://xuyajun.cn/2017/05/16/Spring-context%EF%BC%88schedule%EF%BC%89/"/>
    <id>http://xuyajun.cn/2017/05/16/Spring-contextï¼ˆscheduleï¼‰/</id>
    <published>2017-05-16T15:19:02.000Z</published>
    <updated>2017-05-21T07:33:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>schedule task åœ¨å·¥ä½œåœºæ™¯ä¸­åº”è¯¥æ˜¯éœ€è¦é¢‘ç¹ä½¿ç”¨çš„ã€‚å®ç°æ–¹å¼ä¹Ÿå¾ˆå¤šï¼Œå¸¸è§çš„å½“å± spring è‡ªå¸¦çš„æ³¨è§£å®ç°ä»¥åŠ quartz æ¡†æ¶ã€‚è‡³äºåº•å±‚åŸç†ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¿…ä¸å¯å°‘ã€‚ä»Šå¤©å°±æ¥æ­å¼€ spring æ˜¯å¦‚ä½•å¯¹ä»»åŠ¡è°ƒåº¦è¿›è¡ŒæŠ½è±¡ã€‚ <a id="more"></a><br>ä¸ºäº†åŠ å¿«ç†è§£æºç çš„é€Ÿåº¦ï¼Œå…ˆæµè§ˆä¸‹ schedule æ¨¡å—çš„<a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#scheduling" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚çœ‹å®Œè¯¥æ¨¡å—çš„ overview åä¼šå‘ç°ï¼Œè®¾è®¡çš„æ€æƒ³ä¸ç¼“å­˜å¦‚å‡ºä¸€è¾™ã€‚å°±è¿ package éƒ½åŸºæœ¬ç±»ä¼¼ï¼š<br><img src="/images/schedule.png" alt="alt text">  </p>
<h2 id="Trigger"><a href="#Trigger" class="headerlink" title="Trigger"></a>Trigger</h2><p>Trigger è´Ÿè´£æ ¹æ®ä¸Šæ¬¡æ‰§è¡Œç»“æœæ¥å†³å®šä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œæ•…æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼š </p>
<pre><code>Date nextExecutionTime(TriggerContext triggerContext);
</code></pre><p>TriggerContext ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå°è£…äº†ä¸Šæ¬¡æ‰§è¡Œçš„ç»“æœä¿¡æ¯ï¼š</p>
<pre><code>Date lastScheduledExecutionTime();//ä¸Šæ¬¡è®¡åˆ’æ‰§è¡Œæ—¶é—´
Date lastActualExecutionTime();//ä¸Šæ¬¡å®é™…æ‰§è¡Œæ—¶é—´
Date lastCompletionTime();//ä¸Šæ¬¡å®Œæˆæ—¶é—´
</code></pre><p>trigger æœ‰ä¸¤ä¸ªå­ç±»ï¼ŒCronTrigger å’Œ PeriodicTriggerã€‚å…ˆæ¥çœ‹ CronTriggerã€‚  </p>
<h3 id="CronTrigger"><a href="#CronTrigger" class="headerlink" title="CronTrigger"></a>CronTrigger</h3><p>CronTrigger åŸºäº cron è¡¨è¾¾å¼æ¥è°ƒåº¦ä»»åŠ¡ã€‚</p>
<pre><code>private final CronSequenceGenerator sequenceGenerator;

public Date nextExecutionTime(TriggerContext triggerContext) {
        Date date = triggerContext.lastCompletionTime();
        if (date != null) {
            Date scheduled = triggerContext.lastScheduledExecutionTime();
            if (scheduled != null &amp;&amp; date.before(scheduled)) {
                // Previous task apparently executed too early...
                // Let&apos;s simply use the last calculated execution time then,
                // in order to prevent accidental re-fires in the same second.
                date = scheduled;
            }
        }
        else {
            date = new Date();
        }
        return this.sequenceGenerator.next(date);
    }
</code></pre><p>å¾ˆæ˜¾ç„¶ï¼ŒCronSequenceGenerator è¿™ä¸ªç±»è´Ÿè´£è§£æ cron è¡¨è¾¾å¼åŠç¡®å®šä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ã€‚ è®©æˆ‘ä»¬åç¦»ä¸»é“ï¼Œçœ‹ä¸‹è¿™ä¸ªç±»ï¼Œå¾ˆæ¶¨å§¿åŠ¿ã€‚</p>
<h4 id="CronSequenceGenerator"><a href="#CronSequenceGenerator" class="headerlink" title="CronSequenceGenerator"></a>CronSequenceGenerator</h4><p>å…ˆçœ‹çœ‹ â€œ0 0 \<em> \</em> \<em> \</em>â€ è¿™ç§è¡¨è¾¾å¼æ˜¯å¦‚ä½•è¢«è§£æ</p>
<pre><code>private void parse(String expression) throws IllegalArgumentException {
    String[] fields = StringUtils.tokenizeToStringArray(expression, &quot; &quot;);
    if (fields.length != 6) {
        throw new IllegalArgumentException(String.format(
                &quot;Cron expression must consist of 6 fields (found %d in \&quot;%s\&quot;)&quot;, fields.length, expression));
    }
    setNumberHits(this.seconds, fields[0], 0, 60);
    setNumberHits(this.minutes, fields[1], 0, 60);
    setNumberHits(this.hours, fields[2], 0, 24);
    setDaysOfMonth(this.daysOfMonth, fields[3]);
    setMonths(this.months, fields[4]);
    setDays(this.daysOfWeek, replaceOrdinals(fields[5], &quot;SUN,MON,TUE,WED,THU,FRI,SAT&quot;), 8);
    if (this.daysOfWeek.get(7)) {
        // Sunday can be represented as 0 or 7
        this.daysOfWeek.set(0);
        this.daysOfWeek.clear(7);
    }
}
</code></pre><p>è¯¥ç±»ä½¿ç”¨äº† BitSet æ¥å­˜å‚¨ç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼ˆå¤§å®¶éƒ½çŸ¥é“å­˜å‚¨å¤§æ•°æ®é‡æ—¶å¯ä»¥ä½¿ç”¨ bit-map ç®—æ³•ï¼Œæ²¡æƒ³åˆ° java å®ç°äº†ï¼‰ï¼Œç»§ç»­è¿›å…¥ setNumberHits æ–¹æ³•ã€‚</p>
<pre><code>private void setNumberHits(BitSet bits, String value, int min, int max) {
    String[] fields = StringUtils.delimitedListToStringArray(value, &quot;,&quot;);
    for (String field : fields) {
        if (!field.contains(&quot;/&quot;)) {
            // Not an incrementer so it must be a range (possibly empty)
            int[] range = getRange(field, min, max);
            bits.set(range[0], range[1] + 1);
        }
        else {
            String[] split = StringUtils.delimitedListToStringArray(field, &quot;/&quot;);
            if (split.length &gt; 2) {
                throw new IllegalArgumentException(&quot;Incrementer has more than two fields: &apos;&quot; +
                        field + &quot;&apos; in expression \&quot;&quot; + this.expression + &quot;\&quot;&quot;);
            }
            int[] range = getRange(split[0], min, max);
            if (!split[0].contains(&quot;-&quot;)) {
                range[1] = max - 1;
            }
            int delta = Integer.valueOf(split[1]);
            if (delta &lt;= 0) {
                throw new IllegalArgumentException(&quot;Incrementer delta must be 1 or higher: &apos;&quot; +
                        field + &quot;&apos; in expression \&quot;&quot; + this.expression + &quot;\&quot;&quot;);
            }
            for (int i = range[0]; i &lt;= range[1]; i += delta) {
                bits.set(i);
            }
        }
    }
}
</code></pre><p>è¯¥æ–¹æ³•æ˜¯æ ¹æ®è¡¨è¾¾å¼ï¼Œæ¥æ ‡è®°è¢«å‘½ä¸­çš„ç§’ï¼åˆ†ï¼æ—¶ï¼Œå³å°†å¯¹åº”çš„ bit è®¾ç½®ä¸º trueï¼š</p>
<pre><code>bits.set(i);
</code></pre><p>è¦ç†è§£è¿™ä¸ªæ–¹æ³•éœ€è¦å¯¹ cron è¡¨è¾¾å¼çš„è¯­æ³•æœ‰ä¸€å®šäº†è§£ã€‚è¿™é‡Œä¸åšç»†å™ï¼Œè¿…é€Ÿçœ‹å®Œè¯¥ç±»ï¼Œå›åˆ°ä¸»é“ã€‚<br>çŸ¥é“äº†æ˜¯æ€ä¹ˆæ ‡è¯†â€ç§’ï¼Œåˆ†ï¼Œæ—¶ï¼Œæ—¥ï¼Œæœˆï¼Œæ˜ŸæœŸï¼Œå¹´â€œè®¡ç®—ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹å°±å¥½åŠäº†ã€‚</p>
<pre><code>private void doNext(Calendar calendar, int dot) {
    List&lt;Integer&gt; resets = new ArrayList&lt;Integer&gt;();

    int second = calendar.get(Calendar.SECOND);
    List&lt;Integer&gt; emptyList = Collections.emptyList();
    int updateSecond = findNext(this.seconds, second, calendar, Calendar.SECOND, Calendar.MINUTE, emptyList);
    if (second == updateSecond) {
        resets.add(Calendar.SECOND);
    }

    int minute = calendar.get(Calendar.MINUTE);
    int updateMinute = findNext(this.minutes, minute, calendar, Calendar.MINUTE, Calendar.HOUR_OF_DAY, resets);
    if (minute == updateMinute) {
        resets.add(Calendar.MINUTE);
    }
    else {
        doNext(calendar, dot);
    }

    int hour = calendar.get(Calendar.HOUR_OF_DAY);
    int updateHour = findNext(this.hours, hour, calendar, Calendar.HOUR_OF_DAY, Calendar.DAY_OF_WEEK, resets);
    if (hour == updateHour) {
        resets.add(Calendar.HOUR_OF_DAY);
    }
    else {
        doNext(calendar, dot);
    }

    int dayOfWeek = calendar.get(Calendar.DAY_OF_WEEK);
    int dayOfMonth = calendar.get(Calendar.DAY_OF_MONTH);
    int updateDayOfMonth = findNextDay(calendar, this.daysOfMonth, dayOfMonth, daysOfWeek, dayOfWeek, resets);
    if (dayOfMonth == updateDayOfMonth) {
        resets.add(Calendar.DAY_OF_MONTH);
    }
    else {
        doNext(calendar, dot);
    }

    int month = calendar.get(Calendar.MONTH);
    int updateMonth = findNext(this.months, month, calendar, Calendar.MONTH, Calendar.YEAR, resets);
    if (month != updateMonth) {
        if (calendar.get(Calendar.YEAR) - dot &gt; 4) {
            throw new IllegalArgumentException(&quot;Invalid cron expression \&quot;&quot; + this.expression +
                    &quot;\&quot; led to runaway search for next trigger&quot;);
        }
        doNext(calendar, dot);
    }
}
</code></pre><p>findNext() æ–¹æ³•è´Ÿè´£ä» bitset ä¸­æ‰¾å‡ºä¸‹ä¸€ä¸ªä¸º true çš„å€¼ã€‚  </p>
<p>OKï¼ŒcronTriggeråˆ°è¿™ï¼Œæ¥çœ‹å¦ä¸€ä¸ªå¼€ç®±å³ç”¨çš„è§¦å‘å™¨ã€‚ </p>
<h3 id="PeriodicTrigger"><a href="#PeriodicTrigger" class="headerlink" title="PeriodicTrigger"></a>PeriodicTrigger</h3><p>é¡¾åæ€ä¹‰ï¼Œå‘¨æœŸæ€§çš„è§¦å‘å™¨ã€‚å‘¨æœŸæ€§åˆ†ä¸ºä¸¤ç§ï¼šfixedRate å’Œ fixedDelayã€‚å¤§å®¶å¦‚æœä½¿ç”¨è¿‡çº¿ç¨‹æ± æ¥å®ç°ç®€å•å®šæ—¶ä»»åŠ¡ï¼Œå°±åº”è¯¥ä¸ä¼šé™Œç”Ÿã€‚å‰è€…æ˜¯å›ºå®šå‘¨æœŸï¼Œè€Œåè€…æ˜¯ç›¸å¯¹ä¸Šæ¬¡æ‰§è¡Œå®Œæˆçš„å›ºå®šå»¶è¿Ÿã€‚çœ‹ä¸‹ nextExecutionTime çš„å®ç°å°±ä¸€ç›®äº†ç„¶ï¼š</p>
<pre><code>public Date nextExecutionTime(TriggerContext triggerContext) {
        if (triggerContext.lastScheduledExecutionTime() == null) {
            return new Date(System.currentTimeMillis() + this.initialDelay);
        }
        else if (this.fixedRate) {
            return new Date(triggerContext.lastScheduledExecutionTime().getTime() + this.period);
        }
        return new Date(triggerContext.lastCompletionTime().getTime() + this.period);
    }
</code></pre><h2 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h2><p>TaskScheduler æ ¹æ®å®šæ—¶ä»»åŠ¡çš„ä¸åŒé…ç½®å®šä¹‰äº†ä¸åŒæ¥å£ï¼š</p>
<pre><code>public interface TaskScheduler {

     ScheduledFuture schedule(Runnable task, Trigger trigger);

       ScheduledFuture schedule(Runnable task, Date startTime);

     ScheduledFuture scheduleAtFixedRate(Runnable task, Date startTime, long period);

     ScheduledFuture scheduleAtFixedRate(Runnable task, long period);

        ScheduledFuture scheduleWithFixedDelay(Runnable task, Date startTime, long delay);

        ScheduledFuture scheduleWithFixedDelay(Runnable task, long delay);

}
</code></pre><p>æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼ŒThreadPoolTaskScheduler å’Œ ConcurrentTaskSchedulerï¼Œå¤§åŒå°å¼‚ï¼Œéƒ½ä½¿ç”¨äº†çº¿ç¨‹æ± ã€‚</p>
<h2 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h2><h3 id="Scheduled"><a href="#Scheduled" class="headerlink" title="Scheduled"></a>Scheduled</h3><p>å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªæ³¨è§£ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ª cron è¡¨è¾¾å¼ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š fixedDelay æˆ–è€… fixedRate å‚æ•°æ¥å®ç°ä»»åŠ¡çš„å®šæ—¶æ‰§è¡Œã€‚å¦‚æœä¸é€‚ç”¨ç¡¬ç¼–ç ï¼Œè¿˜å¯ä»¥é€šè¿‡ fixedRateString å’Œ fixedDelayString å‚æ•°ä»é…ç½®æ–‡ä»¶è¯»å–é—´éš”æ—¶é—´ã€‚<br>æ¥çœ‹é‡ç‚¹ç±» ScheduledAnnotationBeanPostProcessor ï¼Œå®ƒè´Ÿè´£ å¯¹ Scheduled æ³¨è§£çš„ä»»åŠ¡è¿›è¡Œæ³¨å†Œã€‚</p>
<pre><code>private void processScheduled(Scheduled scheduled, Method method, Object bean) {
        try {
            Assert.isTrue(void.class.equals(method.getReturnType()),
                    &quot;Only void-returning methods may be annotated with @Scheduled&quot;);
            Assert.isTrue(method.getParameterTypes().length == 0,
                    &quot;Only no-arg methods may be annotated with @Scheduled&quot;);

        if (AopUtils.isJdkDynamicProxy(bean)) {
            try {
                // Found a @Scheduled method on the target class for this JDK proxy -&gt;
                // is it also present on the proxy itself?
                method = bean.getClass().getMethod(method.getName(), method.getParameterTypes());
            }
            catch (SecurityException ex) {
                ReflectionUtils.handleReflectionException(ex);
            }
            catch (NoSuchMethodException ex) {
                throw new IllegalStateException(String.format(
                        &quot;@Scheduled method &apos;%s&apos; found on bean target class &apos;%s&apos; but not &quot; +
                        &quot;found in any interface(s) for a dynamic proxy. Either pull the &quot; +
                        &quot;method up to a declared interface or switch to subclass (CGLIB) &quot; +
                        &quot;proxies by setting proxy-target-class/proxyTargetClass to &apos;true&apos;&quot;,
                        method.getName(), method.getDeclaringClass().getSimpleName()));
            }
        }
        else if (AopUtils.isCglibProxy(bean)) {
            // Common problem: private methods end up in the proxy instance, not getting delegated.
            if (Modifier.isPrivate(method.getModifiers())) {
                LogFactory.getLog(ScheduledAnnotationBeanPostProcessor.class).warn(String.format(
                        &quot;@Scheduled method &apos;%s&apos; found on CGLIB proxy for target class &apos;%s&apos; but cannot &quot; +
                        &quot;be delegated to target bean. Switch its visibility to package or protected.&quot;,
                        method.getName(), method.getDeclaringClass().getSimpleName()));
            }
        }

        Runnable runnable = new ScheduledMethodRunnable(bean, method);
        boolean processedSchedule = false;
        String errorMessage =
                &quot;Exactly one of the &apos;cron&apos;, &apos;fixedDelay(String)&apos;, or &apos;fixedRate(String)&apos; attributes is required&quot;;

        // Determine initial delay
        long initialDelay = scheduled.initialDelay();
        String initialDelayString = scheduled.initialDelayString();
        if (StringUtils.hasText(initialDelayString)) {
            Assert.isTrue(initialDelay &lt; 0, &quot;Specify &apos;initialDelay&apos; or &apos;initialDelayString&apos;, not both&quot;);
            if (this.embeddedValueResolver != null) {
                initialDelayString = this.embeddedValueResolver.resolveStringValue(initialDelayString);
            }
            try {
                initialDelay = Integer.parseInt(initialDelayString);
            }
            catch (NumberFormatException ex) {
                throw new IllegalArgumentException(
                        &quot;Invalid initialDelayString value \&quot;&quot; + initialDelayString + &quot;\&quot; - cannot parse into integer&quot;);
            }
        }

        // Check cron expression
        String cron = scheduled.cron();
        if (StringUtils.hasText(cron)) {
            Assert.isTrue(initialDelay == -1, &quot;&apos;initialDelay&apos; not supported for cron triggers&quot;);
            processedSchedule = true;
            if (this.embeddedValueResolver != null) {
                cron = this.embeddedValueResolver.resolveStringValue(cron);
            }
            this.registrar.addCronTask(new CronTask(runnable, cron));
        }
        // At this point we don&apos;t need to differentiate between initial delay set or not anymore
        if (initialDelay &lt; 0) {
            initialDelay = 0;
        }

        // Check fixed delay
        long fixedDelay = scheduled.fixedDelay();
        if (fixedDelay &gt;= 0) {
            Assert.isTrue(!processedSchedule, errorMessage);
            processedSchedule = true;
            this.registrar.addFixedDelayTask(new IntervalTask(runnable, fixedDelay, initialDelay));
        }
        String fixedDelayString = scheduled.fixedDelayString();
        if (StringUtils.hasText(fixedDelayString)) {
            Assert.isTrue(!processedSchedule, errorMessage);
            processedSchedule = true;
            if (this.embeddedValueResolver != null) {
                fixedDelayString = this.embeddedValueResolver.resolveStringValue(fixedDelayString);
            }
            try {
                fixedDelay = Integer.parseInt(fixedDelayString);
            }
            catch (NumberFormatException ex) {
                throw new IllegalArgumentException(
                        &quot;Invalid fixedDelayString value \&quot;&quot; + fixedDelayString + &quot;\&quot; - cannot parse into integer&quot;);
            }
            this.registrar.addFixedDelayTask(new IntervalTask(runnable, fixedDelay, initialDelay));
        }

        // Check fixed rate
        long fixedRate = scheduled.fixedRate();
        if (fixedRate &gt;= 0) {
            Assert.isTrue(!processedSchedule, errorMessage);
            processedSchedule = true;
            this.registrar.addFixedRateTask(new IntervalTask(runnable, fixedRate, initialDelay));
        }
        String fixedRateString = scheduled.fixedRateString();
        if (StringUtils.hasText(fixedRateString)) {
            Assert.isTrue(!processedSchedule, errorMessage);
            processedSchedule = true;
            if (this.embeddedValueResolver != null) {
                fixedRateString = this.embeddedValueResolver.resolveStringValue(fixedRateString);
            }
            try {
                fixedRate = Integer.parseInt(fixedRateString);
            }
            catch (NumberFormatException ex) {
                throw new IllegalArgumentException(
                        &quot;Invalid fixedRateString value \&quot;&quot; + fixedRateString + &quot;\&quot; - cannot parse into integer&quot;);
            }
            this.registrar.addFixedRateTask(new IntervalTask(runnable, fixedRate, initialDelay));
        }

        // Check whether we had any attribute set
        Assert.isTrue(processedSchedule, errorMessage);
    }
    catch (IllegalArgumentException ex) {
        throw new IllegalStateException(
                &quot;Encountered invalid @Scheduled method &apos;&quot; + method.getName() + &quot;&apos;: &quot; + ex.getMessage());
    }
}
</code></pre><p>è™½ç„¶ä»£ç è¿™ä¹ˆé•¿ï¼Œä½†æ€è·¯å¾ˆç®€å•ï¼Œæ•´ç†ä¸‹ï¼š</p>
<ol>
<li>å‚æ•°æ£€éªŒï¼Œè¢«æ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯æ— å‚æ•°ä¸”è¿”å›ç±»å‹ voidï¼›</li>
<li>ç±»çš„åˆæ³•æ€§æ£€éªŒï¼Œå¦‚æœæ˜¯åŸºäº jdk ä»£ç†ï¼Œåˆ™å¿…é¡»å®ç°æ¥å£ï¼Œå¦‚æœæ˜¯ cglib ä»£ç†ï¼Œæ–¹æ³•ä¸èƒ½ä¸º privateï¼›</li>
<li>æ£€æŸ¥ initialDelay æˆ– initialDelayString å‚æ•°ï¼Œä¸¤ä¸ªåªèƒ½é…ç½®ä¸€ä¸ªï¼Œå¦‚æœé…ç½®çš„æ˜¯ initialDelayString ï¼Œåˆ™èµ‹å€¼åå°†å…¶è½¬ä¸º initialDelayï¼›</li>
<li>æ£€æŸ¥ cron è¡¨è¾¾å¼ï¼Œcron è¡¨è¾¾å¼å’Œ initialDelay ä¸èƒ½åŒæ—¶é…ç½®ã€‚æ„é€  CronTask ä»»åŠ¡æ”¾å…¥ cronTasks ä¸­ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼ŒCronTask ç»™æ¯ä¸€ä¸ªä»»åŠ¡æ·»åŠ äº† CronTrigger è§¦å‘å™¨ ï¼›</li>
<li>æ£€æŸ¥ fixedDelay å‚æ•°ï¼Œç¡®ä¿ cronï¼ŒfixedDelay(String)ï¼ŒfixedRate(String) åªèƒ½é…ç½®ä¸€ä¸ªã€‚æ„é€  IntervalTask ä»»åŠ¡æ”¾å…¥ fixedDelayTasks ä¸­ï¼›</li>
<li>æ£€æŸ¥ fixedRate å‚æ•°ï¼Œæ„é€  IntervalTask ä»»åŠ¡æ”¾å…¥ fixedRateTasks ä¸­ï¼›</li>
</ol>
<p>çœ‹å®Œæ€ä¹ˆå°† Scheduled æ³¨è§£çš„æ–¹æ³•æ„é€ æˆä»»åŠ¡åï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä»»åŠ¡çš„æ‰§è¡Œæ˜¯æ€ä¹ˆå®ç°çš„ã€‚<br>ScheduledTaskRegistrar ç±»ç»§æ‰¿äº† InitializingBean ï¼Œç±»åŠ è½½å®Œåæ‰§è¡Œ scheduleTasks æ–¹æ³•ã€‚</p>
<pre><code>protected void scheduleTasks() {
    long now = System.currentTimeMillis();

    if (this.taskScheduler == null) {
        this.localExecutor = Executors.newSingleThreadScheduledExecutor();
        this.taskScheduler = new ConcurrentTaskScheduler(this.localExecutor);
    }
    if (this.triggerTasks != null) {
        for (TriggerTask task : this.triggerTasks) {
            this.scheduledFutures.add(this.taskScheduler.schedule(
                    task.getRunnable(), task.getTrigger()));
        }
    }
    if (this.cronTasks != null) {
        for (CronTask task : this.cronTasks) {
            this.scheduledFutures.add(this.taskScheduler.schedule(
                    task.getRunnable(), task.getTrigger()));
        }
    }
    if (this.fixedRateTasks != null) {
        for (IntervalTask task : this.fixedRateTasks) {
            if (task.getInitialDelay() &gt; 0) {
                Date startTime = new Date(now + task.getInitialDelay());
                this.scheduledFutures.add(this.taskScheduler.scheduleAtFixedRate(
                        task.getRunnable(), startTime, task.getInterval()));
            }
            else {
                this.scheduledFutures.add(this.taskScheduler.scheduleAtFixedRate(
                        task.getRunnable(), task.getInterval()));
            }
        }
    }
    if (this.fixedDelayTasks != null) {
        for (IntervalTask task : this.fixedDelayTasks) {
            if (task.getInitialDelay() &gt; 0) {
                Date startTime = new Date(now + task.getInitialDelay());
                this.scheduledFutures.add(this.taskScheduler.scheduleWithFixedDelay(
                        task.getRunnable(), startTime, task.getInterval()));
            }
            else {
                this.scheduledFutures.add(this.taskScheduler.scheduleWithFixedDelay(
                        task.getRunnable(), task.getInterval()));
            }
        }
    }
}
</code></pre><p>ä¸Šé¢å·²ç»å…ˆäº†è§£äº† TaskSchedulerï¼Œè¿™æ®µä»£ç åšçš„äº‹æƒ…å°±å¾ˆæ˜äº†äº†ï¼Œé¦–å…ˆåˆå§‹åŒ–å¥½ TaskSchedulerï¼Œç„¶åå°†æ‰€æœ‰ä¸åŒé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ”¾å…¥å…¶ä¸­ï¼Œå‰©ä¸‹çš„å°±äº¤ç»™çº¿ç¨‹æ± äº†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šspring é»˜è®¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ‰€æœ‰çš„å®šæ—¶ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œé€šå¸¸éœ€è¦é…ç½®ä¸‹çº¿ç¨‹æ± çš„å¤§å°ï¼š</p>
<pre><code>&lt;task:scheduled-tasks scheduler=&quot;myScheduler&quot;&gt;
    &lt;task:scheduled ref=&quot;beanA&quot; method=&quot;methodA&quot; fixed-delay=&quot;5000&quot; initial-delay=&quot;1000&quot;/&gt;
    &lt;task:scheduled ref=&quot;beanB&quot; method=&quot;methodB&quot; fixed-rate=&quot;5000&quot;/&gt;
    &lt;task:scheduled ref=&quot;beanC&quot; method=&quot;methodC&quot; cron=&quot;*/5 * * * * MON-FRI&quot;/&gt;
&lt;/task:scheduled-tasks&gt;

&lt;task:scheduler id=&quot;myScheduler&quot; pool-size=&quot;10&quot;/&gt;
</code></pre><p>ok, schedule æ¨¡å—çš„é‡ç‚¹å°±å…ˆçœ‹åˆ°è¿™é‡Œï¼Œè™½ç„¶ä¹‹å‰ç”¨è¿‡å¾ˆå¤šæ¬¡ï¼Œä½†çœ‹å®Œæºç ä¹‹åï¼Œè¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šé…ç½®çš„æ–°æ–¹å¼ã€‚å½“ç„¶ï¼Œçœ‹æºç ä¸€æ–¹é¢æ˜¯ä¸ºäº†æ›´å¥½åœ°ä½¿ç”¨  spring,å¦ä¸€æ–¹é¢æ›´é‡è¦çš„æ˜¯è¦ä»ä¸­å­¦ä¹ å…¶è®¾è®¡æ€æƒ³ã€‚fightingï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;schedule task åœ¨å·¥ä½œåœºæ™¯ä¸­åº”è¯¥æ˜¯éœ€è¦é¢‘ç¹ä½¿ç”¨çš„ã€‚å®ç°æ–¹å¼ä¹Ÿå¾ˆå¤šï¼Œå¸¸è§çš„å½“å± spring è‡ªå¸¦çš„æ³¨è§£å®ç°ä»¥åŠ quartz æ¡†æ¶ã€‚è‡³äºåº•å±‚åŸç†ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¿…ä¸å¯å°‘ã€‚ä»Šå¤©å°±æ¥æ­å¼€ spring æ˜¯å¦‚ä½•å¯¹ä»»åŠ¡è°ƒåº¦è¿›è¡ŒæŠ½è±¡ã€‚
    
    </summary>
    
      <category term="Springæºç " scheme="http://xuyajun.cn/categories/Spring%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>è‡ªçœ</title>
    <link href="http://xuyajun.cn/2017/03/26/%E8%87%AA%E7%9C%81/"/>
    <id>http://xuyajun.cn/2017/03/26/è‡ªçœ/</id>
    <published>2017-03-26T10:09:38.000Z</published>
    <updated>2017-03-26T10:12:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ˜¯ä¸ªé˜³å…‰æ˜åªšçš„å‘¨æœ«ï¼Œæˆ–å‡ºå»è¸æ˜¥ï¼Œæˆ–éšäºé˜³å…‰ä¸€è§’çœ‹ä¹¦ï¼Œéƒ½èƒ½è®©æˆ‘æ”¶è·å¾ˆä¹…ä¸ä»æœ‰çš„å–œæ‚¦ï¼Œæ¯•ç«Ÿï¼Œä»å°åˆ°å¤§ï¼Œçˆ±å¥½å¹»æƒ³çš„æˆ‘ä¸€ç›´è®¤ä¸ºé˜³å…‰å°±æ˜¯æˆ‘çš„ç§»åŠ¨ç”µæºï¼Œæœ‰é˜³å…‰ï¼Œå°±ä¼šå……æ»¡èƒ½é‡ã€‚ä½†æœ‹å‹åœˆå’Œç¾¤æ¶ˆæ¯ç­‰å„ä¸ªæ¸ é“éƒ½åœ¨ä¹‰æ„¤å¡«è†ºè®¨è®ºç€ä¸€åˆ™æ–°é—»ã€‚æ˜¯çš„ï¼Œå±±ä¸œèŠåŸâ€œè¾±æ¯æ€äººæ¡ˆâ€ã€‚<br><a id="more"></a><br>è¿™ä¸æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡å£°è®¨ç¤¾ä¼šï¼Œçœ‹è¿‡å¤ªå¤šçš„è­¦å¯Ÿä¸ä½œä¸ºï¼Œå¤ªå¤šçš„æ³•å®˜åªä¼šæŒ‰ç…§æ³•å¾‹æ¡æ–‡ç”šè‡³åè¢’æ¶åŠ¿åŠ›æ‰§æ³•ã€‚æ¯æ¬¡äº‹ä»¶çš„æ›å…‰éƒ½èƒ½ç‚¹æ»¡å¤§ä¼—çš„æ€’æ°”å€¼ï¼Œä¸€é¡¿å£ä¼ç¬”è¯›ã€‚ç„¶åï¼Œéšç€æ—¶é—´æ¨ç§»ï¼Œæ¯å¤©ä¸Šè¯¾çš„ä¸Šè¯¾ï¼Œä¸Šç­çš„ä¸Šç­ï¼Œåœ¨ç¤¾ä¼šçš„é‡å‹ä¸‹è¿‡ç€è‡ªå·±çš„ç”Ÿæ´»ã€‚äººå‘ï¼Œå–„å¿˜ï¼  </p>
<p>å¯¹è¿™èµ·æ¡ˆä»¶ï¼Œè¿˜éœ€è¦è¡¨æ˜è‡ªå·±çš„æ€åº¦å—ï¼Œå¼•ç”¨äººæ°‘æ—¥æŠ¥çš„ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>æ³•å¾‹çš„ç¤¾ä¼šåŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è¯´ï¼Œæ³•å¾‹ä¸ä»…å…³ä¹è§„åˆ™ï¼Œè¿˜å…³ä¹è§„åˆ™èƒŒåçš„ä»·å€¼è¯‰æ±‚ï¼Œå…³ä¹å›åº”äººå¿ƒæ‰€å‘ã€å¡‘é€ ä¼¦ç†äººæƒ…ã€‚æ­¤æ¡ˆåœ¨åŠå¹´è¿‡åæ€èµ·èˆ†è®ºæ³¢æ¾œï¼Œæ­£æ˜¯å› ä¸ºå…¶ä¸­è•´å«ç€è®¸å¤šäººçš„ä¼¦ç†è¯‰æ±‚å’Œæƒ…æ„Ÿè¯‰æ±‚ã€‚</p>
</blockquote>
<p>ç›¸æ¯”æ¡ˆä»¶æœ¬èº«ï¼Œè®©æˆ‘æ›´åŠ éœ‡åŠ¨å’Œæ‚²å“€çš„æ˜¯ç½‘ä¸Šè¯„è®ºä¸­æºæ‚çš„æç«¯â€ç¾åˆ†â€œè¨€è¯­ï¼ŒæŠ›å¼€ä¸€äº›é—¨æˆ·ç½‘ç«™æ•…æ„å¸¦èŠ‚å¥ä¸è¯´ï¼Œè¿™äº›â€œç¾åˆ†â€ç°å®ä¸­ç¡®å®ä¸æ˜¯å°‘æ•°ã€‚æ¯æ¯çœ‹ç€è¿™äº›è¨€è®ºï¼Œæˆ‘éƒ½ä¸€ç¬‘ç½®ä¹‹ï¼Œæˆ‘ä»¬çš„å›½å®¶æ­£åœ¨å¤„äºè½¬å‹æœŸï¼Œé“å¾·çš„æ²¦è½æ˜¯æ— æ³•é€ƒé¿çš„ç—›è‹¦è¿‡ç¨‹ã€‚æˆ‘ç›¸ä¿¡ï¼Œé‚£äº›è¢«å† ä»¥æ–‡æ˜ä¹‹åçš„å›½å®¶åœ¨å‡ åå¹´å‰å¤„äºæ”¹é©æœŸï¼Œç»æµå¿«é€Ÿå‘å±•æ—¶ï¼Œä¹Ÿæ˜¯è¿™æ ·è¿‡æ¥çš„ã€‚ï¼ˆè®½åˆºçš„æ˜¯ï¼Œæˆ‘å¹¶æ²¡æœ‰æŸ¥é˜…ä»»ä½•èµ„æ–™æ¥ä½è¯è‡ªå·±çš„ç›¸ä¿¡ï¼‰  </p>
<p>ä½†æ˜¯ï¼Œå°±ç®—è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šå¾€æ–‡æ˜ç¤¾ä¼šçš„å¿…ç»ä¹‹è·¯ï¼Œé‚£ä¹Ÿæ˜¯ä¸€æ¡å……æ»¡å˜æ•°ï¼Œå‡¶å¤šå‰å°‘çš„è·¯å•Šã€‚é•¿æœŸä»¥æ¥ï¼Œä¼¼ä¹æˆ‘å¤©çœŸçš„è®¤ä¸ºå†è¿‡å‡ åå¹´ï¼Œå°±èƒ½å¾ˆè‡ªç„¶çš„è¿‡æ¸¡åˆ°æ–‡æ˜ç¤¾ä¼šã€‚è¿™ä¸ªæ–‡æ˜éš¾é“ä¸åº”è¯¥æ˜¯æˆ‘ä»¬åŠªåŠ›å®ç°çš„ç›®æ ‡ï¼Œè€Œéæˆ‘ä»¬åªéœ€ç­‰å¾…å³å¯äº«å—çš„ç»“æœå—ã€‚éš¾é“ä¸ä¼šå­˜åœ¨å†è¿‡å‡ åå¹´ï¼Œç¤¾ä¼šé“å¾·å½»åº•æ²¦è½ï¼Œå›½å®¶é™·å…¥åŠ¨ä¹±çš„å¯èƒ½å—ï¼Ÿ  </p>
<p>åŒ…æ‹¬æˆ‘åœ¨å†…çš„å¤§å¤šäººéƒ½æ˜¯æ™®é€šäººï¼Œæˆ‘ä»¬ä¸ä¼šå˜æˆå¥½è±åç”µå½±çš„è¶…äººï¼Œèƒ½åŠ›æŒ½ç‹‚æ¾œï¼Œä»¥ä¸€å·±ä¹‹åŠ›å°†è‰¯çŸ¥æ’­æ•£åˆ°æ¯ä¸ªäººçš„å¿ƒä¸­ã€‚ç”šè‡³ï¼Œæˆ‘ä»¬èƒ½å¦åšå¥½è‡ªå·±éƒ½å°šæ˜¯æœªçŸ¥æ•°ã€‚æƒ³åˆ°è¿™ï¼Œå®›å¦‚ä¸€æŸé˜³å…‰è¿›å…¥äº†æˆ‘çš„å†…å¿ƒï¼Œå”¤é†’äº†æˆ‘ã€‚  </p>
<p>æˆ‘åªæƒ³åšå¥½è‡ªå·±ï¼Œè®©è‡ªå·±è¿‡ç€æœ‰å“è´¨çš„ç”Ÿæ´»çš„åŒæ—¶ç»™ç¤¾ä¼šå¸¦å»ä¸€ä¸æ­£èƒ½é‡ã€‚æœ€è¿‘ä¸€ç›´åœ¨çœ‹è¥¿æ–¹å®—æ•™ï¼Œå°è¯•å»ç¼•æ¸…çŠ¹å¤ªæ•™ï¼ŒåŸºç£æ•™å’Œä¼Šæ–¯å…°æ•™ä¹‹é—´åƒä¸ä¸‡ç¼•çš„ç‰µè¿ã€‚çœ‹å®Œå‡ æœ¬ä¹¦åï¼Œé¢†æ‚Ÿåˆ°è¥¿æ–¹æ–‡åŒ–å’Œä¸­åä¼ ç»Ÿæ–‡åŒ–çš„ä¸åŒï¼Œç›¸æ¯”è¥¿æ–¹çš„å®—æ•™ï¼Œæˆ‘æ›´å–œæ¬¢ä¼ ç»Ÿæ–‡åŒ–çš„å“²å­¦ã€‚æƒ³åˆ°è‡ªå·±ä¹‹å‰æ”¾å¼ƒæ·±å…¥å­¦ä¹ è‡ªå®¶ä¼ ç»Ÿæ–‡åŒ–è€Œç—´è¿·è¥¿æ–¹å†å²å’Œæ–‡åŒ–ï¼Œç®—æ˜¯è¿·é€”çŸ¥è¿”å§ã€‚å°±åœ¨å‡ åå¹´å‰ï¼Œæˆ‘ä»¬çš„çˆ·çˆ·å¥¶å¥¶è¾ˆåˆšç»å†è¿‡æˆ˜äº‰è‹¦éš¾ï¼Œè¢«è¥¿æ–¹å¼ºè¡Œè½°å¼€å¤§é—¨ï¼Œè®©å›½äººæ•£å¤±äº†å¯¹äº”åƒå¹´ä¼ ç»Ÿæ–‡åŒ–çš„ä¿¡ä»»ã€‚æ˜¯æ—¶å€™æ¢å¤æˆ‘ä»¬è‡ªå·±çš„æ–‡åŒ–è‡ªä¿¡äº†ï¼</p>
<p>è€Œå¯¹æˆ‘è€Œè¨€ï¼Œæ˜¯æ—¶å€™å›åˆ°ç»§ç»­å­¦ä¹ å¿ƒå­¦çš„é“è·¯äº†ã€‚å½“åˆï¼Œåœ¨æˆ‘å¤„äºå›°å¢ƒæ—¶ï¼Œæ˜¯å¿ƒå­¦ç»™äº†æˆ‘ä¿¡ä»°ï¼Œè®©æˆ‘å®Œæˆäº†é’å¹´åˆ°æˆå¹´çš„æ€æƒ³èœ•åŒ–ã€‚å·¥ä½œåï¼Œè¿‡ç€æ¸©æ°´ç…®è›™çš„æ—¥å­ï¼Œè®©è‡ªå·±é€æ¸æ•£å¤±äº†ç»§ç»­å­¦ä¹ å¿ƒå­¦çš„çƒ­æƒ…ã€‚è€Œç¤¾ä¼šçš„ç—…æ€ï¼Œä¹ å¤§å¤§çš„ä»¥èº«ä½œåˆ™ï¼Œä»¥åŠå¿ƒå­¦å½±å“åŠ›çš„æ‰©å¤§ï¼Œæ— ä¸åœ¨æé†’æˆ‘ï¼Œå¿ƒå­¦å°±æ˜¯å›½äººæ€¥éœ€é‡æ‹¾çš„ä¼ ç»Ÿæ–‡åŒ–ç²¾åã€‚  </p>
<p>â€œç™¾æ— ä¸€ç”¨æ˜¯ä¹¦ç”Ÿâ€ï¼Œå­¦ä¹ ä¼ ç»Ÿæ–‡åŒ–çš„äººåªä¼šâ€œçŸ¥ä¹è€…ä¹Ÿâ€ä¼¼ä¹å·²ç»æˆä¸ºç¤¾ä¼šçš„åˆ»æ¿å°è±¡ã€‚ç°ä»£ç¤¾ä¼šå……æ–¥ç€å”¯ç‰©ä¸»ä¹‰ï¼Œå¯¹ä¼ ç»Ÿæ–‡åŒ–å’Œæ–‡äººç¼ºå°‘äº†å°Šé‡ã€‚è¯šç„¶ï¼Œä¼ ç»Ÿæ–‡åŒ–å­˜åœ¨ç³Ÿç²•ï¼Œè€Œå¿ƒå­¦å°±æ˜¯è„±é¢–è€Œå‡ºçš„å“²å­¦ã€‚å¿ƒå­¦å¼ºè°ƒä¸ªäººçš„ä»·å€¼ï¼Œåšåˆ°â€œå†…åœ£å¤–ç‹â€ï¼Œè€Œç‹é˜³æ˜æœ¬äººï¼Œåœ¨ä¿®å¿ƒçš„åŸºç¡€ä¸Šï¼Œå»ºåŠŸç«‹ä¸šï¼Œæˆä¸ºç«‹å¾·ç«‹è¨€ç«‹åŠŸçš„åœ£äººã€‚  </p>
<p>æ‰¾åˆ°è‡ªå·±çš„ä¿¡ä»°ä¸éš¾ï¼Œæ€ä¹ˆå»åšæŒå­¦ä¹ æ‰æ˜¯è€ƒéªŒã€‚ä¸­é€”å› ä¸ºç”Ÿæ´»çš„èˆ’é€‚ï¼Œè‡ªæˆ‘çš„æ”¾ä»»å¿˜å´æœ¬å¿ƒä¹Ÿæ˜¯å­¦ä¹ å¿ƒå­¦çš„å¿…ç»ä¹‹è·¯ï¼Œæ¯•ç«Ÿï¼Œä¿¡ä»°å¯¹å›½äººè¿˜ç®—æ˜¯ä¸ªå¥¢é¥°å“ã€‚ç„¶è€Œï¼Œè¿™æ¡è·¯é€šå‘ä½•æ–¹ï¼Œéœ€è¦è‡ªå·±å»åŠæ—¶åçœã€‚  </p>
<p>ç›®å‰å¿ƒå­¦åœ¨æ•™ç§‘ä¹¦ä¸Šå‡ºç°çš„æ¬¡æ•°å¹¶ä¸å¤šï¼Œå¤§å¤šæ˜¯å­”å­Ÿä¹‹é“ï¼Œé¢‡æœ‰ç§â€æˆäººä»¥é±¼â€œçš„å‘³é“ã€‚å°æ—¶å€™ç›´æ¥çŒè¾“å°Šè€çˆ±å¹¼ï¼Œå­é¡ºçˆ¶æ¯ç­‰ä¼˜ç§€ä¼ ç»Ÿæ²¡é—®é¢˜ï¼Œä½†é•¿å¤§äº†æœ‰è‡ªä¸»æ€ç»´çš„æ—¶å€™ï¼Œâ€œæˆäººä»¥æ¸”â€æ‰æ˜¯æ­£é“ã€‚æ•™è‚²æ˜¯æœ€ç»ˆçš„ç­”æ¡ˆï¼Œå¸Œæœ›ä¸‹ä¸€ä»£ï¼Œä¸‹ä¸‹ä¸€ä»£é™¤äº†ä¼šèƒŒä¸‰å­—ç»ä¹‹å¤–ï¼Œè¿˜èƒ½é¢†æ‚Ÿåˆ°ï¼š</p>
<blockquote>
<p>æ— å–„æ— æ¶å¿ƒä¹‹ä½“ï¼Œæœ‰å–„æœ‰æ¶æ„ä¹‹åŠ¨ï¼ŒçŸ¥å–„çŸ¥æ¶æ˜¯è‰¯çŸ¥ï¼Œä¸ºå–„å»æ¶æ˜¯æ ¼ç‰©ã€‚</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ˜¯ä¸ªé˜³å…‰æ˜åªšçš„å‘¨æœ«ï¼Œæˆ–å‡ºå»è¸æ˜¥ï¼Œæˆ–éšäºé˜³å…‰ä¸€è§’çœ‹ä¹¦ï¼Œéƒ½èƒ½è®©æˆ‘æ”¶è·å¾ˆä¹…ä¸ä»æœ‰çš„å–œæ‚¦ï¼Œæ¯•ç«Ÿï¼Œä»å°åˆ°å¤§ï¼Œçˆ±å¥½å¹»æƒ³çš„æˆ‘ä¸€ç›´è®¤ä¸ºé˜³å…‰å°±æ˜¯æˆ‘çš„ç§»åŠ¨ç”µæºï¼Œæœ‰é˜³å…‰ï¼Œå°±ä¼šå……æ»¡èƒ½é‡ã€‚ä½†æœ‹å‹åœˆå’Œç¾¤æ¶ˆæ¯ç­‰å„ä¸ªæ¸ é“éƒ½åœ¨ä¹‰æ„¤å¡«è†ºè®¨è®ºç€ä¸€åˆ™æ–°é—»ã€‚æ˜¯çš„ï¼Œå±±ä¸œèŠåŸâ€œè¾±æ¯æ€äººæ¡ˆâ€ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="å“²å­¦" scheme="http://xuyajun.cn/categories/%E5%93%B2%E5%AD%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€ŠNettyæƒå¨æŒ‡å—ã€‹</title>
    <link href="http://xuyajun.cn/2017/03/11/%E3%80%8ANetty%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B/"/>
    <id>http://xuyajun.cn/2017/03/11/ã€ŠNettyæƒå¨æŒ‡å—ã€‹/</id>
    <published>2017-03-11T09:59:52.000Z</published>
    <updated>2017-03-11T10:08:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>Netty å·²ç»æ˜¯ä¸ªéå¸¸æˆç†Ÿçš„é€šä¿¡æ¡†æ¶ï¼Œæ¥è§¦ Netty ä¹Ÿæ¯”è¾ƒæ—©ï¼Œä½†åªé™äºè‡ªå·±åšä¸ªç®€å•çš„ demoï¼Œç„¶åæŠŠ reactor æ¨¡å‹æŒ‚åœ¨å˜´è¾¹ã€‚ç›´åˆ°æœ€è¿‘å‡ ä¸ªæœˆè´Ÿè´£å…¬å¸çš„äº‘æ‰“å°æœºä¸šåŠ¡ï¼Œç”¨ Netty å¼€å‘ tcp æœåŠ¡å™¨ï¼Œæ‰å‘ç°è‡ªå·±ä¹‹å‰çš„äº‘é‡Œé›¾é‡Œæœ‰ç‚¹è‡ªæ¬ºæ¬ºäººäº†ã€‚<a id="more"></a> å½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§è¿›æ­¥ï¼Œå¯¹ä¹‹å‰çš„å¾ˆå¤šçŸ¥è¯†éƒ½æœ‰äº†æ›´æ·±åˆ»ç²¾å‡†çš„ç†è§£ã€‚<br> Netty æ˜¯ä¸ªä¼˜ç§€çš„æ¡†æ¶æ¯‹åº¸ç½®ç–‘ï¼Œä½†æˆ‘å¹¶ä¸æ‰“ç®—ç»†è¯»å…¶æºç ï¼Œjava çš„å¼€æºæ¡†æ¶å¤ªå¤šï¼Œæ¡†æ¶çš„å¼€å‘ä¹‹é“éƒ½å¤§åŒå°å¼‚ï¼Œé€‰å…¶ä¸€äºŒç»†é˜…ä¾¿å¯ï¼Œæˆ‘ä»¬å…³æ³¨çš„åº”è¯¥æ˜¯æ¯ä¸ªæ¡†æ¶ç‹¬ç‰¹åŠŸèƒ½çš„è®¾è®¡è‰ºæœ¯ã€‚<br> Netty å‡ºç°çš„èƒŒæ™¯ä¸å¤šä»‹ç»ï¼Œè¿™äº›ä¸ªæ¡†æ¶å‡ ä¹éƒ½æ˜¯å¼€å‘è€…çš„é“¶å¼¹ã€‚è‡ªä»æœ‰ä¸ª Nettyï¼Œæˆ‘ç›¸ä¿¡å‡ ä¹ä¸ä¼šæœ‰å…¬å¸ä¼šä½¿ç”¨åŸç”Ÿçš„ nio æ¥å¼€å‘åº”ç”¨äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒï¼Œæ€ä¹ˆæ ·ä½¿ç”¨åŸç”Ÿçš„ nio å»å¼€å‘ä¸€ä¸ªé«˜å¯ç”¨ï¼Œé«˜æ‰©å±•ï¼Œé«˜æ€§èƒ½çš„é€šä¿¡åº”ç”¨ã€‚å¦‚æœä½ æœ‰å¾ˆæ¸…æ™°çš„æ€è·¯ï¼Œå†æ¥çœ‹çœ‹ Netty æˆ–è€… mina è¿™äº›ï¼Œä¼°è®¡å°±æœ‰ç§æƒºæƒºç›¸æƒœçš„æ„Ÿè§‰ã€‚<br>ã€ŠNettyæƒå¨æŒ‡å—ã€‹è¿™æœ¬ä¹¦å‰åŠæœ¬éƒ½æ˜¯è®² Netty çš„å®é™…åº”ç”¨å¼€å‘ï¼Œä¸»è¦æ˜¯æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„åˆ›å»ºã€‚åé¢åŠæœ¬ç€é‡è¿›è¡Œäº†é‡è¦æ¨¡å—çš„æºç åˆ†æã€‚åœ¨è¿™é‡Œæˆ‘å°±ç•¥è¿‡åº”ç”¨å¼€å‘ï¼Œä»æºç åˆ†æè§’åº¦æ€»ç»“ä¸‹ Netty çš„è®¾è®¡ã€‚ï¼ˆæˆ‘ä»¬åˆ†æçš„æ˜¯ Netty 4.0 ç‰ˆæœ¬ã€‚ï¼‰<br>å°±åƒ nio ç”± selectorï¼Œchannelï¼Œbuffer è¿™ä¸‰ä¸ªæ ¸å¿ƒ API ç»„æˆä¸€æ ·ï¼ŒNetty ä¹Ÿæ˜¯ç”±å‡ ä¸ªé‡è¦ç»„ä»¶ç»„æˆï¼š</p>
<ul>
<li>ByteBuf</li>
<li>Channel</li>
<li>ChannelPipeLine</li>
<li>EventLoop</li>
</ul>
<p>ä¸€ä¸€æ¥çœ‹ã€‚</p>
<h2 id="ByteBuf"><a href="#ByteBuf" class="headerlink" title="ByteBuf"></a>ByteBuf</h2><p>nio æ˜¯é¢å‘ç¼“å†²çš„ï¼Œè€ŒåŸç”Ÿçš„ ByteBuffer å¤ªè¿‡äºå±€é™ï¼ˆæ¯”å¦‚é•¿åº¦å›ºå®šï¼‰ä¸”æ˜“å‡ºé”™ï¼ˆæ¯”å¦‚ flip() æ“ä½œï¼‰ï¼Œå› æ­¤ï¼ŒNetty å®ç°äº†è‡ªå·±çš„ ByteBufã€‚ByteBuf ä½¿ç”¨äº† readerIndex å’Œ writerIndex ä¸¤ä¸ªæ¸¸æ ‡ä½¿æˆ‘ä»¬æ›´æ–¹ä¾¿çš„è¯»å†™æ•°æ®ã€‚æ¥çœ‹ä¸‹ ByteBuf çš„ç±»å›¾ï¼š<br><img src="/images/ByteBuf.png" alt="alt text"><br>ä»å†…å­˜åˆ†é…çš„è§’åº¦çœ‹ï¼ŒByteBuf åˆ†ä¸ºä¸¤ç±»ï¼š </p>
<ol>
<li>å †å†…å­˜ï¼ˆHeapByteBufï¼‰:å†…å­˜åˆ†é…å’Œå›æ”¶é€Ÿåº¦å¿«ï¼Œç”± jvm ç®¡ç†ã€‚ä½†å¦‚æœè¿›è¡Œ I/O è¯»å†™ï¼Œéœ€è¦å¤šä¸€æ¬¡çš„å†…å­˜å¤åˆ¶ï¼Œå°†å †å†…å­˜å¯¹åº”çš„ç¼“å†²åŒºæ•°æ®å¤åˆ¶åˆ°å†…æ ¸ä¸­ï¼›</li>
<li>ç›´æ¥å†…å­˜ï¼ˆDirectByteBufï¼‰:è¿™æ˜¯ Netty çš„é«˜æ€§èƒ½å› ç´ ä¹‹ä¸€ï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„ç›´æ¥å†…å­˜ï¼Œå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼Œè¯»å†™æ›´å¿«ã€‚ä½†ç›¸å¯¹åº”çš„ï¼Œåˆ†é…å’Œå›æ”¶é€Ÿåº¦ä¼šæ…¢ä¸€äº›ã€‚</li>
</ol>
<p>ä»å†…å­˜å›æ”¶çš„è§’åº¦çœ‹ï¼ŒByteBuf åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ol>
<li>åŸºäºå¯¹è±¡æ± çš„ ByteBufï¼šå¯ä»¥é‡ç”¨ ByteBuf å¯¹è±¡ï¼Œæé«˜å†…å­˜ä½¿ç”¨ç‡ï¼Œé¿å…é‡å¤åˆ†é…å¯¹è±¡å’Œé¢‘ç¹ GCï¼›</li>
<li>æ™®é€š ByteBufï¼šæ¯æ¬¡éƒ½éœ€è¦åˆ†é…å†…å­˜ï¼Œä½¿ç”¨å®Œåç­‰å¾…å›æ”¶ã€‚</li>
</ol>
<p>ç†è§£äº†è¿™å‡ ç±» ByteBuf çš„å­˜åœ¨ï¼Œå°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆç±»å›¾ä¸­æœ‰è¿™äº›ä¸ªå­ç±»äº†ã€‚<br>AbstractByteBuf æŠ½è±¡ç±»è¢«ç§°ä¸ºæ˜¯ ByteBuf çš„ skeletonï¼ˆéª¨éª¼ï¼‰ï¼Œå®ç°äº†å¤§é‡è¯»å†™æ–¹æ³•ã€‚å…¶ä¸­å°±åŒ…æ‹¬ ByteBuf çš„åŠ¨æ€æ‰©å±•ç‰¹æ€§ã€‚æˆ‘ä»¬ä»æºç æ¥çœ‹ä¸‹ ByteBuf çš„æ‰©å®¹ç­–ç•¥ã€‚</p>
<pre><code>private int calculateNewCapacity(int minNewCapacity) {
    final int maxCapacity = this.maxCapacity;
    final int threshold = 1048576 * 4; // 4 MiB page

    if (minNewCapacity == threshold) {
        return threshold;
    }

    // If over threshold, do not double but just increase by threshold.
    if (minNewCapacity &gt; threshold) {
        int newCapacity = minNewCapacity / threshold * threshold;
        if (newCapacity &gt; maxCapacity - threshold) {
            newCapacity = maxCapacity;
        } else {
            newCapacity += threshold;
        }
        return newCapacity;
    }

    // Not over threshold. Double up to 4 MiB, starting from 64.
    int newCapacity = 64;
    while (newCapacity &lt; minNewCapacity) {
        newCapacity &lt;&lt;= 1;
    }

    return Math.min(newCapacity, maxCapacity);
}
</code></pre><p>å¯ä»¥çœ‹åˆ° Netty ä½¿ç”¨äº†å¤§å¤šæ•°ç³»ç»Ÿéƒ½ä¼šé‡‡ç”¨çš„å…ˆå€å¢åæ­¥è¿›çš„ç­–ç•¥ï¼Œå¹¶å°†é˜€å€¼è®¾ç½®ä¸º 4MBã€‚å½“æ–°å®¹é‡å°äºé˜€å€¼æ—¶ï¼Œä» 64 å¼€å§‹å€å¢ï¼Œç›´åˆ°å€å¢åçš„ç»“æœå¤§äºå®¹é‡å€¼ï¼›å½“å®¹é‡å¤§äºé˜€å€¼æ—¶ï¼Œé‡‡ç”¨ä»¥é˜€å€¼æ­¥è¿›çš„æ–¹å¼ã€‚é€šè¿‡è¿™ç§ç­–ç•¥ï¼Œå¾ˆå¥½çš„å®ç°äº†æ€§èƒ½å’ŒåŠŸèƒ½çš„æœ€ä¼˜åŒ–ã€‚<br>å†æ¥çœ‹çœ‹å¦ä¸€ä¸ªæŠ½è±¡ç±» AbstractReferenceCountedByteBuf ã€‚è¯¥ç±»ä¸»è¦æ˜¯å¯¹å¼•ç”¨è¿›è¡Œè®¡æ•°ï¼Œç±»ä¼¼ JVM å†…å­˜å›æ”¶çš„å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ï¼Œåšè‡ªåŠ¨å†…å­˜å›æ”¶ã€‚è¯¥ç±»æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æœ‰ retain0() å’Œ release0() æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹è®¡æ•°å™¨è¿›è¡Œå¢åŠ å’Œå‡å°‘æ“ä½œã€‚çœ‹ä¸‹ release0():</p>
<pre><code>private boolean release0(int decrement) {
    for (;;) {
        int refCnt = this.refCnt;
        if (refCnt &lt; decrement) {
            throw new IllegalReferenceCountException(refCnt, -decrement);
        }

        if (refCntUpdater.compareAndSet(this, refCnt, refCnt - decrement)) {
            if (refCnt == decrement) {
                deallocate();
                return true;
            }
            return false;
        }
    }
}
</code></pre><p>å½“ refCnt ä¸º 1 æ—¶ï¼Œå°±é‡Šæ”¾å†…å­˜ï¼Œdeallocate() ç”±å„ä¸ªå­ç±»å®ç°ã€‚è€Œè¿™ç§ä½¿ç”¨åŸå­ç±»çš„ CAS æ¥è¿›è¡ŒåŠ å‡å·²ç»æˆä¸ºæ ‡å‡†ï¼Œä¸åšè¯¦è¿°ã€‚<br>Buffer æ¨¡å—çš„æºç éš¾ç‚¹åœ¨äº PooledByteBuf å†…å­˜æ± çš„è®¾è®¡ï¼Œè¿™é‡Œä¸åšæºç åˆ†æï¼Œç®€å•æè¿°ä¸‹ç®—æ³•ï¼šNetty çš„ å†…å­˜æ± ç®¡ç†ç±»æ˜¯ PoolArena ã€‚ è€Œ PoolArena æ˜¯ç”±å¤šä¸ª PoolChunk ç»„æˆçš„å¤§å—å†…å­˜åŒºåŸŸï¼ŒPoolChunk åˆç”±å¤šä¸ª PoolSubpage ç»„æˆã€‚Chunk ä¸­çš„ Page è¢«æ„å»ºæˆä¸€é¢—äºŒå‰æ ‘ï¼Œå‡å¦‚ Chunk ç”± 16 ä¸ª Page ç»„æˆï¼Œåˆ™å°†ä¼šä»¥ä¸‹å›¾çš„ç»“æ„ç»„ç»‡èµ·æ¥ã€‚<br><img src="/images/Chunk.png" alt="alt text">     </p>
<p>å½“éœ€è¦åˆ†é…å†…å­˜ï¼Œå°±ä¼šä»è¿™æ£µæ ‘ä¸Šè¿›è¡Œåˆ†é…ï¼Œå¹¶å°†æ ‡è®°èŠ‚ç‚¹çš„åˆ†é…çŠ¶æ€ã€‚<br>å¯¹äºå°äºä¸€ä¸ª Page çš„å†…å­˜åˆ†é…ï¼Œåˆ™åœ¨ Page ä¸­å®Œæˆï¼Œä½†æ¯ä¸ª Page ä¼šè¢«åˆ‡æˆå¤§å°ç›¸åŒçš„å¤šä¸ªå­˜å‚¨å—ï¼Œå­˜å‚¨å—çš„å¤§å°ç”±ç¬¬ä¸€æ¬¡ç”³è¯·çš„å†…å­˜å—å†³å®šã€‚<br>è‡³äºå›æ”¶ï¼Œé€šè¿‡çŠ¶æ€ä½æ¥æ ‡è®°å†…å­˜æ˜¯å¦å¯ç”¨ï¼Œè¿˜è®°å¾—ä¸Šé¢æåˆ°çš„å¼•ç”¨è®¡æ•°å™¨å—ï¼Œè¿™æ—¶å€™å°±å‘æŒ¥ä½œç”¨äº†ï½ </p>
<h2 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h2><p>Channel æ˜¯ Netty ç½‘ç»œæ“ä½œæ¥å£ï¼ŒåŒ…å«ä½†ä¸é™äºç½‘è·¯çš„è¯»å†™ï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼Œä¸»åŠ¨å…³é—­è¿æ¥ï¼Œè·å–åŒæ–¹çš„ç½‘ç»œåœ°å€ï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº† Netty æ¡†æ¶ç›¸å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è·å–è¯¥ Channel çš„ EventLoopï¼Œè·å–ç¼“å†²åˆ†é…å™¨ ByteBufAllocator å’Œå¤„ç†é“¾ ChannelPinelineã€‚<br>Channel çš„å®ç°ç±»å®åœ¨å¤ªå¤šï¼Œæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„åº”è¯¥æ˜¯ NioServerSocketChannel å’Œ NioSocketChannel äº†ã€‚<br>è¦æƒ³äº†è§£ å®ƒä»¬ä¿©ï¼Œè¿˜å¾—å…ˆçœ‹ä¸‹ channel çš„éª¨éª¼ç±» AbstractChannelã€‚AbstractChannel çœ‹èµ·æ¥å€’ä¹Ÿä¸ç´¯ï¼Œåå€’è§‰å¾—å¾ˆç®€å•ï¼Œæ‰€æœ‰çš„ç½‘ç»œäº‹ä»¶éƒ½ç›´æ¥äº¤ç»™æˆ‘ä»¬å¦ä¸€ä¸ªç»„ä»¶ ChannelPineline åšäº†ã€‚è‡ªå·±å®ç°äº†ä¸€äº›å…¬å…±çš„ APIï¼Œæ¯”å¦‚ localAddress()ï¼ŒåŠŸèƒ½åªè¦ä¸å­ç±»å¼ºç›¸å…³ï¼Œå°±å°†æ–¹æ³•å®šä¹‰ä¸ºæŠ½è±¡ï¼Œäº¤ç»™å­ç±»å®ç°ã€‚<br>ç»§ç»­çœ‹ AbstractNioChannelï¼Œåˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å°±æœ‰äº›ç†Ÿæ‚‰æ„Ÿäº†ï¼Œçœ‹åˆ°äº†ç‚¹æ ¸å¿ƒä»£ç ã€‚</p>
<pre><code>protected void doRegister() throws Exception {
    boolean selected = false;
    for (;;) {
        try {
            selectionKey = javaChannel().register(eventLoop().selector, 0, this);
            return;
        } catch (CancelledKeyException e) {
            if (!selected) {
                // Force the Selector to select now as the &quot;canceled&quot; SelectionKey may still be
                // cached and not removed because no Select.select(..) operation was called yet.
                eventLoop().selectNow();
                selected = true;
            } else {
                // We forced a select operation on the selector before but the SelectionKey is still cached
                // for whatever reason. JDK bug ?
                throw e;
            }
        }
    }
}
</code></pre><p>è¯¥æ–¹æ³•å®ç°äº† Channel çš„æ³¨å†Œï¼Œç»§ç»­è¿›å…¥ register() æ–¹æ³•ä¼šçœ‹åˆ°åŸç”Ÿçš„ nio APIã€‚<br>æ¥åˆ°æœ€æ¥è¿‘ NioSocketChannel çš„ç±» AbstractNioByteChannelã€‚é‡Œé¢åªæœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼š<br><code>private Runnable flushTask;</code><br>çœ‹ä¸‹æ ¸å¿ƒæ–¹æ³• doWrite()ï¼š</p>
<pre><code>protected void doWrite(ChannelOutboundBuffer in) throws Exception {
    int writeSpinCount = -1;

    boolean setOpWrite = false;
    for (;;) {
        Object msg = in.current();
        if (msg == null) {
            // Wrote all messages.
            clearOpWrite();
            // Directly return here so incompleteWrite(...) is not called.
            return;
        }

        if (msg instanceof ByteBuf) {
            ByteBuf buf = (ByteBuf) msg;
            int readableBytes = buf.readableBytes();
            if (readableBytes == 0) {
                in.remove();
                continue;
            }

            boolean done = false;
            long flushedAmount = 0;
            if (writeSpinCount == -1) {
                writeSpinCount = config().getWriteSpinCount();
            }
            for (int i = writeSpinCount - 1; i &gt;= 0; i --) {
                int localFlushedAmount = doWriteBytes(buf);
                if (localFlushedAmount == 0) {
                    setOpWrite = true;
                    break;
                }

                flushedAmount += localFlushedAmount;
                if (!buf.isReadable()) {
                    done = true;
                    break;
                }
            }

            in.progress(flushedAmount);

            if (done) {
                in.remove();
            } else {
                // Break the loop and so incompleteWrite(...) is called.
                break;
            }
        } else if (msg instanceof FileRegion) {
            FileRegion region = (FileRegion) msg;
            boolean done = region.transfered() &gt;= region.count();

            if (!done) {
                long flushedAmount = 0;
                if (writeSpinCount == -1) {
                    writeSpinCount = config().getWriteSpinCount();
                }

                for (int i = writeSpinCount - 1; i &gt;= 0; i--) {
                    long localFlushedAmount = doWriteFileRegion(region);
                    if (localFlushedAmount == 0) {
                        setOpWrite = true;
                        break;
                    }

                    flushedAmount += localFlushedAmount;
                    if (region.transfered() &gt;= region.count()) {
                        done = true;
                        break;
                    }
                }

                in.progress(flushedAmount);
            }

            if (done) {
                in.remove();
            } else {
                // Break the loop and so incompleteWrite(...) is called.
                break;
            }
        } else {
            // Should not reach here.
            throw new Error();
        }
    }
    incompleteWrite(setOpWrite);
}
</code></pre><p>æœ‰ç‚¹é•¿ï¼Œæ¥æ•´ç†ä¸‹é€»è¾‘ï¼š </p>
<ol>
<li>ä»æ¶ˆæ¯ç¯å½¢æ•°ç»„ ChannelOutboundBuffer ä¸­å–å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœç©ºï¼Œåˆ™è¯´æ˜æ¶ˆæ¯éƒ½å‘é€å®Œæ¯•ï¼Œæ¸…é™¤åŠåŒ…æ ‡è¯†ï¼Œreturnï¼›</li>
<li>å¦‚æœæ¶ˆæ¯æ˜¯ ByteBuf ç±»å‹ï¼Œåˆ¤æ–­å¯è¯»å­—èŠ‚æ•°ï¼Œå¦‚æœä¸º 0ï¼Œåˆ é™¤æ¶ˆæ¯ï¼Œcontinueï¼›å¦‚æœæ¶ˆæ¯å¯å‘é€ï¼Œä»é…ç½®å¯¹è±¡ä¸­è·å–å¾ªç¯å‘é€æ¬¡æ•° writeSpinCountã€‚è®¾ç½®å†™åŠåŒ…å¾ªç¯æœ€å¤§æ¬¡æ•°æ˜¯ä¸ºäº†é˜²æ­¢ I/O çº¿ç¨‹ä¸€ç›´å°è¯•å†™æ“ä½œï¼Œè¿™æ ·é€ æˆå…¶å®ƒ I/O æ“ä½œæ— æ³•è¿›è¡Œã€‚ç»å† forå¾ªç¯åï¼Œå¦‚æœå‘é€æˆåŠŸï¼Œåˆ™å°†å·²å‘é€çš„æ•°æ®ä» ChannelOutboundBuffer ä¸­åˆ é™¤ï¼Œå¦åˆ™ breakï¼Œè¿›å…¥ incompleteWrite() æ–¹æ³•ï¼›</li>
<li>å¦‚æœæ¶ˆæ¯æ˜¯ FileRegion ç±»å‹ï¼ˆç”¨äºæ–‡ä»¶ä¼ è¾“ï¼‰ï¼Œå¤„ç†é€»è¾‘å’Œ ByteBuf ç±»å‹ä¸€æ ·ã€‚</li>
</ol>
<p>è‡³äº incompleteWrite() æ–¹æ³•ï¼Œä¹Ÿæ¥çœ‹ä¸‹å§ï¼š</p>
<pre><code>protected final void incompleteWrite(boolean setOpWrite) {
        // Did not write completely.
        if (setOpWrite) {
            setOpWrite();
        } else {
            // Schedule flush again later so other tasks can be picked up in the meantime
            Runnable flushTask = this.flushTask;
            if (flushTask == null) {
                flushTask = this.flushTask = new Runnable() {
                    @Override
                    public void run() {
                        flush();
                    }
                };
            }
            eventLoop().execute(flushTask);
        }
    }
</code></pre><p>æ€»ç®—çœ‹åˆ°å”¯ä¸€çš„æˆå‘˜å˜é‡ flushTask æ´¾ä¸Šç”¨åœºäº†ã€‚é¦–å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦è®¾ç½®å†™åŠåŒ…æ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯å°† SelectionKey è®¾ç½®æˆå¯å†™çš„ã€‚åªè¦è®¾ç½®æˆå¯å†™ï¼Œå¤šè·¯å¤ç”¨å™¨ä¼šä¸åœè½®è¯¢å¯¹åº”çš„ channelï¼Œå› æ­¤ä¸éœ€è¦å†å¯åŠ¨ç‹¬ç«‹çš„çº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®å†™æ“ä½œä½ï¼Œåˆ™å°† flushTask åŠ å…¥åˆ° EventLoop ä¸­ã€‚<br>Channel è¦æƒ³ä¸€æ•´å¥—çœ‹ä¸‹æ¥è¿˜æ˜¯å¾ˆè€—ç²¾åŠ›çš„ï¼Œç”±äºè®¾è®¡æ–¹æ³•çš„é«˜è¶…ï¼Œåˆ°äº† NioServerSocketChannel è¿™å„¿ï¼Œå…¶å®å·²ç»ä¸éœ€è¦åšä»€ä¹ˆäº‹äº†ã€‚</p>
<h2 id="ChannelPipeLine"><a href="#ChannelPipeLine" class="headerlink" title="ChannelPipeLine"></a>ChannelPipeLine</h2><p>çœŸæ­£å¤„ç†ä¸šåŠ¡é€»è¾‘çš„å½“å± ChannelPipeline å’Œ ChannelHandler äº†ã€‚è¯¥æ¨¡å—ç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œç±»ä¼¼äº web ä¸­çš„è¿‡æ»¤å™¨ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼è®¾è®¡è€Œæˆã€‚è¿™é‡Œå°±åªæä¸‹è‡ªå·±é‡åˆ°çš„å‘ï¼š</p>
<ol>
<li>ChannelPipeline çº¿ç¨‹å®‰å…¨ï¼Œä½† ChannelHandler å¹¶éçº¿ç¨‹å®‰å…¨ã€‚é‰´äºæˆ‘ä»¬è‡ªå®šä¹‰ handler æ—¶éƒ½æ˜¯é‡‡ç”¨æ³¨è§£ @Sharable ï¼Œä¹Ÿå°±æ˜¯é“¾è·¯å…±ç”¨ä¸€ä¸ª handlerï¼Œè€Œéæ¯æ¡é“¾è·¯éƒ½åˆ›å»ºä¸€ä¸ªç§æœ‰ handlerï¼Œæ‰€æœ‰æˆ‘ä»¬è¦ä¿è¯ handler çš„çº¿ç¨‹å®‰å…¨ï¼›</li>
<li>ç»§æ‰¿ ByteToMessageDecoder è‡ªå®šä¹‰è§£ç å™¨æ—¶ï¼Œè¦æ³¨æ„è¯»åŠåŒ…é—®é¢˜ã€‚</li>
</ol>
<h2 id="EventLoop"><a href="#EventLoop" class="headerlink" title="EventLoop"></a>EventLoop</h2><p>Netty ä¸­çš„ NioEventLoop å¯¹ nio ä¸­çš„å¤šè·¯å¤ç”¨å™¨ Selector è¿›è¡Œäº†è£…é¥°ã€‚ä¹‹å‰è‡ªå·±å†™è¿‡çš„ nio ä»£ç åœ¨è¯¥ç±»éƒ½èƒ½æ‰¾åˆ°ç‚¹å½±å­ï¼Œæ¥çœ‹æ®µé•¿ä»£ç  run() æ–¹æ³•ï¼š</p>
<pre><code>protected void run() {
    for (; ; ) {
        try {
            switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) {
                case SelectStrategy.CONTINUE:
                    continue;
                case SelectStrategy.SELECT:
                    select(wakenUp.getAndSet(false));
                    if (wakenUp.get()) {
                        selector.wakeup();
                    }
                default:
                    // fallthrough
            }

            cancelledKeys = 0;
            needsToSelectAgain = false;
            final int ioRatio = this.ioRatio;
            if (ioRatio == 100) {
                try {
                    processSelectedKeys();
                } finally {
                    // Ensure we always run tasks.
                    runAllTasks();
                }
            } else {
                final long ioStartTime = System.nanoTime();
                try {
                    processSelectedKeys();
                } finally {
                    // Ensure we always run tasks.
                    final long ioTime = System.nanoTime() - ioStartTime;
                    runAllTasks(ioTime * (100 - ioRatio) / ioRatio);
                }
            }
        } catch (Throwable t) {
            handleLoopException(t);
        }
        // Always handle shutdown even if the loop processing threw an exception.
        try {
            if (isShuttingDown()) {
                closeAll();
                if (confirmShutdown()) {
                    return;
                }
            }
        } catch (Throwable t) {
            handleLoopException(t);
        }
    }
}
</code></pre><p>è€è§„çŸ©ï¼Œæ•´ç†ä¸‹é€»è¾‘ï¼š</p>
<ol>
<li>é€šè¿‡ hasTasks() åˆ¤æ–­æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è°ƒç”¨ selector() æ–¹æ³•å¤„ç† I/O äº‹ä»¶ï¼›</li>
<li>ç”±äº NioEventLoop éœ€è¦åŒæ—¶å¤„ç† I/O äº‹ä»¶å’Œé I/O ä»»åŠ¡ï¼Œä¸ºäº†ä¿è¯ä¸¤è€…éƒ½èƒ½å¤Ÿè¢«æ‰§è¡Œï¼ŒNetty æä¾›äº†å‚æ•° ioRatio æ¥å®šä¹‰ I/O äº‹ä»¶å¤„ç†æ—¶é—´æ¯”ä¾‹ï¼Œé»˜è®¤ 50%ã€‚runAllTasks() æ–¹æ³•ç”¨æ¥å¤„ç†é˜Ÿåˆ—ä¸­çš„é I/O ä»»åŠ¡ï¼Œå¹¶ä¸”åˆ†é…çš„æ—¶é—´åˆ°äº†ç»™å®šçš„æ—¶é—´å°±é€€å‡ºï¼Œç­‰å¾…ä¸‹æ¬¡å¤„ç†ï¼›</li>
<li>å¤„ç†å®Œæ‰€æœ‰äº‹ä»¶åï¼Œåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦è¿›å…¥ä¼˜é›…åœæœºçŠ¶æ€ï¼Œå¦‚æœå…³é—­ï¼Œåˆ™è°ƒç”¨ closeAll()ï¼Œé‡Šæ”¾èµ„æºï¼Œå¹¶è®© NioEventLoop çº¿ç¨‹é€€å‡ºå¾ªç¯ã€‚</li>
</ol>
<p>å›«å›µåæ£èˆ¬çš„è·Ÿä¹¦æµè§ˆäº†ä¸‹æºç ï¼Œè™½ç„¶æ²¡æœ‰ä¸€æ­¥æ¶ˆåŒ–åˆ°ä½ï¼Œä¸è¿‡å¯¹äºç†è§£ Netty çš„è®¾è®¡æ€æƒ³å’Œæ¨¡å—åˆ†å·¥ï¼Œè¿˜æ˜¯å¾ˆæœ‰ä½œç”¨ï¼Œä¹Ÿè§£å†³äº†ä¸å°‘é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ã€‚åæœŸå¦‚æœéœ€è¦å¯¹ Netty é¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼Œå†æ¥è¿›è¡Œè¿›ä¸€æ­¥å¼ºåŒ–ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Netty å·²ç»æ˜¯ä¸ªéå¸¸æˆç†Ÿçš„é€šä¿¡æ¡†æ¶ï¼Œæ¥è§¦ Netty ä¹Ÿæ¯”è¾ƒæ—©ï¼Œä½†åªé™äºè‡ªå·±åšä¸ªç®€å•çš„ demoï¼Œç„¶åæŠŠ reactor æ¨¡å‹æŒ‚åœ¨å˜´è¾¹ã€‚ç›´åˆ°æœ€è¿‘å‡ ä¸ªæœˆè´Ÿè´£å…¬å¸çš„äº‘æ‰“å°æœºä¸šåŠ¡ï¼Œç”¨ Netty å¼€å‘ tcp æœåŠ¡å™¨ï¼Œæ‰å‘ç°è‡ªå·±ä¹‹å‰çš„äº‘é‡Œé›¾é‡Œæœ‰ç‚¹è‡ªæ¬ºæ¬ºäººäº†ã€‚
    
    </summary>
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="http://xuyajun.cn/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>æ¸©æ•…çŸ¥æ–°</title>
    <link href="http://xuyajun.cn/2017/02/19/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0/"/>
    <id>http://xuyajun.cn/2017/02/19/æ¸©æ•…çŸ¥æ–°/</id>
    <published>2017-02-19T12:34:33.000Z</published>
    <updated>2017-02-19T12:37:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>17 å¹´çš„ç¬¬ä¸€ç¯‡æ–‡å­—ï¼Œæ¥çš„æœ‰ç‚¹è¿Ÿã€‚æœ€è¿‘èº«è¾¹å……æ–¥ç€å„ç§è·³æ§½ä¿¡æ¯ï¼Œæ¯•ç«Ÿå¹´åˆã€‚<a id="more"></a>å·¥ä½œäº†åŠå¹´å¤šï¼Œæˆ‘ä¹Ÿæ·±çŸ¥è‡ªå·±çš„å¤„å¢ƒï¼Œæ¯•ä¸šæ²¡æœ‰é€‰æ‹©å»å¤§å…¬å¸ï¼Œè®©è‡ªå·±å¤„åœ¨ä¸€ä¸ªæ¯”è¾ƒå®‰é€¸ï¼Œå¯èƒ½å·²ç»é€æ¸å¤±å»ç«äº‰åŠ›è€Œæµ‘ç„¶ä¸çŸ¥çš„ç¯å¢ƒã€‚å±…å®‰æ€å±ï¼Œæˆ‘å›å¿†äº†ä¸‹æ ¡æ‹›é¢è¯•é¢˜ï¼Œç»“åˆç½‘ä¸Šå„ç§ç¤¾æ‹›ç»éªŒå¥½æ–‡ï¼Œå°è¯•å»å›ç­”ã€‚ç»“æœæ˜¯æœ‰ç‚¹è¢«æ‰“å‡»çš„ï¼Œå¾ˆå¤šåŸºç¡€çŸ¥è¯†éƒ½å·²ç»è®°ä¸å¤ªæ¸…ã€‚å½“ç„¶ï¼Œå¦‚æœçœŸçš„å‡†å¤‡è·³æ§½ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥ä¸´æ—¶æŠ±ä½›è„šã€‚ä¸ºäº†æ–¹ä¾¿è‡ªå·±èƒ½å¤Ÿéšæ—¶è¿…é€Ÿé‡æ‹¾è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘æ‰“ç®—åœ¨ä»Šå¹´å¢å¼€ä¸€ä¸ªåšæ–‡æ ç›®ï¼Œå°†è¿™äº›é¢è¯•å¿…éœ€çš„åŸºç¡€çŸ¥è¯†ç³»ç»Ÿæ•´ç†ï¼Œå°±å«â€œæ¸©æ•…çŸ¥æ–°â€å§ã€‚è€Œæœ¬æ–‡å°±æ˜¯è¯¥æ ç›®ç¬¬ä¸€ç¯‡ï¼Œåˆ†é—¨åˆ«ç±»çš„åˆ—å‡ºæ‰€éœ€æŒæ¡çš„ä¸»çŸ¥è¯†ç‚¹ã€‚</p>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p><a href="">é›†åˆç±»æºç å‰–æ</a><br>JUC ç±»æºç å‰–æ<br>NIO æ¨¡å‹<br>å¤šçº¿ç¨‹<br>è™šæ‹Ÿæœºå†…å¹•<br>Web æ¡†æ¶<br>è®¾è®¡æ¨¡å¼</p>
<h2 id="æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•</h2><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><h2 id="è®¡ç®—æœºç³»ç»ŸåŸç†"><a href="#è®¡ç®—æœºç³»ç»ŸåŸç†" class="headerlink" title="è®¡ç®—æœºç³»ç»ŸåŸç†"></a>è®¡ç®—æœºç³»ç»ŸåŸç†</h2><h2 id="ç½‘ç»œåè®®"><a href="#ç½‘ç»œåè®®" class="headerlink" title="ç½‘ç»œåè®®"></a>ç½‘ç»œåè®®</h2><h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;17 å¹´çš„ç¬¬ä¸€ç¯‡æ–‡å­—ï¼Œæ¥çš„æœ‰ç‚¹è¿Ÿã€‚æœ€è¿‘èº«è¾¹å……æ–¥ç€å„ç§è·³æ§½ä¿¡æ¯ï¼Œæ¯•ç«Ÿå¹´åˆã€‚
    
    </summary>
    
      <category term="æ¸©æ•…çŸ¥æ–°" scheme="http://xuyajun.cn/categories/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-contextï¼ˆcacheï¼‰</title>
    <link href="http://xuyajun.cn/2016/12/25/Spring-context%EF%BC%88cache%EF%BC%89/"/>
    <id>http://xuyajun.cn/2016/12/25/Spring-contextï¼ˆcacheï¼‰/</id>
    <published>2016-12-25T14:19:52.000Z</published>
    <updated>2016-12-25T14:36:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>context ä¸»è¦æä¾›äº† cacheï¼Œjndiï¼Œscheduleï¼Œscript ç­‰åŠŸèƒ½çš„æŠ½è±¡ã€‚é€‰å– cache å’Œ schedule ä¸¤ä¸ªæœ‰ä»£è¡¨æ€§çš„æ¥é˜…è¯»å§ï¼Œå…¶ä»–æ¨¡å—æš‚æ—¶ä¸ç»†è¯»ã€‚<a id="more"></a>package å¦‚ä¸‹ï¼š<br><img src="/images/spring-context.png" alt="alt text">  </p>
<h2 id="cache"><a href="#cache" class="headerlink" title="cache"></a>cache</h2><p>å¹³æ—¶åº”ç”¨ä¸­é…ç½®çš„åŸºæœ¬éƒ½æ˜¯ encache ç¼“å­˜ï¼Œç°åœ¨ç»†æƒ³ä¸€ä¸‹ï¼Œspring æ—¢ç„¶æ”¯æŒé›†æˆä¸‰æ–¹ç¼“å­˜ï¼Œå°±å¿…ç„¶åœ¨åº•å±‚å°è£…äº†ä¸€å±‚æŠ½è±¡ï¼Œè¿™æ ·å°±æ—¢å¯ä»¥ä½¿ç”¨å†…éƒ¨å®ç°åˆèƒ½å¤Ÿæ”¯æŒä¸‰æ–¹çš„ä¸œè¥¿ã€‚æƒ³åˆ°è¿™ï¼Œcontext å·¥ç¨‹ä¸‹è¿™ä¹ˆå¤šæŠ½è±¡ä¹Ÿå°±èƒ½å¤Ÿç†è§£äº†ã€‚<br>æ—¢ç„¶æ˜¯å¯¹ cache æä¾›æŠ½è±¡ï¼ŒæŒ‰ç…§ç»éªŒï¼Œä¹Ÿå¤šå¤šå°‘å°‘èƒ½çŒœåˆ°ç‚¹å¥—è·¯ï¼Œä¸»è¦å›´ç»•æä¾›ç¼“å­˜æ³¨è§£åŠæ³¨è§£å¤„ç†å™¨ï¼Œç¼“å­˜ç®¡ç†å™¨ã€‚ä»¥è€å¸æœºçš„å¿ƒæ€æ¥è®©æˆ‘ä»¬ä¸€æ­¥æ­¥å‰¥å¼€ï½</p>
<h3 id="ç¼“å­˜ç›¸å…³çš„æ³¨è§£"><a href="#ç¼“å­˜ç›¸å…³çš„æ³¨è§£" class="headerlink" title="ç¼“å­˜ç›¸å…³çš„æ³¨è§£"></a>ç¼“å­˜ç›¸å…³çš„æ³¨è§£</h3><ol>
<li>@Cacheable<br> ç”¨æ¥è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯å¯ç¼“å­˜çš„ï¼Œå½“æœ‰ç›¸åŒ key çš„è¯·æ±‚æ¥æ—¶ï¼Œå‡½æ•°ä¸å¿…é‡å¤æ‰§è¡Œï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–ã€‚è‡³äºè¿™ä¸ª keyï¼Œä¾èµ–äºå‡½æ•°çš„æ‰€æœ‰å‚æ•°æˆ–éƒ¨åˆ†æœ‰åŒºåˆ†åº¦çš„å‚æ•°ã€‚ä¸ºäº†å®ç°è‡ªå®šä¹‰éƒ¨åˆ†å‚æ•°ç”Ÿæˆ keyï¼Œå°±å¿…é¡»æä¸€ä¸‹ SpELï¼ˆspring è¡¨è¾¾å¼è¯­è¨€ï¼‰ï¼Œå®ƒè¿˜å¯ä»¥å¸®åŠ©ä½ å®ç°æ¡ä»¶ç¼“å­˜ã€‚ï¼ˆğŸ˜‚çœŸçš„åªæ˜¯æä¸€ä¸‹ï¼Œä¸äº†è§£çš„è¯·è‡ªè¡Œçœ‹å®˜æ–¹æ–‡æ¡£ï¼‰</li>
<li>@CacheEvict<br> å’Œ Cacheable ç›¸åï¼Œè¯¥æ³¨è§£ç”¨äºåˆ é™¤ç¼“å­˜ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©æ‰§è¡Œä¸€ä¸ªæ–¹æ³•åï¼Œåœ¨ç¼“å­˜ä¸­åˆ é™¤è¯¥ key çš„ entry æˆ–è€…ç›´æ¥åˆ é™¤å…¨éƒ¨ entryã€‚</li>
<li>@CachePut<br> å¯¹æ–¹æ³•ä½¿ç”¨è¯¥æ³¨è§£ï¼Œå°†ä¼šæ¯æ¬¡éƒ½æ‰§è¡Œæ–¹æ³•ï¼Œå¹¶å°†ç»“æœæ›´æ–°åˆ°ç¼“å­˜ä¸­</li>
<li>@Caching<br> å½“éœ€è¦å¯¹ä¸€ä¸ªæ–¹æ³•è¿›è¡Œå¤šä¸ªç›¸åŒç±»å‹çš„æ³¨è§£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ³¨è§£ï¼Œå…è®¸ä½ æŒ‡å®šå¤šä¸ª Cacheableï¼CachePutï¼CacheEvictã€‚  </li>
</ol>
<p>åœ¨ä½ å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„æ–¹æ³•æˆ–ç±»ä¸Šè¿›è¡Œäº†ç¼“å­˜æ³¨è§£åï¼Œå¹¶ä¸èƒ½ç”Ÿæ•ˆï¼Œéœ€è¦ä½ åœ¨ xml ä¸­ä½¿ç”¨<code>&lt;cache:annotation-driven/&gt;</code>æˆ–è€…åœ¨ java ä»£ç ä¸­ä½¿ç”¨ @EnableCaching æ³¨è§£æ¥å¼€å¯ç¼“å­˜ç®¡ç†åŠŸèƒ½ã€‚    </p>
<h3 id="æ‰«æç¼“å­˜æ³¨è§£"><a href="#æ‰«æç¼“å­˜æ³¨è§£" class="headerlink" title="æ‰«æç¼“å­˜æ³¨è§£"></a>æ‰«æç¼“å­˜æ³¨è§£</h3><p>AnnotationCacheOperationSource ç±»ç”¨æ¥æŸ¥æ‰¾ç±»æˆ–æ–¹æ³•ä¸­ä¸ cache ç›¸å…³çš„ä¸€ç§æˆ–å¤šç§æ³¨è§£ï¼Œå¦‚æœæ„é€ å™¨ä¸ä¼ å…¥ CacheAnnotationParser ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ SpringCacheAnnotationParser æ¥æ‰«æè¿™ä¸ªç±»æˆ–æ–¹æ³•ã€‚è€Œ SpringCacheAnnotationParser ç»§æ‰¿äº† CacheAnnotationParser æ¥å£ï¼Œå®ç°äº†å¯¹ cache ç›¸å…³çš„æ‰€æœ‰æ³¨è§£çš„æ‰«æå¹¶å°è£…æˆ Collection<cacheoperation> è¿”å›ã€‚  </cacheoperation></p>
<pre><code>@Override
    public Collection&lt;CacheOperation&gt; parseCacheAnnotations(AnnotatedElement ae) {
        Collection&lt;CacheOperation&gt; ops = null;

        Collection&lt;Cacheable&gt; cacheables = getAnnotations(ae, Cacheable.class);
        if (cacheables != null) {
            ops = lazyInit(ops);
            for (Cacheable cacheable : cacheables) {
                ops.add(parseCacheableAnnotation(ae, cacheable));
            }
        }
        Collection&lt;CacheEvict&gt; evicts = getAnnotations(ae, CacheEvict.class);
        if (evicts != null) {
            ops = lazyInit(ops);
            for (CacheEvict evict : evicts) {
                ops.add(parseEvictAnnotation(ae, evict));
            }
        }
        Collection&lt;CachePut&gt; puts = getAnnotations(ae, CachePut.class);
        if (puts != null) {
            ops = lazyInit(ops);
            for (CachePut put : puts) {
                ops.add(parsePutAnnotation(ae, put));
            }
        }
        Collection&lt;Caching&gt; cachings = getAnnotations(ae, Caching.class);
        if (cachings != null) {
            ops = lazyInit(ops);
            for (Caching caching : cachings) {
                ops.addAll(parseCachingAnnotation(ae, caching));
            }
        }

        return ops;
    } 
</code></pre><h3 id="ç¼“å­˜ç®¡ç†å™¨"><a href="#ç¼“å­˜ç®¡ç†å™¨" class="headerlink" title="ç¼“å­˜ç®¡ç†å™¨"></a>ç¼“å­˜ç®¡ç†å™¨</h3><p>CacheManager æ¥å£æœ‰å¤šç§å®ç°ï¼ŒSimpleCacheManager æ˜¯é’ˆå¯¹åº”ç”¨åªæœ‰ä¸€ä¸ª CacheManagerï¼ŒCompositeCacheManager æ˜¯é’ˆå¯¹å¤šä¸ª CacheManagerï¼Œè€Œ NoOpCacheManager åˆ™æ˜¯ç‰¹æ®Šçš„ç®¡ç†å™¨ï¼Œå½“ä½ ä½¿ç”¨ CompositeCacheManager é…ç½®äº†å¥½å‡ ä¸ªç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œå¯èƒ½ä¼šéœ€è¦è¿™ç§ç®¡ç†å™¨æ¥è¿”å›ä¸€ä¸ª Cache çš„å­ç±» NoOpCacheã€‚é™¤äº†è¿™ä¸‰ç§ï¼ŒEhCacheCacheManager å’Œ JCacheCacheManager ä¹Ÿæ”¯æŒäº† encache å’Œ java çš„ç¼“å­˜ï¼ˆè¿™å°±æ˜¯æŠ½è±¡çš„ç›®çš„ï¼‰ã€‚ </p>
<h3 id="åŠ è½½æ–¹å¼"><a href="#åŠ è½½æ–¹å¼" class="headerlink" title="åŠ è½½æ–¹å¼"></a>åŠ è½½æ–¹å¼</h3><p>spring å¯ä»¥è®©ä½ é€šè¿‡ @EnableCaching çš„ mode å€¼æ¥é€‰æ‹©æ˜¯ä½¿ç”¨ åŸºäº java çš„ä»£ç†ï¼ˆ<em>AdviceMode.PROXY</em>ï¼‰æˆ–è€…é€šè¿‡åŸºäºç¼–ç»‡çš„ AspectJï¼ˆ<em>AdviceMode.ASPECTJ</em>ï¼‰æ¥å®ç°ç¼“å­˜çš„ aopã€‚ </p>
<p>æ¥çœ‹ä¸‹ä¸ºäº†ç¼“å­˜å†…éƒ¨å®ç°çš„åˆ‡é¢ CacheAspectSupport ï¼Œæ ¸å¿ƒæ–¹æ³• execute å®ç°äº†å¯¹æ–¹æ³•ç¼“å­˜æ³¨è§£çš„æ‰«æå¹¶è¿›è¡Œç›¸åº”æ“ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>protected Object execute(Invoker invoker, Object target, Method method, Object[] args) {
        // check whether aspect is enabled
        // to cope with cases where the AJ is pulled in automatically
        if (!this.initialized) {
            return invoker.invoke();
        }

        // get backing class
        Class&lt;?&gt; targetClass = AopProxyUtils.ultimateTargetClass(target);
        if (targetClass == null &amp;&amp; target != null) {
            targetClass = target.getClass();
        }
        Collection&lt;CacheOperation&gt; cacheOp = getCacheOperationSource().getCacheOperations(method, targetClass);

        // analyze caching information
        if (!CollectionUtils.isEmpty(cacheOp)) {
            Map&lt;String, Collection&lt;CacheOperationContext&gt;&gt; ops = createOperationContext(cacheOp, method, args, target, targetClass);
            // start with evictions
            inspectBeforeCacheEvicts(ops.get(EVICT));
            // follow up with cacheable
            CacheStatus status = inspectCacheables(ops.get(CACHEABLE));
            Object retVal;
            Map&lt;CacheOperationContext, Object&gt; updates = inspectCacheUpdates(ops.get(UPDATE));
            if (status != null) {
                if (status.updateRequired) {
                    updates.putAll(status.cacheUpdates);
                }
                // return cached object
                else {
                    return status.retVal;
                }
            }
            retVal = invoker.invoke();
            inspectAfterCacheEvicts(ops.get(EVICT), retVal);
            if (!updates.isEmpty()) {
                update(updates, retVal);
            }
            return retVal;
        }

        return invoker.invoke();
    }
</code></pre><p>è¯¥æŠ½è±¡ç±»å­ç±» CacheInterceptor å®ç°äº† MethodInterceptor çš„ invoke æ–¹æ³•ï¼š</p>
<pre><code>public Object invoke(final MethodInvocation invocation) throws Throwable {
        Method method = invocation.getMethod();

        Invoker aopAllianceInvoker = new Invoker() {
            public Object invoke() {
                try {
                    return invocation.proceed();
                } catch (Throwable ex) {
                    throw new ThrowableWrapper(ex);
                }
            }
        };

        try {
            return execute(aopAllianceInvoker, invocation.getThis(), method, invocation.getArguments());
        } catch (ThrowableWrapper th) {
            throw th.original;
        }
    }
</code></pre><p>cache æŠ½è±¡çš„é‡ç‚¹å°±æ˜¯è¿™äº›äº†ï¼Œä¸»è¦å€ŸåŠ©äº aop ã€‚å¯ä»¥é¢„æµ‹ï¼Œspring ä¸­çš„å…¶ä»–å¤§éƒ¨åˆ†åŠŸèƒ½æ¯”å¦‚äº‹åŠ¡éƒ½æ˜¯å¾—ç›Šäº aopã€‚æœ¬æ–‡æ²¡æœ‰å¯¹ aop è¿›è¡Œè¿‡å¤šè®²è§£ï¼Œä½†å…¶å® aop æ‰æ˜¯çœŸæ­£å€¼å¾—æ·±æŒ–çš„ç‚¹ã€‚å¾ˆæœŸå¾…å»æŒ‘æˆ˜ï¼</p>
<hr>
<p>ä¸ºäº†æ›´å¥½çš„ç†è§£æºç ï¼Œæœ€ç†æƒ³çš„æ˜¯è¦å¯¹è‡ªå·±é˜…è¯»éƒ¨åˆ†çš„åŠŸèƒ½åšä¸ªäº†è§£ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå»ºè®®å¤§å®¶åœ¨ spring çµæ´»è¿ç”¨çš„åŸºç¡€ä¸Šå†æŒ‘æˆ˜æºç ã€‚ä½†å¹³æ—¶ä½¿ç”¨çš„ spring åº”ç”¨å¯èƒ½å¹¶æ— æ³•è¦†ç›–æ‰€æœ‰åŠŸèƒ½ï¼Œæ‰€ä»¥å†é˜…è¯»åˆ°æ²¡ä½¿ç”¨è¿‡çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥å»ºåŠ© <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#cache-annotations-cacheable" target="_blank" rel="external">spring å®˜æ–¹æ–‡æ¡£</a>æ¥å…ˆäº†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚æœ¬æ–‡ä¸­çš„ cache æ³¨è§£æ”¯æŒå¯¹ç¬”è€…æ¥è¯´æœªåœ¨å®é™…ä¸­åº”ç”¨è¿‡ï¼Œé€šè¿‡å…ˆä»æ–‡æ¡£äº†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œä½¿ç”¨æ­¥éª¤åå†é˜…è¯»æºç ï¼Œå°±ä¸é‚£ä¹ˆäº‘é‡Œé›¾é‡Œï¼Œåè€Œè¿˜è§‰å¾—é¡ºç†æˆç« ï¼Œå°±æ˜¯åº”è¯¥è¿™æ ·å®ç°ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;context ä¸»è¦æä¾›äº† cacheï¼Œjndiï¼Œscheduleï¼Œscript ç­‰åŠŸèƒ½çš„æŠ½è±¡ã€‚é€‰å– cache å’Œ schedule ä¸¤ä¸ªæœ‰ä»£è¡¨æ€§çš„æ¥é˜…è¯»å§ï¼Œå…¶ä»–æ¨¡å—æš‚æ—¶ä¸ç»†è¯»ã€‚
    
    </summary>
    
      <category term="Springæºç " scheme="http://xuyajun.cn/categories/Spring%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Šredis çš„è®¾è®¡ä¸å®ç°ã€‹</title>
    <link href="http://xuyajun.cn/2016/11/27/%E3%80%8Aredis%20%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E3%80%8B/"/>
    <id>http://xuyajun.cn/2016/11/27/ã€Šredis çš„è®¾è®¡ä¸å®ç°ã€‹/</id>
    <published>2016-11-27T10:50:28.000Z</published>
    <updated>2016-11-27T11:19:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹åˆ°æœ‰äººè¿™æ ·å½¢å®¹ redis,åƒä¸€æŠŠç‘å£«å†›åˆ€ï¼Œå°å·§ï¼Œé”‹åˆ©ï¼Œå®ç”¨ã€‚åœ¨ä¹‹å‰å¯¹ redis è™½æœ‰äº†è§£ï¼Œå´æ— æ³•ä½“ä¼šåˆ°è¿™ç§æ„Ÿè§‰ã€‚çœ‹å®Œè¿™æœ¬åŒæ ·ç²¾ç¾çš„ä¹¦ï¼Œéš¾æŠ‘èµèµä¹‹æƒ…ã€‚redis åœ¨å¾ˆå¤šåœºæ™¯ç¡®å®æ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆï¼Œä¸ä»…å¯ä»¥å½“æ•°æ®åº“ç”¨ï¼Œè¿˜å¯ä»¥æ‹¿æ¥å½“æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¼“å­˜æ¥ä½¿ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œçœ‹å®Œå®ƒçš„è®¾è®¡ä¸å®ç°ï¼Œæ›´èƒ½å¤Ÿæ„è¯†åˆ°ï¼šä»»ä½•ç²¾ç¾çš„æŠ€æœ¯äº§å“éƒ½ä¸æ˜¯é£˜åœ¨äº‘ç«¯ï¼Œå¯æœ›ä¸å¯å³ï¼Œæ·±æŒ–åº•å±‚ï¼Œå°±èƒ½æŒæ¡ä¸€åˆ‡çªé—¨ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ç¬”è€…ä¸€ç›´åšæŒåœ¨åšçš„äº‹ğŸ’ªğŸ¼ï¼‰<a id="more"></a></p>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>è®©æˆ‘ä»¬ä»ä¸€å¼ å›¾å¼€å§‹å­¦ä¹  redis ä¸ºäº†æ”¯æŒå¤šç§æ•°æ®ç±»å‹å®ç°äº†å“ªäº›é«˜æ•ˆç‡çš„æ•°æ®ç»“æ„ã€‚<br><img src="/images/redisobject.png" alt="alt text">     </p>
<p>æ­£å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œredis ä¸åƒ memcached åªæ”¯æŒäº†å­—ç¬¦ä¸²ç±»å‹ï¼Œéœ€æ±‚é‡å¤§çš„åˆ—è¡¨ï¼Œé›†åˆï¼Œæœ‰åºé›†åˆï¼Œå“ˆå¸Œè¡¨éƒ½èƒ½æ”¯æŒã€‚è€Œæ”¯æ’‘è¿™äº›ç±»å‹çš„æ˜¯åº•å±‚å¤šç§æ•°æ®ç»“æ„ï¼Œæ¯ç§ç±»å‹å¯ä»¥ç”±ä¸åŒçš„æ•°æ®ç»“æ„å®ç°ï¼Œä¹¦ä¸­ç§°ä¹‹ä¸ºç¼–ç æ–¹å¼ã€‚redis å°†æ•°æ®ç±»å‹ï¼Œç¼–ç æ–¹å¼ï¼ŒæŒ‡é’ˆç­‰ä¿¡æ¯å°è£…æˆ redisObjectï¼Œå¯ä»¥ç†è§£ä¸º redis æ˜¯ &lt; sds,redisObject &gt;é”®å€¼å¯¹æ•°æ®åº“ã€‚redisObject ç»“æ„ä½“å¦‚ä¸‹ï¼š</p>
<pre><code>typedef struct redisObject{
    //ç±»å‹
    unsigned type:4;
    //å¯¹é½ä½
    unsigned notused:2;
    //ç¼–ç æ–¹å¼
    unsigned encoding:4;
    //LRUæ—¶é—´
    unsigned lru:22;
    //å¼•ç”¨è®¡æ•°
    int refcount;
    //æŒ‡å‘å¯¹è±¡çš„å€¼
    void *ptr;
}robj;
</code></pre><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æŒ¨ä¸ªçœ‹ä¸‹è¿™äº›æ•°æ®ç»“æ„æ€ä¹ˆè¢«å°è£…çš„ã€‚</p>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><pre><code>struct sdshdr{
    //bufå·²å ç”¨é•¿åº¦
    int len;
    //bufå‰©ä½™å¯ç”¨é•¿åº¦
    int free;
    //å®é™…ä¿å­˜å­—ç¬¦ä¸²æ•°æ®çš„åœ°æ–¹
    char buf[];
}
</code></pre><p>ç›¸æ¯” C è¯­è¨€ä¸­çš„ char* ï¼Œredis å°è£… sds ç”¨æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ä¸»è¦æœ‰ä¸‹é¢ä¸‰ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>é«˜æ•ˆæ‰§è¡Œé•¿åº¦è®¡ç®—ï¼ŒO(1) å¤æ‚åº¦</li>
<li>é«˜æ•ˆæ‰§è¡Œè¿½åŠ æ“ä½œï¼ˆé¢„åˆ†é…å†…å­˜ï¼Œå‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ï¼‰</li>
<li>äºŒè¿›åˆ¶å®‰å…¨ï¼ˆç¨‹åºä¸åº”å¯¹å­—ç¬¦ä¸²ä¿å­˜çš„æ•°æ®åšä»»ä½•å‡è®¾ï¼Œæ•°æ®å¯ä»¥æ˜¯ä»¥ â€œ\0â€ ç»“å°¾ï¼Œä¹Ÿå¯ä»¥æ˜¯å•çº¯çš„å­—èŠ‚æ•°ç»„æˆ–å…¶ä»–æ ¼å¼æ•°æ®ã€‚è€Œ C ä¸­çš„char * ä»¥ â€œ\0â€ ç»“æŸï¼‰</li>
</ul>
<h3 id="æ•´æ•°é›†åˆ"><a href="#æ•´æ•°é›†åˆ" class="headerlink" title="æ•´æ•°é›†åˆ"></a>æ•´æ•°é›†åˆ</h3><pre><code>typedef struct intset{
    //ä¿å­˜å…ƒç´ æ‰€ä½¿ç”¨çš„ç±»å‹çš„é•¿åº¦
    uint32_t encoding;
    //å…ƒç´ ä¸ªæ•°
    uint32_t length;
    //ä¿å­˜å…ƒç´ çš„æ•°ç»„
    int8_t contents[];
}intset;
</code></pre><p>æ•´æ•°é›†åˆç”¨äºæœ‰åºï¼Œæ— é‡å¤çš„ä¿å­˜å¤šä¸ªæ•´æ•°ï¼Œå¹¶ä¼šæ ¹æ®å…ƒç´ çš„å€¼ï¼Œè‡ªåŠ¨é€‰æ‹©ä½¿ç”¨ä»€ä¹ˆé•¿åº¦çš„æ•´æ•°ç±»å‹æ¥ä¿å­˜ï¼Œä½†åªæ”¯æŒå‡çº§ï¼Œä¸æ”¯æŒé™çº§ã€‚</p>
<h3 id="åŒç«¯é“¾è¡¨"><a href="#åŒç«¯é“¾è¡¨" class="headerlink" title="åŒç«¯é“¾è¡¨"></a>åŒç«¯é“¾è¡¨</h3><pre><code>typedef struct listNode{
        //å‰é©±èŠ‚ç‚¹
        struct listNode* prev;
        //åé©±èŠ‚ç‚¹
        struct listNode* next;
        //å€¼
        void *value;
    }listNode;

typedef struct list{
    //è¡¨å¤´æŒ‡é’ˆ
    listNode *head;
    //è¡¨å°¾æŒ‡é’ˆ
    listNode *tail;
    //èŠ‚ç‚¹æ•°é‡
    unsigned long len;
    //å¤åˆ¶å‡½æ•°
    void *(*dup)(void *ptr);
    //é‡Šæ”¾å‡½æ•°
    void *(*free)(void *ptr);
    //å¯¹æ¯”å‡½æ•°
    int (*match)(void *ptr,void *key);
}list;

typedef struct listIter{
    //ä¸‹ä¸€èŠ‚ç‚¹
    listNode *next;
    //è¿­ä»£æ–¹å‘
    int direction;
}listIter;        
</code></pre><p>ç”±äº C æœ¬èº«ä¸æ”¯æŒé“¾è¡¨ï¼Œæ‰€ä»¥ redis åƒå…¶ä»– C ç¨‹åºä¸€æ ·ï¼Œå¯¹é“¾è¡¨è¿›è¡Œäº†è‡ªå·±çš„å®ç°ã€‚è‡³äºåŒç«¯é“¾è¡¨çš„ç‰¹ç‚¹ï¼Œå°±ä¸åœ¨æ­¤ç»†è¯´ã€‚</p>
<h3 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h3><pre><code>typedef struct dict{
        //ç‰¹å®šäºç±»å‹çš„å¤„ç†å‡½æ•°
        dictType *type;
        //ç±»å‹å¤„ç†å‡½æ•°çš„ç§æœ‰æ•°æ®
        void *privdata;
        //å“ˆå¸Œè¡¨ï¼ˆ2ä¸ªï¼Œç”¨æ¥å®ç°æ¸è¿›å¼ rehashï¼‰
        dictht ht[2];
        //è®°å½• rehash è¿›åº¦çš„æ ‡å¿—ï¼Œï¼1è¡¨ç¤º rehash æœªè¿›è¡Œ
        int rehashidx;
        //å½“å‰æ­£åœ¨è¿ä½œçš„å®‰å…¨è¿­ä»£å™¨æ•°é‡
        int iterators;
    }dict;

typedef struct dictht{
    //å“ˆå¸Œè¡¨èŠ‚ç‚¹æŒ‡é’ˆæ•°ç»„ï¼ˆä¿—ç§°æ¡¶ï¼Œbucketï¼‰
    dictEntry **table;
    //æŒ‡é’ˆæ•°ç»„çš„å¤§å°
    unsigned long size;
    //æŒ‡é’ˆæ•°ç»„çš„é•¿åº¦æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼
    unsigned long sizemask;
    //å“ˆå¸Œè¡¨ç°æœ‰çš„èŠ‚ç‚¹æ•°é‡
    unsigned long used;
}dictht;

typedef struct dictEntry{
    //é”®
    void *key;
    //å€¼
    union{
        void *val;
        uint64_t u64;
        int64_t s64;
    }v;
    //é“¾åç»§èŠ‚ç‚¹
    struct dictEntry *next;
}dictEntry;

typedef struct dictIterator{
    //æ­£åœ¨è¿­ä»£çš„å­—å…¸
    dict *d;
    //æ­£åœ¨è¿­ä»£çš„å“ˆå¸Œè¡¨å·ç ï¼ˆ0/1ï¼‰
    int table;
    //æ­£åœ¨è¿­ä»£çš„å“ˆå¸Œè¡¨æ•°ç»„çš„ç´¢å¼•
    int index;
    //æ˜¯å¦å®‰å…¨
    int safe;
    //å½“å‰å“ˆå¸ŒèŠ‚ç‚¹
    dictEntry *entry;
    //å½“å‰å“ˆå¸ŒèŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹
    dictEntry *nextEntry;
}dictIterator; 
</code></pre><p>   çœ‹ä¹¦çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™æœ‰ç‚¹æ‡µé€¼ï¼Œè¢«ä¹¦ä¸­çš„å“ˆå¸Œé”®ï¼Œå“ˆå¸Œè¡¨ï¼Œå­—å…¸ä¸€ä¸‹å­æ•´ä¹±äº†ã€‚è¿™é‡Œéœ€è¦æ¢³ç†ä¸‹ï¼š<br>   redis ä½¿ç”¨äº†é«˜æ•ˆä¸”å®ç°ç®€å•çš„å“ˆå¸Œè¡¨æ¥ä½œä¸ºå­—å…¸çš„åº•å±‚å®ç°ã€‚è€Œä¸Šå›¾ redisobjcet ä¸­çš„æ•°æ®ç±»å‹ä¸­ä¹Ÿæœ‰ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªä»£è¡¨ä¸Šå±‚çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿè¢«å«åšæ•£åˆ—ã€‚å®é™…ä¸Šï¼Œredis ä¸­çš„æ•£åˆ—ç±»å‹ä½¿ç”¨å­—å…¸å’Œå‹ç¼©é“¾è¡¨ä¸¤ç§ä½œä¸ºåº•å±‚å®ç°ï¼Œå› ä¸ºå‹ç¼©é“¾è¡¨æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œæ‰€ä»¥åœ¨æ–°å»º Hash é”®æ—¶ï¼Œé»˜è®¤ä½¿ç”¨å‹ç¼©é“¾è¡¨ï¼Œå½“æ»¡è¶³æŸäº›æ¡ä»¶æ—¶ï¼Œåº•å±‚æ‰è½¬åŒ–ä¸ºå­—å…¸ã€‚</p>
<h3 id="å‹ç¼©åˆ—è¡¨"><a href="#å‹ç¼©åˆ—è¡¨" class="headerlink" title="å‹ç¼©åˆ—è¡¨"></a>å‹ç¼©åˆ—è¡¨</h3><p><img src="/images/ziplist.png" alt="alt text"><br>ziplistæ˜¯ç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„å†…å­˜å—æ„æˆçš„åˆ—è¡¨(æ‰€ä»¥ä¸åƒå…¶ä»–æ•°æ®ç»“æ„ç”¨ç»“æ„ä½“è¡¨ç¤º)ï¼Œå¯ä»¥ä¿å­˜å­—ç¬¦æ•°ç»„æˆ–æ•´æ•°å€¼ï¼Œç”¨æ¥ä½œä¸ºæ•£åˆ—ï¼Œåˆ—è¡¨å’Œæœ‰åºé›†åˆçš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚</p>
<h3 id="è·³è·ƒè¡¨"><a href="#è·³è·ƒè¡¨" class="headerlink" title="è·³è·ƒè¡¨"></a>è·³è·ƒè¡¨</h3><pre><code>typedef struct zskiplist{
    //å¤´èŠ‚ç‚¹ï¼Œå°¾èŠ‚ç‚¹
    struct zskiplistNode *header,*tail;
    //èŠ‚ç‚¹æ•°é‡
    unsigned long len;
    //ç›®å‰è¡¨å†…èŠ‚ç‚¹çš„æœ€å¤§å±‚æ•°
    int level;
}zskiplist;

typedef struct zskiplistNode{
    //memberå¯¹è±¡
    robj *obj;
    //åˆ†å€¼
    double score;
    //åé€€æŒ‡é’ˆ
    struct zskiplistNode *backward;
    //å±‚
    struct zskiplistLevel{
        //å‰è¿›æŒ‡é’ˆ
        struct zskiplistNode *forward;
        //è¿™ä¸ªå±‚è·¨è¶Šçš„èŠ‚ç‚¹æ•°é‡
        unsigned int span;
    }level[];
}zskiplistNode;
</code></pre><p>è·³è·ƒè¡¨çš„æ•ˆç‡å¯ä»¥å’Œå¹³è¡¡æ ‘åª²ç¾ï¼æŸ¥æ‰¾ï¼Œåˆ é™¤ï¼Œæ·»åŠ çš„æ—¶é—´å¤æ‚åº¦éƒ½å¯ä»¥è¾¾åˆ° O(logN)ï¼Œå¹¶ä¸”ï¼Œè·³è·ƒè¡¨çš„å®ç°è¦ç®€å•çš„å¤šã€‚<br>è·³è¶Šè¡¨åœ¨ redis ä¸­ä¸»è¦ç”¨æ¥å®ç°æœ‰åºé›†åˆã€‚</p>
<h2 id="åŠŸèƒ½ä¸€è§ˆ"><a href="#åŠŸèƒ½ä¸€è§ˆ" class="headerlink" title="åŠŸèƒ½ä¸€è§ˆ"></a>åŠŸèƒ½ä¸€è§ˆ</h2><p>çœ‹å®Œäº†è¿™äº›åº•å±‚ï¼Œä¹Ÿå°±ä¸éš¾ç†è§£ redis æ˜¯å¦‚ä½•å®ç°é‚£äº›æ•°æ®åº“å¿…å¤‡çš„åŠŸèƒ½äº†ã€‚æ— éæ˜¯åœ¨åº•å±‚æ•°æ®ç»“æ„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šä¸€äº›é€»è¾‘ã€‚æˆ‘ä»¬æ¥ç®€å•è¿‡ä¸‹ä¹¦ä¸­æåˆ°çš„åŠŸèƒ½ï¼Œæ›´å…¨åŠŸèƒ½è¯·çœ‹<a href="http://www.redis.cn/documentation.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p>
<h3 id="äº‹åŠ¡ï¼š"><a href="#äº‹åŠ¡ï¼š" class="headerlink" title="äº‹åŠ¡ï¼š"></a>äº‹åŠ¡ï¼š</h3><ul>
<li>å½“å®¢æˆ·ç«¯ä½¿ç”¨ MULTI å¼€å§‹äº‹åŠ¡æ—¶ï¼Œä¼šç”¨äº‹åŠ¡é˜Ÿåˆ—ä¿å­˜å®¢æˆ·ç«¯çš„å‘½ä»¤</li>
<li>ä½¿ç”¨ WATCH å‘½ä»¤çš„äº‹åŠ¡ä¼šå°†å®¢æˆ·ç«¯å’Œè¢«ç›‘è§†çš„é”®åœ¨æ•°æ®åº“çš„ watched_keys å­—å…¸ä¸­è¿›è¡Œå…³è”ï¼Œå½“é”®è¢«ä¿®æ”¹æ—¶ï¼Œç¨‹åºä¼šå°†æ‰€æœ‰ç›‘è§†è¢«ä¿®æ”¹é”®çš„å®¢æˆ·ç«¯çš„ REDIS_DIRTY_CAS é€‰é¡¹æ‰“å¼€ï¼Œè¿™æ ·å®¢æˆ·ç«¯æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œç›´æ¥è¿”å›å¤±è´¥</li>
<li>redis äº‹åŠ¡åªä¿è¯ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ï¼Œä¸ä¿è¯åŸå­æ€§å’ŒæŒä¹…æ€§</li>
</ul>
<h3 id="è®¢é˜…ä¸å‘å¸ƒï¼š"><a href="#è®¢é˜…ä¸å‘å¸ƒï¼š" class="headerlink" title="è®¢é˜…ä¸å‘å¸ƒï¼š"></a>è®¢é˜…ä¸å‘å¸ƒï¼š</h3><ul>
<li>è®¢é˜…ä¿¡æ¯ç”±æœåŠ¡å™¨è¿›ç¨‹ç»´æŠ¤çš„ redisServer.pubsub_channels å­—å…¸ä¿å­˜ï¼Œå­—å…¸çš„é”®ä¸ºè¢«è®¢é˜…çš„é¢‘é“ï¼Œå­—å…¸çš„å€¼ä¸ºè®¢é˜…é¢‘é“çš„æ‰€æœ‰å®¢æˆ·ç«¯</li>
<li>å½“æœ‰æ–°æ¶ˆæ¯å‘é€åˆ°é¢‘é“ä¸Šï¼Œç¨‹åºéå†é¢‘é“æ‰€å¯¹åº”çš„æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œç„¶åå‘é€æ¶ˆæ¯</li>
<li>è®¢é˜…æ¨¡å¼çš„ä¿¡æ¯ç”± redisServer.pubsub_patterns é“¾è¡¨ä¿å­˜ï¼Œé“¾è¡¨çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜ç€ä¸€ä¸ª pubsubPattern ç»“æ„ï¼Œç»“æ„ä¸­ä¿å­˜ç€è¢«è®¢é˜…çš„æ¨¡å¼ï¼Œä»¥åŠè®¢é˜…è¯¥æ¨¡å¼çš„å®¢æˆ·ç«¯ã€‚</li>
</ul>
<h3 id="luaè„šæœ¬ï¼š"><a href="#luaè„šæœ¬ï¼š" class="headerlink" title="luaè„šæœ¬ï¼š"></a>luaè„šæœ¬ï¼š</h3><ul>
<li>EVAL å‘½ä»¤ä¸ºè¾“å…¥è„šæœ¬å®šä¹‰ä¸€ä¸ª Lua å‡½æ•°ï¼Œç„¶åé€šè¿‡æ‰§è¡Œè¿™ä¸ªå‡½æ•°æ¥æ‰§è¡Œè„šæœ¬</li>
<li>EVALSHA é€šè¿‡æ„å»ºå‡½æ•°åï¼Œç›´æ¥è°ƒç”¨ Lua ä¸­å·²å®šä¹‰çš„å‡½æ•°ï¼Œä»è€Œæ‰§è¡Œç›¸åº”çš„è„šæœ¬</li>
</ul>
<h3 id="æ»¡æŸ¥è¯¢æ—¥å¿—ï¼š"><a href="#æ»¡æŸ¥è¯¢æ—¥å¿—ï¼š" class="headerlink" title="æ»¡æŸ¥è¯¢æ—¥å¿—ï¼š"></a>æ»¡æŸ¥è¯¢æ—¥å¿—ï¼š</h3><ul>
<li>redis ç”¨ä¸€ä¸ªé“¾è¡¨ä»¥ FIFO çš„é¡ºåºä¿å­˜ç€æ‰€æœ‰æ…¢æŸ¥è¯¢æ—¥å¿—</li>
<li>æ¯æ¡æ…¢æŸ¥è¯¢æ—¥å¿—ä»¥ä¸€ä¸ªæ…¢æŸ¥è¯¢èŠ‚ç‚¹è¡¨ç¤ºï¼ŒèŠ‚ç‚¹ä¸­è®°å½•ç€æ‰§è¡Œè¶…æ—¶çš„å‘½ä»¤ï¼Œå‘½ä»¤çš„å‚æ•°ï¼Œå‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ä»¥åŠæ‰§è¡Œå‘½ä»¤æ‰€æ¶ˆè€—çš„æ—¶é—´ç­‰ä¿¡æ¯</li>
</ul>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB:"></a>RDB:</h3><ul>
<li>rdbSave ä¼šå°†æ•°æ®åº“æ•°æ®ä¿å­˜åˆ° RDB æ–‡ä»¶ï¼Œå¹¶åœ¨ä¿å­˜ä¹‹å‰é˜»å¡è°ƒç”¨è€…</li>
<li>SAVE å‘½ä»¤ç›´æ¥è°ƒç”¨ rdbSave ï¼Œé˜»å¡ä¸»è¿›ç¨‹ï¼ŒBGSAVE ç”¨å­è¿›ç¨‹è°ƒç”¨ï¼Œä¸»è¿›ç¨‹å¯ä»¥ç»§ç»­å¤„ç†è¯·æ±‚</li>
<li>SAVE æ‰§è¡ŒæœŸé—´ï¼ŒAOF å†™å…¥å¯ä»¥åœ¨åå°çº¿ç¨‹è¿›è¡Œï¼ŒBGREWRITEAOF å¯ä»¥åœ¨å­è¿›ç¨‹è¿›è¡Œï¼Œæ‰€ä»¥è¿™ä¸‰ç§æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œ</li>
</ul>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF:"></a>AOF:</h3><ul>
<li>AOF æ–‡ä»¶é€šè¿‡ä¿å­˜æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“çš„å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çš„çŠ¶æ€</li>
<li>AOF æ–‡ä»¶ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä»¥ Redis é€šè®¯åè®®çš„æ ¼å¼ä¿å­˜</li>
<li>ä¸åŒçš„ AOF ä¿å­˜æ¨¡å¼ï¼ˆ AOF_FSYNC_NO ï¼ AOF_FSYNC_EVERYSEC / AOF_FSYNC_ALWAYSï¼‰å¯¹æ•°æ®çš„å®‰å…¨æ€§ï¼Œä»¥åŠ redis çš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“</li>
<li>AOF é‡å†™æ˜¯ä¸ºäº†ç”¨æ›´å°çš„ä½“ç§¯æ¥ä¿å­˜æ•°æ®åº“çŠ¶æ€</li>
</ul>
<h3 id="äº‹ä»¶ï¼š"><a href="#äº‹ä»¶ï¼š" class="headerlink" title="äº‹ä»¶ï¼š"></a>äº‹ä»¶ï¼š</h3><ul>
<li>redis çš„äº‹ä»¶åˆ†ä¸ºæ—¶é—´äº‹ä»¶å’Œæ–‡ä»¶äº‹ä»¶</li>
<li>æ–‡ä»¶äº‹ä»¶åˆ†ä¸ºè¯»äº‹ä»¶å’Œå†™äº‹ä»¶ï¼šè¯»äº‹ä»¶å®ç°äº†å‘½ä»¤è¯·æ±‚çš„æ¥å—ï¼Œå†™äº‹ä»¶å®ç°äº†å‘½ä»¤ç»“æœçš„è¿”å›</li>
<li>æ—¶é—´äº‹ä»¶åˆ†ä¸ºå•æ¬¡æ‰§è¡Œäº‹ä»¶å’Œå¾ªç¯æ‰§è¡Œäº‹ä»¶ï¼ŒæœåŠ¡å™¨ serverCron å°±æ˜¯å¾ªç¯äº‹ä»¶</li>
<li>æ–‡ä»¶äº‹ä»¶å’Œæ—¶é—´äº‹ä»¶æ˜¯åˆä½œå…³ç³»ï¼šä¸€ç§äº‹ä»¶ä¼šç­‰å¾…å¦ä¸€ç§äº‹ä»¶å®Œæˆä¹‹åå†æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°æŠ¢å æƒ…å†µ</li>
</ul>
<p>redis è™½ç„¶å¯ä»¥è½åœ°ï¼Œä½†æ¯•ç«Ÿæ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰€ä»¥é€‚ç”¨åœºæ™¯è¿˜ä¸»è¦é›†ä¸­äºå°è€Œçƒ­çš„æ•°æ®ã€‚æˆ‘æƒ³ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¢«å½¢å®¹ä¸ºç‘å£«å†›åˆ€çš„åŸå› ï¼Œä¸èƒ½æŒ‡æœ›å®ƒå»æ”¯æ’‘è¿‡å¤§çš„æ•°æ®é‡ï¼Œé‚£æ˜¯ mongodb,hbase ä»½å†…çš„äº‹ã€‚å¯æƒœçš„æ˜¯ï¼Œç¬”è€…è¿˜æ²¡æœ‰å®æˆ˜è¿‡å¤§æ•°æ®é‡æƒ…å†µä¸‹ä½¿ç”¨ redis æ€§èƒ½ä¼šå¦‚ä½•ï¼Œå·²ç»è¿«ä¸åŠå¾…å•¦ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çœ‹åˆ°æœ‰äººè¿™æ ·å½¢å®¹ redis,åƒä¸€æŠŠç‘å£«å†›åˆ€ï¼Œå°å·§ï¼Œé”‹åˆ©ï¼Œå®ç”¨ã€‚åœ¨ä¹‹å‰å¯¹ redis è™½æœ‰äº†è§£ï¼Œå´æ— æ³•ä½“ä¼šåˆ°è¿™ç§æ„Ÿè§‰ã€‚çœ‹å®Œè¿™æœ¬åŒæ ·ç²¾ç¾çš„ä¹¦ï¼Œéš¾æŠ‘èµèµä¹‹æƒ…ã€‚redis åœ¨å¾ˆå¤šåœºæ™¯ç¡®å®æ˜¯å¾ˆå¥½çš„æ–¹æ¡ˆï¼Œä¸ä»…å¯ä»¥å½“æ•°æ®åº“ç”¨ï¼Œè¿˜å¯ä»¥æ‹¿æ¥å½“æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç¼“å­˜æ¥ä½¿ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œçœ‹å®Œå®ƒçš„è®¾è®¡ä¸å®ç°ï¼Œæ›´èƒ½å¤Ÿæ„è¯†åˆ°ï¼šä»»ä½•ç²¾ç¾çš„æŠ€æœ¯äº§å“éƒ½ä¸æ˜¯é£˜åœ¨äº‘ç«¯ï¼Œå¯æœ›ä¸å¯å³ï¼Œæ·±æŒ–åº•å±‚ï¼Œå°±èƒ½æŒæ¡ä¸€åˆ‡çªé—¨ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ç¬”è€…ä¸€ç›´åšæŒåœ¨åšçš„äº‹ğŸ’ªğŸ¼ï¼‰
    
    </summary>
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="http://xuyajun.cn/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦</title>
    <link href="http://xuyajun.cn/2016/11/16/%E9%99%A4%E4%BA%86%E6%8B%A5%E6%8A%B1%EF%BC%8C%E5%88%AB%E7%9A%84%E9%83%BD%E4%B8%8D%E6%83%B3%E8%A6%81/"/>
    <id>http://xuyajun.cn/2016/11/16/é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦/</id>
    <published>2016-11-16T14:42:18.000Z</published>
    <updated>2016-11-27T10:54:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦"><a href="#é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦" class="headerlink" title="é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦"></a>é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦</h2><h6 id="è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚"><a href="#è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚" class="headerlink" title="è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚"></a>è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚</h6><p>ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä»½å†…å¿ƒç‹¬ç™½ã€‚<a id="more"></a>      </p>
<p>äºä¸‹ä¸ªæœˆå’Œå¾å…ˆæ£®å¼€å¯åœ¨ä¸€èµ·çš„ç¬¬4ä¸ªå¹´å²ã€‚ä¸çŸ¥ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œæˆ‘å·²ä¸å†æ€€æœ‰æ‹çˆ±ä¸­çš„å¥³ç”Ÿæœ€å¤§çš„ç—›è‹¦ï¼Œä¹ æƒ¯äº†ä»–æ—¶æ—¶åˆ»åˆ»è¡¨ç°å¾—åƒåªäºŒè´§ï¼Œå´ä¸å†æœŸå¾…ä»–æ˜¯ä¸ªæ‡‚å¾—æ’©å¦¹çš„ç»…å£«ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘å¹¶ä¸è®¤ä¸ºæˆ‘ä¿©å·²è¿‡äº†çƒ­æ‹æœŸï¼Œç›¸ååœ°ï¼Œæˆ‘ä»¬æ¯”ä»¥å‰æ›´ä¾æ‹å½¼æ­¤ã€‚ </p>
<p><img src="/images/lover.png" alt="alt text">     </p>
<p>å½“ç„¶å’¯ï¼Œæˆ‘ä»¬çš„çˆ±æƒ…ä¹Ÿæ›¾æœ‰è¿‡æ³¢æŠ˜ï¼Œäº‰åµå’Œé—¹åˆ†æ‰‹ä¹Ÿæ›¾æ˜¯å®¶å¸¸ä¾¿é¥­ã€‚åæ¥å¾å…ˆæ£®å°†å…¶å‡å½’ç»“ä¸ºå¹´å°‘ä¸æ‡‚äº‹ï¼ˆè°è¯´ä½ ç°åœ¨æˆç†Ÿäº†ï¼Ÿï¼‰ã€‚     </p>
<p>å¦‚ä»Šè™½åˆ†éš”ä¸¤åœ°ï¼Œæˆ‘ä»¬ä¹‹é—´çš„äº¤æµå´ä¸ä¼šå°‘ï¼Œéå¸¸æ„Ÿè°¢å¾å…ˆæ£®æˆäº†æˆ‘çš„å°å°äººç”Ÿå¯¼å¸ˆï¼Œå¸¸å¸¸ç»™æˆ‘ä¸å¯ä¼°çš„åŠ›é‡ã€‚å½“æˆ‘åˆæ¥å¤©æ´¥ï¼Œ åœ¨è¿™é™Œç”Ÿçš„åŸå¸‚é‡Œï¼Œæˆ‘å¹¶ä¸æ˜¯ä¸€ä¸ªäººè¿·èŒ«ï¼Œä¸€ä¸ªäººå­¤å•ï¼Œä¸€ä¸ªäººå‹æŠ‘ï¼Œä¸€ä¸ªäººåŠªåŠ›ã€‚æˆ‘æœ‰å¾å…ˆæ£®ï¼Œä»–é™ªç€æˆ‘æ¸¡è¿‡è‰°éš¾çš„æ—¥å­ï¼Œç»™æˆ‘å‰è¿›çš„æ–¹å‘ã€‚æ‰€ä»¥ï¼Œæˆ‘æ˜¯å¹¸è¿çš„ã€‚æˆ‘ä¸€ç›´è®¤ä¸ºä¸¤ä¸ªäººåœ¨ä¸€èµ·å…‰å‡­â€œä½ å–œæ¬¢æˆ‘ï¼Œæ°å¥½æˆ‘ä¹Ÿå–œæ¬¢ä½ â€æ˜¯ä¸å¤Ÿçš„ï¼Œå¿…é¡»è¦æœ‰ç›¸åŒçš„ä¸–ç•Œè§‚å’Œä»·å€¼è§‚ã€‚ä¸€æ–¹é¢ï¼Œå¾å…ˆæ£®æœ€è¿‘ç ”ç©¶çš„å“²å­¦æˆ‘è™½ä¸ç”šæ„Ÿå…´è¶£ï¼Œå´ä¹Ÿæ½œç§»é»˜åŒ–åœ°æ”¹å˜äº†æˆ‘ä¿©çš„ç›¸å¤„æ¨¡å¼ï¼Œæˆ‘è§‰å¾—ä»–è¶Šæ¥è¶Šæœ‰è´£ä»»æ„Ÿã€‚æˆ‘ä»¬éƒ½çŸ¥é“æ‰¾æœ‰è´£ä»»æ„Ÿçš„ç”·æœ‹å‹ï¼Œç„¶è€Œï¼Œè´£ä»»æ„Ÿå°±åƒâ€œè‡ªæˆ‘â€ä¸€æ ·ï¼Œæ˜¯å¾ˆéš¾è§¦æ‘¸åˆ°çš„ä¸œè¥¿ã€‚ä½ ä¸èƒ½å¬ä¿¡ç”·ç”Ÿçš„è¯´è¾ï¼Œè€Œæ˜¯è¦è‡ªå·±å»çœ‹å»æ€è€ƒã€‚æˆ‘è®¤ä¸ºåšæŒï¼Œå¯¹äºç”·äººè€Œè¨€ï¼Œå°±æ˜¯è´£ä»»æ„Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œå¬è¿‡æœ€å¥½çš„æƒ…è¯æ˜¯ï¼šæˆ‘æƒ³å’Œä½ ä¸€èµ·å‘å‰åŠªåŠ›ã€‚ç»´æŒæ‹çˆ±å…³ç³»å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ä¸¤ä¸ªäººå¿…é¡»éƒ½æœ‰è¶³å¤Ÿçš„åŠ¨åŠ›ç›¸äº’æ‰¶æŒèµ°ä¸‹å»ï¼Œè¿½æ±‚æ›´ç¾å¥½çš„ç”Ÿæ´»ã€‚æœ‰ä¸€ç§è„†å¼±ï¼Œæ˜¯æ€•ä½ é£è¿œå»ï¼Œæ€•ä½ ç¦»æˆ‘è€Œå»ï¼Œæ›´æ€•ä½ æ°¸è¿œåœç•™åœ¨è¿™é‡Œã€‚å¾å…ˆæ£®ç°åœ¨å·²æ˜¯ç¤¾ä¼šäººå£«ï¼Œè€Œæˆ‘è¿˜åœ¨æ ¡å›­ä¸ºå­¦ä¸šå¥‹æˆ˜ï¼Œå¥½åœ¨æˆ‘ä»¬çš„è¯é¢˜æ°¸è¿œä¸æ–­ï¼Œä¸è¯´ä»è¯—è¯æ­Œèµ‹åˆ°äººç”Ÿå“²å­¦ï¼Œå€’ä¹Ÿèƒ½æœ‰ä¸¤äººéƒ½æ„Ÿå…´è¶£çš„çƒ­é—»ã€‚    </p>
<p>å®ä¸ç›¸ç’ï¼Œæˆ‘å¹´å°‘æ—¶æœŸå¾…çš„æµªæ¼«ï¼Œæ˜¯å¯¹æ–¹å½“ä¼—é€èŠ±ï¼Œçœ‹å‘ä½ çš„å˜´è§’æ—¶å§‹ç»ˆå¸¦ç€å® æººçš„ç¬‘â€¦â€¦å‡ å¹´çš„æ‹çˆ±æœŸï¼Œç°åœ¨çš„æˆ‘ï¼ŒæœŸå¾…æ›´å¤šçš„ï¼Œæ˜¯æ¯æ¬¡è§é¢éƒ½èƒ½æœ‰ä¸€ä¸ªå¤§å¤§çš„æ‹¥æŠ±ã€‚é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦&quot;&gt;&lt;a href=&quot;#é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦&quot; class=&quot;headerlink&quot; title=&quot;é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦&quot;&gt;&lt;/a&gt;é™¤äº†æ‹¥æŠ±ï¼Œåˆ«çš„éƒ½ä¸æƒ³è¦&lt;/h2&gt;&lt;h6 id=&quot;è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚&quot;&gt;&lt;a href=&quot;#è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚&quot; class=&quot;headerlink&quot; title=&quot;è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚&quot;&gt;&lt;/a&gt;è°¢è°¢ä½ ï¼Œä»¿ä½›è¿·é›¾æ˜Ÿè¾°ï¼Œæ·±æµ·ç¯å¡”ï¼Œæ¸©æš–æˆ‘æ•´ä¸ªæ¼«é•¿å†¬å¤œã€‚&lt;/h6&gt;&lt;p&gt;ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä»½å†…å¿ƒç‹¬ç™½ã€‚
    
    </summary>
    
      <category term="éº¦åŠ å“å½“å½“" scheme="http://xuyajun.cn/categories/%E9%BA%A6%E5%8A%A0%E5%93%8D%E5%BD%93%E5%BD%93/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-beansï¼ˆannotationï¼‰</title>
    <link href="http://xuyajun.cn/2016/10/23/Spring-beans%EF%BC%88annotation%EF%BC%89/"/>
    <id>http://xuyajun.cn/2016/10/23/Spring-beansï¼ˆannotationï¼‰/</id>
    <published>2016-10-23T13:06:51.000Z</published>
    <updated>2016-12-18T07:06:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶åœ¨å¼€å§‹è¯»æºç ä¹‹å‰å°±é¢„æ–™åˆ°ä¼šæœ‰å¾ˆå¤šéšœç¢ï¼Œä½†æ²¡æƒ³åˆ°éšœç¢å‡ ä¹æ— æ—¶ä¸åœ¨ã€‚ä¸Šç¯‡å¯¹ bean çš„è§£è¯»å°±å¾ˆåƒåŠ›ï¼Œå†™å‡ºæ¥çš„ä¹Ÿæ˜¯è®©è‡ªå·±ä¸æ»¡æ„çš„ç»“æœã€‚è¿™ç¯‡åˆ†ææ³¨è§£æ—¶ï¼Œä¹Ÿæ˜¯èŠ±è´¹äº†ä¸€äº›æ—¶é—´æ‰æŒæ¡äº†ä¸€äº›çš®æ¯›ï¼Œå¾ˆéš¾é©¾é©­æ•´ä¸ªæ€æƒ³å’Œå®ç°æµç¨‹ã€‚å¿ä¸ä½å»çœ‹äº†ä¸‹ã€Š spring æºç æ·±åº¦è§£æã€‹ï¼Œå‘ç°ä½œè€…çš„åˆ†æè§£è¯»è¦æ·±åˆ»å’Œè¯¦ç»†çš„å¤šï¼Œè®©æˆ‘é¡¿æ—¶æœ‰çœ‹ä¸ä¸‹å»ï¼Œå†™ä¸ä¸‹å»çš„é¡¿æŒ«æ„Ÿã€‚è¿˜å¥½ï¼Œæˆ‘ç­‰çŒ¿ç±»ä¸€å‘å–œæ¬¢æŒ‘æˆ˜ï¼Œè‡ªæˆ‘é­ç­–ã€‚ç»§ç»­ç…§ç€è‡ªå·±æ€è·¯å’Œæ°´å¹³å†™ä¸‹å»ï¼Œçœ‹ç»å…¸æºç å’Œçœ‹å¥½ä¹¦ä¸€æ ·ï¼Œå²‚èƒ½ä¸€éå°±æ­¢ã€‚ç›¸ä¿¡è‡ªå·±ç¬¬äºŒæ¬¡ï¼Œç¬¬ä¸‰æ¬¡è¯»æºç çš„æ—¶å€™ï¼Œçœ‹åˆ°çš„æ˜¯æ›´åŠ ç¾ä¸½çš„é£æ™¯ï½<br><a id="more"></a></p>
<h1 id="æ³¨è§£ä¸‰æ­¥èµ°"><a href="#æ³¨è§£ä¸‰æ­¥èµ°" class="headerlink" title="æ³¨è§£ä¸‰æ­¥èµ°"></a>æ³¨è§£ä¸‰æ­¥èµ°</h1><p>å…ˆå›é¡¾ä¸‹ java è‡ªå®šä¹‰æ³¨è§£çš„å®ç°è¿‡ç¨‹ï¼Œæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š  </p>
<ol>
<li>å†™ä¸€ä¸ª @interface å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œå¹¶æŒ‡å®š @Targetï¼Œ@Retentionï¼Œ@Documentedï¼Œ@Inherited</li>
<li>æŒ‰ç…§ @Target çš„èŒƒå›´ï¼Œåœ¨ç±»ä¸­ç”¨ä¸Šè‡ªå®šä¹‰çš„æ³¨è§£</li>
<li>ä½¿ç”¨åå°„æŠ€æœ¯æ¥è§£æ java ç±»çš„æ³¨è§£ï¼Œå¹¶åšå¤„ç†</li>
</ol>
<p>okï¼Œè¿›å…¥æ­£é¢˜ã€‚beans ä¸­å®šä¹‰çš„æ³¨è§£æœ‰ Autowired,Qualifier,Configurable,Required,Valueã€‚è¿™é‡Œ Autowired æœ€ä¸ºå…³é”®å’Œå…·æœ‰ä»£è¡¨æ€§ã€‚</p>
<h1 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h1><p>@Autowired çš„å®šä¹‰å¾ˆç®€å•ï¼Œç›´æ¥æ¥çœ‹ä¸‹å¯¹åº”å¤„ç†ç±» AutowiredAnnotationBeanPostProcessor çš„ç±»å›¾ï¼š<img src="/images/AutowiredAnnotationBeanPostProcessor.png" alt="alt text"></p>
<ul>
<li>BeanPostProcessorï¼šå®šä¹‰äº† postProcessBeforeInitialization å’Œ postProcessAfterInitializationä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å¯¹å®ä¾‹ bean ä¹‹å‰å’Œä¹‹ååšé€»è¾‘å¤„ç†ã€‚</li>
<li>InstantiationAwareBeanPostProcessorï¼šè¯¥æ¥å£æ˜¯ BeanPostProcessor çš„å­æ¥å£ï¼ŒpostProcessBeforeInstantiation æ–¹æ³•ç”¨äºé˜»æ­¢åˆ¶å®š bean çš„å®ä¾‹åŒ–ï¼Œç”¨äºæ‡’åŠ è½½ç­‰æƒ…å†µã€‚postProcessPropertyValues æ–¹æ³•ç”¨äºè¿”å›ç»™å®šå±æ€§å€¼çš„ beanã€‚ </li>
<li>SmartInstantiationAwareBeanPostProcessorï¼š  InstantiationAwareBeanPostProcessorçš„å­æ¥å£ã€‚å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è·å–  bean çš„æ„é€ æ–¹æ³•ï¼Œbean çš„ç±»å‹å’Œå¼•ç”¨ã€‚ï¼ˆè¿™ç§ä¸€å±‚ä¸€å±‚çš„æ¥å£åœ¨æºç ä¸­å¤ªå¤šäº†ï¼Œä½“ç°äº†å•ä¸€èŒè´£åŸåˆ™ï¼Œä½†è¦ç†è§£æ¯ä¸ªæ¥å£çš„ç‹¬ç‰¹æ€§è¿˜è¦å»åƒé€æ¯ä¸ªæ¥å£æ–¹æ³•çš„å®ç°ğŸ˜­ï¼‰</li>
<li>InstantiationAwareBeanPostProcessorAdapterï¼šæŠ½è±¡ç±»ï¼Œå®ç°äº†SmartInstantiationAwareBeanPostProcessorï¼Œè¿™æ ·å­ç±»ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»å°±å¯ä»¥åªé‡å†™æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œä¸éœ€è¦å»å®ç°æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•ã€‚</li>
<li>MergedBeanDefinitionPostProcessorï¼šå®šä¹‰postProcessMergedBeanDefinition æ–¹æ³•ï¼Œç”¨æ¥å°†ä¸€ä¸ª BeanDefinition åˆå¹¶åˆ°æŒ‡å®š bean ã€‚</li>
<li>Awareï¼šè¿™ä¸ªæ¥å£æ²¡æœ‰æ–¹æ³•ï¼Œåªæ˜¯ç”¨æ¥æ ‡è®°ä¸ºé¡¶çº§æ¥å£ï¼Œè¢«æ ‡è®°çš„ bean å¯ä»¥æŒ‡å®šæ–¹æ³•è¢« spring æ¡†æ¶å›è°ƒã€‚</li>
<li>BeanFactoryAwareï¼šåªæœ‰ setBeanFactory æ–¹æ³•ï¼Œä¸º bean å®ä¾‹æä¾› factoryã€‚</li>
<li>Orderedï¼šç”¨æ¥è¢«éœ€è¦æ’åºï¼ŒåŒºåˆ†ä¼˜å…ˆçº§çš„å¯¹è±¡ç»§æ‰¿å®ç°ã€‚æ³¨æ„ï¼šgetOrder() æ–¹æ³•è¿”å›çš„å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šå°ã€‚</li>
<li>PriorityOrderedï¼šåªæ˜¯ç»§æ‰¿äº† Ordered æ¥å£ï¼Œæ— æ–¹æ³•ï¼Œç”¨æ¥è¢«ç»§æ‰¿å®ç°å…ˆç¡®å®šä¼˜å…ˆå¯¹è±¡ï¼Œè€Œä¸å¿…ç®¡å‰©ä½™å¯¹è±¡ã€‚</li>
<li><p>AutowiredAnnotationBeanPostProcessorï¼šä»‹ç»ä¸‹å‡ ä¸ªé‡è¦çš„æ–¹æ³•</p>
<ol>
<li>determineCandidateConstructorsï¼šæŸ¥çœ‹ç±»çš„æ„é€ å‡½æ•°æ˜¯å¦æœ‰ @Autowired æ³¨è§£ï¼Œå¹¶ä¸”åšäº†æ£€éªŒï¼šè¢«æ³¨è§£äº†çš„æ„é€ å‡½æ•°å¿…é¡»æœ‰å‚æ•°å¹¶ä¸”æœ€å¤šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°èƒ½è¢«è®¾ç½®æˆ requiredï¼trueã€‚æœ€ç»ˆå‡½æ•°è¿”å›ç©ºæˆ–è€…æ„é€ å‡½æ•°æ•°ç»„ã€‚</li>
<li>buildAutowiringMetadataï¼šå¯¹æŒ‡å®šçš„ classï¼ŒæŸ¥æ‰¾è¿™ä¸ª class å’Œå…¶superclassï¼ˆä¸€ç›´åˆ° superclass ä¸º null æ­¢ï¼‰ çš„æ‰€æœ‰åŠ äº† Autowired æ³¨è§£çš„å­—æ®µå’Œæ–¹æ³•ï¼ˆå¦‚æœæ˜¯æ¡¥æ¥æ–¹æ³•ï¼Œéœ€è¦æ‰¾åˆ°åŸå§‹æ–¹æ³•ï¼‰ï¼Œæœ€åæ„é€ æˆ InjectionMetadata å¯¹è±¡è¿”å›ã€‚</li>
<li><p>findAutowiringMetadataï¼š</p>
<pre><code>InjectionMetadata metadata = this.injectionMetadataCache.get(cacheKey);
  if (InjectionMetadata.needsRefresh(metadata, clazz)) {
     synchronized (this.injectionMetadataCache) {
        metadata = this.injectionMetadataCache.get(cacheKey);
        if (InjectionMetadata.needsRefresh(metadata, clazz)) {
           if (metadata != null) {
              metadata.clear(pvs);
           }
           metadata = buildAutowiringMetadata(clazz);
           this.injectionMetadataCache.put(cacheKey, metadata);
        }
     }
  }
</code></pre><p>åŒæ£€é”ï¼ˆæºç é‡Œå¾ˆå¸¸è§ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨ buildAutowiringMetadata æ–¹æ³• è¿”å› InjectionMetadata å¹¶ç¼“å­˜èµ·æ¥ã€‚</p>
</li>
</ol>
</li>
</ul>
<h1 id="PostConstruct-amp-PreDestroy"><a href="#PostConstruct-amp-PreDestroy" class="headerlink" title="@PostConstruct &amp; @PreDestroy"></a>@PostConstruct &amp; @PreDestroy</h1><p>åœ¨ annotation åŒ…ä¸‹ï¼Œé™¤äº†å¸¸ç”¨çš„å‡ ä¸ªæ³¨è§£ç›¸å…³ç±»å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç±» InitDestroyAnnotationBeanPostProcessor ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ InitializingBean å’Œ DisposableBean çš„ç”¨æ³•ï¼Œä½†å®˜ç½‘æœ‰å¥è¯ï¼š</p>
<blockquote>
<p>It is recommended that you do not use the InitializingBean interface because it unnecessarily couples the code to Spring.</p>
</blockquote>
<p>æ˜¯çš„ï¼Œæˆ‘ä»¬æ›´è¢«å»ºè®®ä½¿ç”¨ xml é…ç½®æˆ–è€…åœ¨ java ä»£ç é‡Œé…ç½®æ¥å®ç°åˆå§‹åŒ–æ–¹æ³•å’Œé”€æ¯ bean å‰é’©å­æ–¹æ³•ã€‚è€Œ InitDestroyAnnotationBeanPostProcessor å°±æ˜¯ç”¨æ¥æ£€æµ‹ bean çš„è¿™ä¸¤ç§æ–¹æ³•ï¼ˆåˆ†åˆ«è¢« @PostConstruct å’Œ @PreDestroy æ³¨è§£ï¼‰å¹¶ä½¿ç”¨åå°„è°ƒç”¨ã€‚</p>
<p>æ¥å‰–æä¸‹å‡ ä¸ªé‡è¦æ–¹æ³•ï¼š</p>
<ol>
<li><p>buildLifecycleMetadataï¼šå¯¹æŒ‡å®šçš„ classï¼ŒæŸ¥æ‰¾è¿™ä¸ª class å’Œå…¶superclassï¼ˆä¸€ç›´åˆ° superclass ä¸º null æ­¢ï¼‰ çš„æ‰€æœ‰ initAnnotationType å’Œ destroyAnnotationType æ–¹æ³•ã€‚æœ€ç»ˆè¿”å› LifecycleMetadata ã€‚å…³äºinitAnnotationType å’Œ destroyAnnotationType ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Any custom annotation can be used, since there are no required annotation attributes. There is no default, although a typical choice is the JSR-250  javax.annotation.PostConstruct  and javax.annotation.PreDestroy annotation.</p>
</blockquote>
</li>
<li><p>findLifecycleMetadataï¼šè°ƒç”¨ buildLifecycleMetadata æ–¹æ³•è¿”å› LifecycleMetadata å¹¶ç¼“å­˜èµ·æ¥ã€‚  </p>
</li>
<li>postProcessBeforeInitializationï¼šè°ƒç”¨ findLifecycleMetadata æ–¹æ³•æ‹¿åˆ° LifecycleMetadata å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œ invokeInitMethods ï¼Œå³æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ã€‚</li>
<li>postProcessBeforeDestructionï¼šè°ƒç”¨ findLifecycleMetadata æ–¹æ³•æ‹¿åˆ° LifecycleMetadata å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œ invokeDestroyMethods ï¼Œå³æ‰§è¡Œé”€æ¯å‰çš„é’©å­æ–¹æ³•ã€‚</li>
</ol>
<p>çœ‹äº†è¿™ä¸¤ä¸ªç±»åå°±ä¼šå‘ç°ï¼Œspring ä¸­å¯¹æ³¨è§£çš„å¤„ç†æ–¹æ³•è¿˜æ˜¯æ¯”è¾ƒé€šä¿—æ˜“æ‡‚ã€‚ç„¶è€Œå¼€å§‹çœ‹çš„ä¸€æ®µæ—¶é—´å´æ˜¯æ‡µé€¼ä¸­ï¼Œç›´åˆ°åæ¥æ‰æœ‰æŸ³æš—èŠ±æ˜åˆä¸€æ‘çš„æ„Ÿè§‰ã€‚</p>
<p>beans æ¨¡å—æš‚æ—¶å°±çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘çš„æ‰“ç®—æ˜¯å…ˆå°½å¿«çš„é˜…è¯»å®Œæ¯ä¸ªæ¨¡å—ï¼Œåœ¨è„‘ä¸­å½¢æˆä¸€ä¸ªæ¡†æ¶è½®å»“åï¼Œå†è¿›è¡Œé’ˆå¯¹çš„ç»†è¯»ã€‚å—¯ï¼Œè¯»æºç ï¼Œæˆ‘æ˜¯è®¤çœŸçš„ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è™½ç„¶åœ¨å¼€å§‹è¯»æºç ä¹‹å‰å°±é¢„æ–™åˆ°ä¼šæœ‰å¾ˆå¤šéšœç¢ï¼Œä½†æ²¡æƒ³åˆ°éšœç¢å‡ ä¹æ— æ—¶ä¸åœ¨ã€‚ä¸Šç¯‡å¯¹ bean çš„è§£è¯»å°±å¾ˆåƒåŠ›ï¼Œå†™å‡ºæ¥çš„ä¹Ÿæ˜¯è®©è‡ªå·±ä¸æ»¡æ„çš„ç»“æœã€‚è¿™ç¯‡åˆ†ææ³¨è§£æ—¶ï¼Œä¹Ÿæ˜¯èŠ±è´¹äº†ä¸€äº›æ—¶é—´æ‰æŒæ¡äº†ä¸€äº›çš®æ¯›ï¼Œå¾ˆéš¾é©¾é©­æ•´ä¸ªæ€æƒ³å’Œå®ç°æµç¨‹ã€‚å¿ä¸ä½å»çœ‹äº†ä¸‹ã€Š spring æºç æ·±åº¦è§£æã€‹ï¼Œå‘ç°ä½œè€…çš„åˆ†æè§£è¯»è¦æ·±åˆ»å’Œè¯¦ç»†çš„å¤šï¼Œè®©æˆ‘é¡¿æ—¶æœ‰çœ‹ä¸ä¸‹å»ï¼Œå†™ä¸ä¸‹å»çš„é¡¿æŒ«æ„Ÿã€‚è¿˜å¥½ï¼Œæˆ‘ç­‰çŒ¿ç±»ä¸€å‘å–œæ¬¢æŒ‘æˆ˜ï¼Œè‡ªæˆ‘é­ç­–ã€‚ç»§ç»­ç…§ç€è‡ªå·±æ€è·¯å’Œæ°´å¹³å†™ä¸‹å»ï¼Œçœ‹ç»å…¸æºç å’Œçœ‹å¥½ä¹¦ä¸€æ ·ï¼Œå²‚èƒ½ä¸€éå°±æ­¢ã€‚ç›¸ä¿¡è‡ªå·±ç¬¬äºŒæ¬¡ï¼Œç¬¬ä¸‰æ¬¡è¯»æºç çš„æ—¶å€™ï¼Œçœ‹åˆ°çš„æ˜¯æ›´åŠ ç¾ä¸½çš„é£æ™¯ï½&lt;br&gt;
    
    </summary>
    
      <category term="Springæºç " scheme="http://xuyajun.cn/categories/Spring%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Šjavascript domç¼–ç¨‹è‰ºæœ¯ã€‹</title>
    <link href="http://xuyajun.cn/2016/09/30/%E3%80%8Ajavascript%20dom%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF%E3%80%8B/"/>
    <id>http://xuyajun.cn/2016/09/30/ã€Šjavascript domç¼–ç¨‹è‰ºæœ¯ã€‹/</id>
    <published>2016-09-30T13:43:42.000Z</published>
    <updated>2016-09-30T13:49:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;å¾ˆå¤šäººéƒ½è®¤ä¸ºå‰ç«¯çš„å…¥é—¨é—¨æ§›å¾ˆä½ï¼Œè°è¿˜æ²¡å†™è¿‡ html,cssï¼Œjsã€‚ä¹‹å‰è‡ªå·±åšé¡¹ç›®å½“ä¸å¾—ä¸å†™å‰ç«¯çš„æ—¶å€™ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªé¡¹ç›®çš„å‰ç«¯ä»£ç ï¼Œç…§çŒ«ç”»è™ï¼Œå‘ç°ä¹Ÿèƒ½è¿…é€Ÿçš„å®ç°éœ€æ±‚ã€‚jqueryï¼Œbootstrapï¼Œfreemarket éƒ½ç”¨ä¸Šäº†ã€‚<a id="more"></a><br>&emsp;&emsp;ä½†éšç€ä¸æ–­æ¥è§¦åˆ«äººå†™çš„å‰ç«¯ä»£ç ï¼Œè¶Šæ¥è¶Šæ— åŠ›åæ§½ã€‚å‡ ä¹éƒ½æœ‰è‡ªå·±çš„é£æ ¼ï¼Œå®Œå…¨æ²¡æ³•çœ‹ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨å¤§å­¦æ—¶æœŸå¾ˆæŠµè§¦å†™å‰ç«¯çš„åŸå› ã€‚è¿˜å¥½ï¼Œéšç€æ¥è§¦ä¼˜ç§€çš„å‰ç«¯ coderï¼Œè®©æˆ‘é‡æ‹¾äº†å¯¹å‰ç«¯çš„çƒ­æƒ…ã€‚<br>&emsp;&emsp;ã€Š javascript dom ç¼–ç¨‹è‰ºæœ¯ã€‹è¿™æœ¬æ˜¯æˆ‘å®Œæ•´çœ‹çš„ç¬¬ä¸€æœ¬å‰ç«¯çš„ä¹¦ç±ã€‚psï¼šå…³äºå­¦ä¹ ï¼Œå¾ˆå¤šäººä¹ æƒ¯ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·æ¥è·å–ç¢ç‰‡åŒ–çŸ¥è¯†ã€‚ä½†æˆ‘æœ¬äººæ›´çˆ±å¥½ç³»ç»Ÿçš„è¯»ä¹¦ï¼ŒæŒæ¡æŸä¸€æ–¹é¢çš„çŸ¥è¯†å¿…é¡»è¦åœ¨è„‘ä¸­å»ºç«‹å®Œæ•´çš„å›¾è°±ã€‚ç¢ç‰‡åŒ–çŸ¥è¯†åšä¸åˆ°è¿™ç‚¹ï¼Œæˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººè‡ªè®¤ä¸ºæ‡‚å¾—å¾ˆå¤šé“ç†å´è¿‡ä¸å¥½ç”Ÿæ´»ï¼Œåšä¸å¥½äº‹çš„åŸå› ã€‚ç¢ç‰‡åŒ–çŸ¥è¯†è®©ä½ äº§ç”Ÿé”™è§‰ï¼Œåªå¸æ”¶äº†ç»“æœï¼Œå´æ²¡æœ‰å»èµ°ä¸€éè¿‡ç¨‹ï¼Œä½ å¹¶æ²¡æœ‰æŒæ¡çŸ¥è¯†ã€‚<br>&emsp;&emsp;è¿™æœ¬ä¹¦å†™çš„å¾ˆåŸºç¡€ï¼Œä½†å´æ˜¯å…¥é—¨å‰ç«¯çš„ç»ä½³ä¹¦ç±ã€‚é™¤äº†å¯¹ jsï¼Œdom çš„æ‰«ç›²å¤–ï¼Œæ›´é‡è¦çš„æ˜¯è¿™æœ¬ä¹¦ä¼šè®©ä½ åœ¨ä¸€å¼€å§‹å°±æ ‘ç«‹è§„èŒƒæ„è¯†ã€‚ä¸‹é¢æ˜¯æˆ‘æ€»ç»“æˆ–è€…æ‘˜æŠ„è‡ªåŸä¹¦çš„ç¬”è®°ï¼š</p>
<ul>
<li>jsæ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œä¸éœ€è¦åƒjavaç­‰å¼ºç±»å‹è¯­è¨€ä¸€æ ·ï¼Œéœ€è¦æŒ‡å®šå˜é‡çš„æ•°æ®ç±»å‹ã€‚è¿™ç§è®¾è®¡è¢«è¶Šæ¥è¶Šå¤šçš„è¯­è¨€æ”¯æŒï¼Œæœ‰åˆ©æœ‰å¼Šã€‚coder å¯ä»¥æ›´åŠ è‡ªç”±çš„ç¼–ç ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥è¢«éšæ„æ”¹å˜æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å¦‚æœç¨æœ‰ä¸æ…ï¼Œå°±ä¼šå‡ºç°é”™è¯¯ã€‚è€Œä¸”è¿™ç§é”™è¯¯åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šçŸ¥é“ï¼Œä¸åƒå¼ºç±»å‹è¯­è¨€åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥æŠ¥é”™ã€‚</li>
<li>js ä¸­çš„æ‰€æœ‰äº‹ç‰©éƒ½æ˜¯å¯¹è±¡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€æ•°å€¼ã€æ•°ç»„ã€å‡½æ•°ã€‚js ä¸åƒ  java æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»æ¥åˆ›å»ºå¯¹è±¡ï¼Œjs çš„å¯¹è±¡åŸºäº prototypeã€‚è¿™æœ¬ä¹¦å¯¹æ­¤æ²¡æœ‰è¿‡å¤šè®²å™ï¼Œåˆ°åé¢æˆ‘è¯»ä¸‹æœ¬ä¹¦å½»åº•ç†è§£äº†å†æ€»ç»“ã€‚  </li>
<li>dom ç”¨æ¥è§£æç»“æ„åŒ–æ–‡æœ¬ï¼Œæ¯”å¦‚ htmlï¼xmlã€‚æµè§ˆå™¨ä¼šå°† html ä¸­çš„å…ƒç´ è§£ææˆ dom æ ‘ã€‚dom æœ‰å…ƒç´ èŠ‚ç‚¹ï¼Œæ–‡æœ¬èŠ‚ç‚¹ï¼Œå±æ€§èŠ‚ç‚¹ä¸‰ç§ä¸»è¦èŠ‚ç‚¹ã€‚dom å¯¹å¤–æä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œç”¨æ¥è·å–æˆ–è€…ä¿®æ”¹èŠ‚ç‚¹çš„å±æ€§ã€‚å¸¸è§çš„æœ‰ getElementById()ï¼ŒgetElementByTagName()ï¼ŒgetAttribute()ï¼ŒchildNodesç­‰ã€‚js é€šè¿‡è°ƒç”¨ dom æ¥åŠ¨æ€å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ã€‚  </li>
<li><p>é™¤äº† dom core æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ html-dom æä¾›çš„æ–¹æ³•æ¥ç®€åŒ–ã€‚</p>
<pre><code>&gt;dom core æ–¹æ³•ï¼šobj.setAttribute(&quot;src&quot;,source)        
&gt;html-dom æ–¹æ³•ï¼šobj.src=source
</code></pre><p>  ä½†æ˜¯è¦æ³¨æ„ï¼Œdom ä¸ä¸“å±äº html å’Œ jsï¼Œå¹¶ä¸”ï¼Œhtml-dom æ˜¯ dom      ç»Ÿä¸€æµè§ˆå™¨ä¹‹å‰å°±å‡ºç°çš„ï¼Œåªé€‚ç”¨äºå¤„ç† web æ–‡æ¡£ã€‚  </p>
</li>
<li>html è´Ÿè´£ç»“æ„å±‚ï¼Œjs è´Ÿè´£è¡Œä¸ºå±‚ï¼Œcss è´Ÿè´£æ ·å¼å±‚æ˜¯åŸºç¡€åŸåˆ™ï¼Œä¹‹æ‰€æœ‰å¾ˆå¤šå‰ç«¯ä»£ç çœ‹èµ·æ¥å›°éš¾å°±æ˜¯å› ä¸ºæ²¡æœ‰å¾ˆå¥½çš„æ‰§è¡Œè¿™ä¸ªåŸåˆ™ã€‚  </li>
<li>è¦å……åˆ†è€ƒè™‘ç”¨æˆ·ç¦ç”¨æµè§ˆå™¨ js çš„æƒ…å†µã€‚</li>
</ul>
<p>&emsp;&emsp;è¿™æœ¬ä¹¦é€‚åˆå…¥é—¨ï¼Œä½†æ·±åº¦ä¸å¤Ÿï¼Œæƒ³è¦æˆä¸ºä¸“ä¸šçš„å‰ç«¯è¿˜éœ€è¦æ›´æ·±å…¥çš„å»äº†è§£ jsã€‚ä¸‹æœ¬å‡†å¤‡è¯» js çš„æ•°æ®ç»“æ„ç›¸å…³çš„ï¼Œé™å€™ï½</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;emsp;&amp;emsp;å¾ˆå¤šäººéƒ½è®¤ä¸ºå‰ç«¯çš„å…¥é—¨é—¨æ§›å¾ˆä½ï¼Œè°è¿˜æ²¡å†™è¿‡ html,cssï¼Œjsã€‚ä¹‹å‰è‡ªå·±åšé¡¹ç›®å½“ä¸å¾—ä¸å†™å‰ç«¯çš„æ—¶å€™ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªé¡¹ç›®çš„å‰ç«¯ä»£ç ï¼Œç…§çŒ«ç”»è™ï¼Œå‘ç°ä¹Ÿèƒ½è¿…é€Ÿçš„å®ç°éœ€æ±‚ã€‚jqueryï¼Œbootstrapï¼Œfreemarket éƒ½ç”¨ä¸Šäº†ã€‚
    
    </summary>
    
      <category term="è¯»ä¹¦ç¬”è®°" scheme="http://xuyajun.cn/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
  </entry>
  
  <entry>
    <title>Spring-beansï¼ˆbeanï¼‰</title>
    <link href="http://xuyajun.cn/2016/09/24/Spring-beans%EF%BC%88bean%EF%BC%89/"/>
    <id>http://xuyajun.cn/2016/09/24/Spring-beansï¼ˆbeanï¼‰/</id>
    <published>2016-09-24T11:05:20.000Z</published>
    <updated>2016-10-23T13:33:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆæ„Ÿè°¢ã€Š spring æºç æ·±åº¦è§£æã€‹è¿™æœ¬ä¹¦ï¼Œå› ä¸ºçŸ¥é“å·²ç»æœ‰å‰è¾ˆæ•´ç†äº†é˜…è¯»ç»éªŒï¼Œè®©æˆ‘æ›´åŠ èƒ½å¤ŸåšæŒå°†æºç è¿›è¡Œåˆ°åº•ã€‚ä½†ä¸ºäº†è¾¾åˆ°é”»ç‚¼è‡ªå·±æœ€å¤§åŒ–ï¼Œæˆ‘è¿˜æ˜¯å†³å®šä¸ç›´æ¥å»è¯»ï¼Œå…ˆæŒ‰ç…§è‡ªå·±çš„æ€è·¯æ¥ã€‚åªæœ‰åœ¨ä¸çŸ¥é“æ€ä¹ˆç»§ç»­ä¸‹å»çš„æ—¶å€™æ‰å€Ÿé‰´ä¸€ä¸‹å‰è¾ˆçš„ç»éªŒã€‚<br><a id="more"></a></p>
<h1 id="å…ˆåšç‚¹å‡†å¤‡å·¥ä½œï¼š"><a href="#å…ˆåšç‚¹å‡†å¤‡å·¥ä½œï¼š" class="headerlink" title="å…ˆåšç‚¹å‡†å¤‡å·¥ä½œï¼š"></a>å…ˆåšç‚¹å‡†å¤‡å·¥ä½œï¼š</h1><p>1.ä¸‹è½½ spring æºç ï¼Œé€‰æ‹©çš„æ˜¯ 3.2.15 ç‰ˆæœ¬ã€‚<br>2.å› ä¸º spring å·²ç»ç”± maven è½¬å‘ gradle,æ‰€ä»¥éœ€è¦è¾ƒä¸ºæ·±åˆ»çš„äº†è§£ä¸‹ gradleã€‚é€šè¿‡ gradle æŸ¥çœ‹ä¾èµ–æ ‘ï¼Œä»æ•´ä½“ä¸Šå¼„æ¸…æ¯ä¸ªæ¨¡å—çš„å…³ç³»å’ŒåŠŸèƒ½ã€‚<br>3.gradle ç¼–è¯‘æºç é‡åˆ°é—®é¢˜ï¼šâ€A problem occurred configuring project â€˜ï¼šspring-orm-hibernate4â€™â€ï¼Œé€šè¿‡ Googleï¼Œè¿™ä¸ªè²Œä¼¼æ˜¯ 3.2 ç‰ˆæœ¬å’Œ gradle ç‰ˆæœ¬çš„ä¸å…¼å®¹é€ æˆçš„ã€‚å…ˆä¸æŠ˜è…¾ï¼Œæ³¨é‡Šæ‰ merge.into è¯­å¥ã€‚<br>4.å°†æºç æ–‡ä»¶å¤¹æ”¹ä¸ºåªè¯»ï¼Œé˜²æ­¢ä¸å°å¿ƒä¿®æ”¹ã€‚<br>   <code>chmod -R 555 spring-framework-3.2.15.RELEASE</code></p>
<h1 id="Beanï¼š"><a href="#Beanï¼š" class="headerlink" title="Beanï¼š"></a>Beanï¼š</h1><p>å¼€å§‹è‚¯å®šæ˜¯å…ˆæ‰¾åˆ°ä¸€ä¸ªåˆ‡å…¥ç±»ï¼Œæˆ‘çš„åšæ³•æ˜¯å¿«é€Ÿæµè§ˆä¸€ä¸‹é¡¹ç›®çš„ç»“æ„ï¼Œç†Ÿæ‚‰æ¯ä¸ª package å¤§æ¦‚æ˜¯ä»€ä¹ˆåŠŸèƒ½ã€‚æ¯”å¦‚ Spring-beans ç»“æ„ç”± annotationï¼Œfactoryï¼Œpropertyeditorsï¼Œsupport å‡ ä¸ªåŒ…ç»„æˆï¼Œè¿˜æœ‰å¾ˆå¤šæœªæ”¾å…¥åŒ…çš„ç±»ï¼Œä¸è¿‡ï¼Œä¸€çœ‹ç±»åå°±çŸ¥é“å¤§æ¦‚æ˜¯å·¥å…·ç±»å’Œè‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ã€‚è‡³äºå‡ ä¸ª packageï¼Œannotation é‡Œé¢å®šä¹‰äº†ä¸€äº›æ³¨è§£ï¼Œpropertyeditors å®šä¹‰äº†æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œsupport æä¾›äº†å¯¹ bean æ’åºç­‰çš„ä¸€äº›æ”¯æŒåŠŸèƒ½ï¼Œç»§ç»­å±•å¼€ factoryï¼Œç»ˆäºæ‰¾åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„ç±» XmlBeanFactoryã€‚<br>ç›¸ä¿¡å¤§å®¶åˆšå¼€å§‹å­¦ä¹  spring çš„æ—¶å€™è‚¯å®šå†™è¿‡è¿™è¡Œä»£ç ï¼š<br><code>BeanFactory factory = new XmlBeanFactory(new ClassPathResource(&quot;applicationContext.xml&quot;));</code><br>æ‰“å¼€å‘ç°è¯¥ç±»å·²ç» @Deprecatedï¼Œè°·æ­Œäº†ä¸€ä¸‹ï¼Œå’ŒçŒœæƒ³çš„ä¸€æ ·ï¼Œ3.1 ç‰ˆæœ¬å·²ç»è¢« applicationcontext æ›¿æ¢ã€‚<br><code>BeanFactory factory = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</code><br>è€Œ applicationcontext å±äº context æ¨¡å—ä¸‹ï¼Œä½†è¿˜æ˜¯åŸºäº beans æ¨¡å—å®ç°çš„ã€‚ä¸ç®¡ï¼Œå…ˆç ”ç©¶ä¸‹ XmlBeanFactoryã€‚</p>
<h2 id="åˆ›å»º-bean"><a href="#åˆ›å»º-bean" class="headerlink" title="åˆ›å»º bean"></a>åˆ›å»º bean</h2><p>ç”¨ idea æ˜¾ç¤ºå‡º XmlBeanFactory çš„ç±»å›¾ï¼š<img src="/images/XmlBeanFactory.png" alt="alt text"></p>
<p>ok,ä» BeanFactory å…¥æ‰‹ï¼Œçœ‹çœ‹ bean æ€ä¹ˆè¢«ç”Ÿäº§çš„ï¼Œæ–¹æ³•å¦‚å›¾ï¼š<img src="/images/BeanFactory.png" alt="alt text">å…¸å‹çš„å·¥å‚æ¨¡å¼ï¼Œè¿™ä¸ªå°±æ˜¯åˆ›å»º bean çš„é¡¶çº§å·¥å‚ã€‚<br>BeanFactory æœ‰ä¸‰ä¸ªç›´æ¥å­ç±»ï¼Œä¹Ÿéƒ½æ˜¯æ¥å£ï¼Œåˆæ­¥çœ‹äº†ä¸€ä¸‹ï¼Œå¯¹åº”çš„åŠŸèƒ½åˆ†åˆ«å¦‚ä¸‹ï¼š  </p>
<ul>
<li>ListableBeanFactoryï¼š å¯æ‰¹é‡åˆ›å»º beanï¼Œè·å– bean ä¿¡æ¯</li>
<li>HierarchicalBeanFactoryï¼š ä½¿ beanfactory å…·æœ‰ç»§æ‰¿æ€§</li>
<li>AutowireCapableBeanFactoryï¼š å®šä¹‰äº†è‡ªåŠ¨è£…é…çš„ç­–ç•¥  </li>
</ul>
<p>å†çœ‹ä¸‹ç±»å›¾å·¦è¾¹çš„å‡ ä¸ªæ¥å£ï¼Œå®¹æ˜“ç†è§£ã€‚</p>
<ul>
<li>AliasRegistryï¼šæä¾›äº†åˆ«åç®¡ç†</li>
<li>BeanDefinitionRegistryï¼š AliasRegistry çš„å­æ¥å£ï¼Œä¸»è¦ç”¨æ¥æ³¨å†Œ bean</li>
<li>SimpleAliasRegistryï¼š AliasRegistry æ¥å£çš„ç®€å•å®ç°ç±»ï¼Œä½¿ç”¨keyå’Œvalueéƒ½æ˜¯ String çš„ map å¯¹åˆ«åè¿›è¡Œå­˜å‚¨ï¼Œåˆ é™¤ç­‰æ“ä½œã€‚  </li>
<li>SingletonBeanRegistryï¼š å¦ä¸€ä¸ªé¡¶çº§æ¥å£,ç”¨æ¥æ³¨å†Œ singleton çš„ beanã€‚</li>
</ul>
<p>ç±»å›¾ä¸­å…¶ä»–ç±»éƒ½æ˜¯ç”±è¿™å‡ ä¸ªæ¥å£è¡ç”Ÿå‡ºæ¥ï¼Œä½†æ˜“çœ‹å‡ºï¼Œæ‰€æœ‰çš„æ¥å£æœ€åéƒ½åœ¨ DefaultListableBeanFactory ç±»ä¸­å®ç°ã€‚å…ˆä¸ç»†çœ‹è¿™ä¸€åƒå¤šè¡Œä»£ç ï¼Œåˆæ­¥äº†è§£äº† beanfactory çš„ç»§æ‰¿å›¾å’ŒåŠŸèƒ½å°±è¡Œã€‚</p>
<h2 id="å®šä¹‰-bean"><a href="#å®šä¹‰-bean" class="headerlink" title="å®šä¹‰ bean"></a>å®šä¹‰ bean</h2><p>é‚£æ¥ä¸‹æ¥çœ‹å•¥ï¼Œçœ‹ Bean æ€ä¹ˆè¢«å®šä¹‰çš„ã€‚åœ¨ BeanDefinitionRegistry ä¸­æ³¨å†Œ bean æ—¶ï¼Œä½¿ç”¨äº† BeanDefinitionã€‚<br>æ‰¾åˆ°å…¶ä¸€ä¸ªå­ç±» RootBeanDefinition æ¥çœ‹çœ‹ç±»å›¾ï¼š<img src="/images/RootBeanDefinition.png" alt="alt text"><br>çœ‹ä¸‹å„ä¸ªæ¥å£çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>AttributeAccessorï¼š å®šä¹‰ bean çš„å±æ€§ï¼ˆå­—æ®µ)</li>
<li>BeanMetadataElementï¼š åªæœ‰ä¸€ä¸ª getSource() æ–¹æ³•ï¼Œè¿”å›å…ƒæ•°æ®çš„é…ç½®æº</li>
<li>BeanDefinitionï¼š å®šä¹‰äº† bean çš„ç¯å¢ƒå±æ€§ï¼Œæ¯”å¦‚ single/prototypeï¼Œæ˜¯å¦æ‡’åŠ è½½</li>
<li>AttributeAccessorSupportï¼š æä¾›äº† AttributeAccessor æ¥å£çš„ç®€æ˜“å®ç°ï¼Œå­˜å‚¨/åˆ é™¤/åˆ¤æ–­ bean çš„å±æ€§ï¼ˆå­—æ®µï¼‰</li>
<li>BeanMetadataAttributeAccessorï¼š AttributeAccessorSupport ç±»çš„å¢åŠ ç‰ˆï¼Œç”¨ BeanMetadataAttribute å¯¹è±¡ä»£æ›¿äº†Object</li>
<li>AbstractBeanDefinitionï¼šæŠ½è±¡ç±»ï¼Œä¸º GenericBeanDefinitionï¼ŒRootBeanDefinitionï¼ŒChildBeanDefinition ä¸‰ä¸ªå­ç±»æŠ½è±¡å‡ºå…¬å…±çš„æ–¹æ³•å’Œå±æ€§</li>
<li>ChildBeanDefinitionï¼š è®© bean æ‹¥æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ‹¥æœ‰çˆ¶ bean</li>
<li>RootBeanDefinitionï¼š å¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ªå…·æœ‰ç»§æ‰¿å…³ç³» bean çš„åˆæˆä½“</li>
<li>GenericBeanDefinitionï¼š2.5 ç‰ˆæœ¬åå¤§éƒ¨åˆ†åœºæ™¯ä¸‹ç”¨æ¥ä»£æ›¿ ChildBeanDefinitionå’ŒRootBeanDefinitionï¼Œåä¸¤ä¸ªç±»æ›´å€¾å‘äºä½¿ç”¨åœ¨æå‰å†³å®šäº†ç»§æ‰¿å…³ç³»çš„åœºæ™¯ä¸­ï¼Œè€Œ GenericBeanDefinition å¯ä»¥åŠ¨æ€é…ç½®ç»§æ‰¿å…³ç³»</li>
</ul>
<p>å…³äº bean çš„å®šä¹‰å¤§è‡´å¦‚æ­¤ï¼Œå…ˆäº†è§£åˆ°è¿™ï¼Œæ¥çœ‹ä¸‹ bean çš„è§£æã€‚</p>
<h2 id="è§£æ-bean"><a href="#è§£æ-bean" class="headerlink" title="è§£æ bean"></a>è§£æ bean</h2><p>å¯ä»¥é¢„è§ï¼Œå†…éƒ¨çš„æŸä¸ª Reader è¯»å– spring é…ç½®æ–‡ä»¶ï¼Œç„¶åè§£ææˆ BeanDefinition å¯¹è±¡ã€‚åœ¨ XmlBeanFactory ç±»ä¸­å‘ç° XmlBeanDefinitionReaderï¼Œçœ‹ä¸‹ç±»å›¾ï¼š<img src="/images/XmlBeanDefinitionReader.png" alt="alt text"></p>
<ul>
<li>AbstractBeanDefinitionReaderï¼š æŠ½è±¡ç±»ï¼Œå®ç°äº† BeanDefinitionReader æ¥å£ï¼Œä¸º PropertiesBeanDefinitionReader å’Œ XmlBeanDefinitionReader å­ç±»æŠ½è±¡å‡ºå…¬å…±çš„æ–¹æ³•å’Œå±æ€§</li>
</ul>
<p>ä¸ºäº†æ›´å¥½ç†è§£è¿™å‡ ä¸ªç±»ï¼Œéœ€è¦äº†è§£ä¸‹ spring ä¸­å†…éƒ¨å¯¹èµ„æºçš„å¤„ç†ï¼Œè™½ç„¶æ˜¯ core æ¨¡å—ä¸­å®ç°çš„ã€‚  </p>
<ul>
<li>InputStreamSourceï¼š è¯¥æ¥å£åªæœ‰ä¸€ä¸ª getInputStream æ–¹æ³•</li>
<li>Resourceï¼š å°†è¾“å…¥æµåŒ…è£…æˆèµ„æº</li>
<li>AbstractResourceï¼š æŠ½è±¡ç±»ï¼Œç»§æ‰¿ Resource æ¥å£ï¼Œè¿›è¡Œäº†ç®€å•å®ç°ï¼Œä¸åŒæ¥æºçš„èµ„æºæ–‡ä»¶éƒ½ä¼šç»§æ‰¿è¯¥åŸºç±»è¿›è¡Œå„è‡ªçš„å®ç°</li>
<li>WritableResourceï¼š å¢åŠ èµ„æºçš„å†™æ“ä½œ</li>
<li>AbstractFileResolvingResourceï¼š å°† url å½¢å¼çš„è¾“å…¥æµè½¬ä¸ºæ–‡ä»¶å¼•ç”¨è¾“å…¥æµ</li>
</ul>
<p>ææ¸…æ¥š Resource åï¼Œæ¥æ¢³ç†ä¸€ä¸‹ bean çš„è§£æè¿‡ç¨‹ï¼ˆ XmlBeanDefinitionReader.loadBeanDefinitions ï¼‰ï¼š  </p>
<ol>
<li><strong>å°è£…èµ„æº</strong>ï¼š<ul>
<li>ä» XmlBeanFactory ä¸­ä¼ åˆ° XmlBeanDefinitionReader ç±»ä¸­çš„æ˜¯ Resource å¯¹è±¡ï¼Œå…ˆå°è£…ä¸º EncodedResourceï¼ŒæŒ‡å®šç¼–ç </li>
</ul>
</li>
<li><strong>æ•°æ®æ£€éªŒå’Œå‡†å¤‡</strong>ï¼š<ul>
<li>ä½¿ç”¨äº†ä¸€ä¸ª ThreadLocal ä¿å­˜ EncodedResourceï¼Œå¦‚æœé‡å¤è¯»å–æŸä¸ª xml é…ç½®æ–‡ä»¶ï¼Œä¼šæŠ¥é”™</li>
<li>ä» EncodedResource è·å–è¾“å…¥æµï¼Œæ„å»ºæˆ org.xml.sax.InputSource</li>
</ul>
</li>
<li><strong>çœŸæ­£è§£æ xml</strong>ï¼š<ul>
<li>è·å–å¯¹ XML æ–‡ä»¶çš„éªŒè¯æ¨¡å¼</li>
<li>ä½¿ç”¨ DefaultDocumentLoaderåŠ è½½ XML æ–‡ä»¶ï¼Œå¾—åˆ° org.w3c.dom.Document å¯¹è±¡ã€‚</li>
<li>æ ¹æ® Document å¯¹è±¡å’Œèµ„æºæ³¨å†Œ bean  </li>
</ul>
</li>
</ol>
<p>&emsp;&emsp;é—®é¢˜æ¥äº†,çœ‹åˆ°ä¸ªä¸å¤ªæ‡‚å¾—ç©æ„ï¼Œ<strong>å¯¹ XML æ–‡ä»¶çš„éªŒè¯æ¨¡å¼</strong>ï¼Ÿçœ‹äº†ä¸‹ä»£ç ï¼Œå¦‚æœ XML æ–‡ä»¶ä¸­åŒ…å«â€œ DOCTYPE â€ï¼Œåˆ™ä½¿ç”¨ DTD è¿›è¡ŒéªŒè¯ï¼Œå¦åˆ™ä½¿ç”¨ XSDã€‚DTD å’Œ XSD æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿç®€å•äº†è§£ä¸‹ï¼š</p>
<blockquote>
<p>DTD å’Œ XSD æ˜¯å¯¹ XML æ–‡ä»¶ä¸¤ç§ä¸åŒçš„çº¦æŸæ–¹å¼ã€‚Spring åœ¨ 2.0 ç‰ˆæœ¬åå¼€å§‹å¼•å…¥ XSDï¼Œç›¸æ¯” DTDï¼ŒXSD æœ¬èº«å°±æ˜¯ XML æ–‡ä»¶ï¼Œèƒ½è¢«è§£æå’Œå¤„ç†ï¼Œå…·æœ‰æ”¯æŒåç§°ç©ºé—´ï¼Œæ‰©å±•æ€§å¼ºç­‰ä¼˜ç‚¹ï¼Œæ˜¯ DTD çš„æ›¿ä»£è€…ã€‚Spring ä¸­å¦‚æœä½¿ç”¨ DTD è¿›è¡ŒéªŒè¯ XMLï¼Œåˆ™å¿…é¡»å£°æ˜ï¼š<br><code>&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN 2.0//EN&quot;
            &quot;http://www.springframework.org/dtd/spring-beans-2.0.dtd&quot;&gt;</code></p>
</blockquote>
<p>&emsp;&emsp;å…³äºé€šè¿‡ JAXP çš„ dom æ¥å£(<em>ã€Š spring æºç æ·±åº¦è§£æã€‹é‡Œä½œè€…è¯´æ˜¯ä½¿ç”¨ SAX æ¥å£æ¥è§£æçš„ï¼Œéœ€è¦çº æ­£</em>)æ¥è§£æ XML æ–‡æ¡£ï¼Œéœ€è¦äº†è§£ä¸‹ spring å®ç°äº† ResourceEntityResolver å’Œ DelegatingEntityResolver ä¸¤ç§ EntityResolverã€‚ç®€å•äº†è§£ä¸‹ <strong>EntityResolver</strong>ï¼š </p>
<blockquote>
<p>è§£æä¸€ä¸ª XML æ—¶ï¼Œéœ€è¦æ ¹æ®å¼€å¤´çš„å£°æ˜å»ç½‘ç»œä¸‹è½½ DTD æ–‡ä»¶ï¼Œå¯¹ XML è¿›è¡Œæ ¼å¼éªŒè¯ã€‚è€Œé‡å†™ EntityResolver å°±å¯ä»¥æŒ‡å®šå»æœ¬åœ°å¯»æ‰¾ DTD æ–‡ä»¶ï¼Œé¿å…ç½‘ç»œæ“ä½œã€‚  </p>
</blockquote>
<p>&emsp;&emsp;é‡ç‚¹æ”¾åœ¨æ³¨å†Œ bean ä¸Šï¼Œç”±äº spring å¾ˆå¥½çš„è·µè¡Œäº†å•ä¸€èŒè´£è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥ç±»çš„è·³è½¬å¾ˆå¤šã€‚å…ˆæ¥åˆ° DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitionsï¼š  </p>
<ol>
<li><p><strong>å¤„ç†â€œ profile â€å±æ€§</strong>ï¼š</p>
<ul>
<li><p>å…³äº profile å±æ€§ï¼Œå®˜æ–¹ç»™å‡ºçš„ä¾‹å­å¦‚ä¸‹ï¼š  </p>
<pre><code>&lt;beans profile=&quot;dev&quot;&gt;
    &lt;jdbcï¼šembedded-database id=&quot;dataSource&quot;&gt;
        &lt;jdbcï¼šscript location=&quot;classpathï¼šcom/bank/config/sql/schema.sql&quot;/&gt;
        &lt;jdbcï¼šscript location=&quot;classpathï¼šcom/bank/config/sql/test-data.sql&quot;/&gt;
    &lt;/jdbcï¼šembedded-database&gt;
&lt;/beans&gt;

&lt;beans profile=&quot;production&quot;&gt;
    &lt;jeeï¼šjndi-lookup id=&quot;dataSource&quot; jndi-name=&quot;javaï¼šcomp/env/jdbc/datasource&quot;/&gt;
&lt;/beans&gt;    
</code></pre><p>å¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨ dev ç¯å¢ƒä¸‹çš„æ•°æ®æºï¼Œåˆ™</p>
<pre><code>AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();
ctx.getEnvironment().setActiveProfiles(&quot;dev&quot;);
ctx.register(SomeConfig.class, StandaloneDataConfig.class, JndiDataConfig.class);
ctx.refresh();
</code></pre><p>æ‰€ä»¥å¦‚æœé…ç½®äº† profile å±æ€§ï¼Œåˆ™éœ€è¦æ£€éªŒç¯å¢ƒå˜é‡ä¸­çš„ profile æ˜¯å¦åœ¨é…ç½®ä¸­å®šä¹‰äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸è¿›è¡Œä¸‹é¢çš„è§£æã€‚</p>
</li>
</ul>
</li>
<li><p><strong>å§”æ‰˜ BeanDefinitionParserDelegate è§£æ</strong>  </p>
<ul>
<li><p>æ ¸å¿ƒä»£ç ï¼š</p>
<pre><code>protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
      if (delegate.isDefaultNamespace(root)) {
          NodeList nl = root.getChildNodes();
          for (int i = 0; i &lt; nl.getLength(); i++) {
              Node node = nl.item(i);
              if (node instanceof Element) {
                  Element ele = (Element) node;
                  if (delegate.isDefaultNamespace(ele)) {
                      parseDefaultElement(ele, delegate);
                  }
                  else {
                      delegate.parseCustomElement(ele);
                  }
              }
          }
      }
      else {
          delegate.parseCustomElement(root);
      }
  }
</code></pre></li>
</ul>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ dom èŠ‚ç‚¹çš„åç§°ç©ºé—´æ˜¯ spring é»˜è®¤çš„ </p>
<blockquote>
<p>httpï¼š//www.springframework.org/schema/beans</p>
</blockquote>
<p>åˆ™ç›´æ¥æŒ‰ç…§é»˜è®¤æ ‡ç­¾è§£æã€‚å¦åˆ™ï¼Œå°±éœ€è¦æŒ‰ç…§è‡ªå®šä¹‰çš„è§£æã€‚</p>
</li>
</ol>
<p>&emsp;&emsp;å…³äº bean æš‚æ—¶å…ˆé˜…è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ä¸‹ä¸€ç¯‡æ¥å­¦ä¹ ä¸‹ Spring-beans æ¨¡å—ä¸­çš„æ³¨è§£åŠŸèƒ½ã€‚</p>
<hr>
<p>&emsp;&emsp;å¯¹äºæ€ä¹ˆå»é«˜æ•ˆçš„é˜…è¯»æºç ï¼Œæˆ‘ä»å¤„äºæ‘¸ç´¢å½“ä¸­ã€‚æ€ä¹ˆç”¨åšå®¢å»æ›´å¥½çš„è®°å½•å’Œè¡¨è¾¾æˆ‘çš„é˜…è¯»æˆæœï¼Œå¯¹æˆ‘ä¹Ÿæ˜¯ä¸ªæŒ‘æˆ˜ã€‚ç›¸ä¿¡åœ¨æ—¶é—´çš„ç§¯æ·€ä¸‹ï¼Œæˆ‘ä¼šæ‰¾åˆ°è¯»æºç çš„æ­£ç¡®å§¿åŠ¿ï¼ŒåŒæ—¶ï¼Œæˆ‘ä¹Ÿå°†æ…¢æ…¢è¿›è¡Œæ”¹è¿›ï¼Œåœ¨åšå®¢ä¸­åŠ å…¥æ—¶åºå›¾ç­‰æ›´åŠ ç›´è§‚çš„æ–¹å¼ã€‚ğŸ‘Š</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é¦–å…ˆæ„Ÿè°¢ã€Š spring æºç æ·±åº¦è§£æã€‹è¿™æœ¬ä¹¦ï¼Œå› ä¸ºçŸ¥é“å·²ç»æœ‰å‰è¾ˆæ•´ç†äº†é˜…è¯»ç»éªŒï¼Œè®©æˆ‘æ›´åŠ èƒ½å¤ŸåšæŒå°†æºç è¿›è¡Œåˆ°åº•ã€‚ä½†ä¸ºäº†è¾¾åˆ°é”»ç‚¼è‡ªå·±æœ€å¤§åŒ–ï¼Œæˆ‘è¿˜æ˜¯å†³å®šä¸ç›´æ¥å»è¯»ï¼Œå…ˆæŒ‰ç…§è‡ªå·±çš„æ€è·¯æ¥ã€‚åªæœ‰åœ¨ä¸çŸ¥é“æ€ä¹ˆç»§ç»­ä¸‹å»çš„æ—¶å€™æ‰å€Ÿé‰´ä¸€ä¸‹å‰è¾ˆçš„ç»éªŒã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Springæºç " scheme="http://xuyajun.cn/categories/Spring%E6%BA%90%E7%A0%81/"/>
    
    
  </entry>
  
  <entry>
    <title>é‚‚é€…å¿ƒå­¦</title>
    <link href="http://xuyajun.cn/2016/08/31/%E9%82%82%E9%80%85%E5%BF%83%E5%AD%A6/"/>
    <id>http://xuyajun.cn/2016/08/31/é‚‚é€…å¿ƒå­¦/</id>
    <published>2016-08-31T11:23:12.000Z</published>
    <updated>2016-09-30T13:45:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>&emsp;&emsp;ä»æ¥æ²¡æœ‰æƒ³è¿‡è‡ªå·±ä¼šæœ‰è¿™ä¹ˆå–œæ¬¢å“²å­¦çš„ä¸€å¤©ï¼Œè€Œå¼€å¯æˆ‘çš„å“²å­¦å­¦ä¹ ä¹‹æ—…çš„æ˜¯è¯¾æœ¬ä¸­æ›¾ä¸€å¸¦è€Œè¿‡çš„é˜³æ˜å¿ƒå­¦ã€‚<br>&emsp;&emsp;è®°ä¸æ¸…å…·ä½“å“ªå¤©åˆé‡æ–°è®¤è¯†äº†å¿ƒå­¦ã€‚å»å¹´çš„å®ä¹ æ—¶æœŸï¼Œ15å¹´çš„10æœˆä»½å·¦å³ã€‚å½“æ—¶æˆ‘åœ¨æ­å·ç½‘æ˜“å®ä¹ ï¼Œç§Ÿç€ä¸€é—´ç‹¬å«å•é—´ï¼Œ12å¹³ç±³ï¼Œå’Œå¥³å‹å¼‚åœ°ã€‚é‚£æ®µæ—¶é—´å­¦ä¹ æ¬²æœ›å¾ˆå¼ºï¼Œæ¿€æƒ…å¾ˆé«˜ã€‚é™¤äº†åƒå¾€å¸¸ä¸€æ ·çš„é’»ç ”æŠ€æœ¯ï¼Œä¹Ÿä¼šå¼ºè¿«è‡ªå·±å»å¥èº«æˆ¿å¥èº«ã€‚å¯èƒ½æ˜¯å› ä¸ºä»é«˜ä¸­å¼€å§‹å°±æ²¡æœ‰è¯»è¿‡æ–‡å­¦ä¹¦ï¼Œçœ‹åˆ°åŠå…¬å®¤å¤–çš„ä¹¦æ¶ä¸Šæ‘†ç€ä¸–ç•Œåè‘—ï¼Œæˆ‘å¾ˆæ¬£å–œçš„æŒ‘äº†å‡ æœ¬å›å»çœ‹ã€‚<a id="more"></a>åˆ°11æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘çœ‹å®Œäº†&lt;&lt;å‚²æ…¢ä¸åè§&gt;&gt;å’Œ&lt;&lt;åŸºç£å±±ä¼¯çˆµ&gt;&gt;ä¸¤æœ¬ä¹¦ï¼Œå¯¹&lt;&lt;åŸºç£å±±ä¼¯çˆµ&gt;&gt;å°¤ä¸ºçˆ±ä¸é‡Šæ‰‹ï¼Œâ€œç­‰å¾…ä¸å¸Œæœ›â€äº”ä¸ªå­—è®©æˆ‘æ„Ÿè§¦é¢‡æ·±ã€‚<br>&emsp;&emsp;ä½†æ˜¯ï¼Œæ€»æ„Ÿè§‰å†…å¿ƒå°‘äº†ä»€ä¹ˆï¼Œä¾æ—§æµ®èºï¼Œä¼šå‘¨æœŸæ€§çš„å’Œå¥³å‹å‘è„¾æ°”ã€‚æ–‡å­¦çš„ç†é™¶èƒ½è®©æˆ‘å¿ƒå®å¹³é™å‡ å¤©ï¼Œä½†å¾ˆå¿«å°±æ•£äº†ï¼Œéš¾é“éœ€è¦ä¸€ç›´ç”¨æ–‡å­¦ä½œå“çš„åŠ›é‡æ¥ç»´æŒï¼Ÿå¯æ˜¯ï¼Œåˆå“ªæ¥è¿™ä¹ˆå¤šåƒ&lt;&lt;åŸºç£å±±ä¼¯çˆµ&gt;&gt;è¿™æ ·ä¼˜ç§€çš„ä½œå“å‘¢ã€‚<br>&emsp;&emsp;æˆ‘å¼€å§‹æ˜ç™½ï¼Œæˆ‘æ­¤æ—¶ç¼ºå°‘çš„æ˜¯ä¿¡ä»°ã€‚å¿ƒå­¦å°±è¿™æ ·åœ¨æˆ‘éœ€è¦ä¿¡ä»°çš„æ—¶å€™èµ°è¿›äº†æˆ‘çš„ç”Ÿæ´»ã€‚å¾ˆå¿«ï¼Œä¸æ»¡è¶³äºçœ‹ç²—ç•¥ä»‹ç»é˜³æ˜å…ˆç”Ÿå’Œå¿ƒå­¦çš„æˆ‘å¼€å§‹æŠ±ç€å¥½å¥‡ç›´æ¥é˜…è¯»å¿ƒå­¦è‘—ä½œ&lt;&lt;ä¼ ä¹ å½•&gt;&gt;ã€‚ä¸€å¼€å§‹ï¼Œçœ‹ç€é€šç¯‡çš„æ–‡è¨€æ–‡ï¼Œäº§ç”Ÿè¿‡é€€ç¼©å¿µå¤´ï¼Œæƒ³ç›´æ¥è¯»ç™½è¯ç‰ˆçš„ã€‚ä½†æ˜¯ï¼Œä¸€æƒ³åˆ°åªæœ‰çœ‹åŸè‘—ï¼Œæ‰èƒ½ç†è§£å…¶åŸæ±åŸå‘³çš„æ€æƒ³å’Œå“²å­¦ï¼Œæˆ‘åšæŒäº†ä¸‹æ¥ã€‚è¿˜å¥½ï¼Œä¸æ˜¯æƒ³è±¡ä¸­çš„é‚£ä¹ˆæ™¦æ¶©éš¾æ‡‚ã€‚åˆšå¥½ä¸´è¿‘åŒ11ï¼Œåœ¨åŒ11é‚£å¤©ï¼Œæˆ‘åœ¨æ·˜å®ä¸Šä¹°äº†æœ¬&lt;&lt;ç‹é˜³æ˜æœ€ç¥å¥‡çš„å¿ƒå­¦&gt;&gt;ã€‚æ­¤æ—¶ï¼Œå¯¹å¿ƒå­¦å¹¶ä¸ç®—çƒ­å¿±ï¼Œåªæ˜¯äº†è§£é˜¶æ®µã€‚<br>&emsp;&emsp;åˆ°äº†11æœˆä¸­æ—¬ï¼Œå®ä¹ ç¦»èŒå›åˆ°äº†å­¦æ ¡ã€‚è½¬æ­£æ²¡æœ‰æˆåŠŸï¼Œè®©æˆ‘å¾ˆæ˜¯å—æ‰“å‡»å’Œéƒé—·ã€‚ä¸€ç›´è‡ªä¿¡çš„æˆ‘åªèƒ½æ„Ÿå¹è‡ªå·±è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯ç¤¾ä¼šç»éªŒã€‚å›åˆ°å­¦æ ¡ï¼Œæœ¬ä»¥ä¸ºå’Œå¥³å‹é‡é€¢èƒ½è®©æˆ‘ç¨å¾®ç¼“è§£ä¸€ä¸‹éƒé—·ã€‚ä½†æ²¡æƒ³åˆ°å¾ˆå¿«å°±åˆ†æ‰‹äº†ï¼ˆè¿‡ç¨‹ç•¥è¿‡zzzï¼‰ï¼Œæ­¤æ—¶çš„æˆ‘ï¼Œæ„Ÿè§‰åˆ°äº†è¿™ä¹ˆå¤šå¹´æœ€å¤§çš„æŒ«è´¥æ„Ÿã€‚å¤±ä¸šå¤±æ‹ï¼Œèº«è¾¹çš„æœ‹å‹éƒ½è¿˜åœ¨å¤–é¢å®ä¹ ï¼Œæˆ‘ä¸€ä¸ªäººéƒé—·åˆ°äº†æç‚¹ã€‚æ¯å¤©åœ¨å®¿èˆæ— æ³•å®£æ³„ï¼Œå†…å¿ƒç—›è‹¦ï¼Œæ·±å¤œæ›´æ˜¯æ— æ³•å…¥çœ ã€‚<br>&emsp;&emsp;ç»ˆäºï¼Œæˆ‘æƒ³èµ·äº†æ•°æ—¥æ²¡æœ‰å­¦ä¹ äº†çš„å¿ƒå­¦ã€‚å¼€å§‹æ¸´æœ›ä»ä¸­å¯»æ±‚äººç”Ÿå¹¸ç¦çœŸç†çš„æˆ‘æ¯”ä¹‹å‰æ›´åŠ è®¤çœŸçš„å­¦ä¹ &lt;&lt;ä¼ ä¹ å½•&gt;&gt;ï¼Œæ¯å¤©æ™šä¸Šä¹Ÿåªæœ‰å¬ç€å–œé©¬æ‹‰é›…çš„â€çŸ¥è¡Œåˆä¸€ç‹é˜³æ˜â€œæ‰èƒ½å…¥ç¡ã€‚æ…¢æ…¢çš„ï¼Œå†…å¿ƒå¼€å§‹å˜å¾—å¹³é™ï¼Œæƒ³åˆ°é˜³æ˜å…ˆç”Ÿåœ¨é¾™åœºé‚£ä¹ˆæ¶åŠ£çš„ç¯å¢ƒï¼Œå®ç°äº†çªç ´ï¼Œç•™ä¸‹äº†é¾™åœºæ‚Ÿé“çš„ä½³è¯ï¼Œè¶Šå‘è§‰å¾—è‡ªå·±ç›®å‰çš„å›°å¢ƒæ ¹æœ¬ä¸å€¼ä¸€æã€‚ç»å¸¸æœ‰äººè¯´ï¼Œæˆ‘ä»¬çŸ¥é“é‚£ä¹ˆå¤šé“ç†ï¼Œä¸ºä»€ä¹ˆè¿˜ä¸èƒ½æ´»çš„å¥½ã€‚ä½†ä½ çœŸçš„æ‡‚å¾—é‚£äº›é“ç†å—ï¼Œåªèƒ½ç®—æ˜¯å¬è¿‡å§ã€‚çŸ¥è¡Œåˆä¸€ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ¶ˆæä¸èƒ½è§£å†³é—®é¢˜ï¼Œè¦ç§¯æå‘ä¸Šï¼Œå¯æ˜¯å½“æˆ‘ä»¬é‡åˆ°äº‹æƒ…çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä»»ç”±è‡ªå·±æ¶ˆæï¼Œè¿™ç®—æ˜¯çŸ¥é“è¿™ä¸ªé“ç†å—ï¼Ÿä¸èƒ½å»åšçš„é“ç†éƒ½ä¸èƒ½ç®—æ˜¯çŸ¥ã€‚<br>&emsp;&emsp;æ—¶å…‰èè‹’ï¼Œå·²ç»æ˜¯16å¹´çš„ä¹æœˆä»½äº†ï¼Œè¿™å¤§åŠå¹´æ¥ï¼Œè™½æ²¡æœ‰å‚æ‚Ÿå®Œå…¨å¿ƒå­¦ï¼Œä½†æ˜¯ï¼Œå·²ç»è¶³å¤Ÿè®©æˆ‘å†…å¿ƒå¹³é™ã€‚æ‰¾åˆ°ä»½æ»¡æ„çš„å·¥ä½œï¼ŒæŠŠå¥³å‹è¿½å›ï¼Œçˆ±ä¸Šäº†å“²å­¦ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;emsp;&amp;emsp;ä»æ¥æ²¡æœ‰æƒ³è¿‡è‡ªå·±ä¼šæœ‰è¿™ä¹ˆå–œæ¬¢å“²å­¦çš„ä¸€å¤©ï¼Œè€Œå¼€å¯æˆ‘çš„å“²å­¦å­¦ä¹ ä¹‹æ—…çš„æ˜¯è¯¾æœ¬ä¸­æ›¾ä¸€å¸¦è€Œè¿‡çš„é˜³æ˜å¿ƒå­¦ã€‚&lt;br&gt;&amp;emsp;&amp;emsp;è®°ä¸æ¸…å…·ä½“å“ªå¤©åˆé‡æ–°è®¤è¯†äº†å¿ƒå­¦ã€‚å»å¹´çš„å®ä¹ æ—¶æœŸï¼Œ15å¹´çš„10æœˆä»½å·¦å³ã€‚å½“æ—¶æˆ‘åœ¨æ­å·ç½‘æ˜“å®ä¹ ï¼Œç§Ÿç€ä¸€é—´ç‹¬å«å•é—´ï¼Œ12å¹³ç±³ï¼Œå’Œå¥³å‹å¼‚åœ°ã€‚é‚£æ®µæ—¶é—´å­¦ä¹ æ¬²æœ›å¾ˆå¼ºï¼Œæ¿€æƒ…å¾ˆé«˜ã€‚é™¤äº†åƒå¾€å¸¸ä¸€æ ·çš„é’»ç ”æŠ€æœ¯ï¼Œä¹Ÿä¼šå¼ºè¿«è‡ªå·±å»å¥èº«æˆ¿å¥èº«ã€‚å¯èƒ½æ˜¯å› ä¸ºä»é«˜ä¸­å¼€å§‹å°±æ²¡æœ‰è¯»è¿‡æ–‡å­¦ä¹¦ï¼Œçœ‹åˆ°åŠå…¬å®¤å¤–çš„ä¹¦æ¶ä¸Šæ‘†ç€ä¸–ç•Œåè‘—ï¼Œæˆ‘å¾ˆæ¬£å–œçš„æŒ‘äº†å‡ æœ¬å›å»çœ‹ã€‚
    
    </summary>
    
      <category term="å“²å­¦" scheme="http://xuyajun.cn/categories/%E5%93%B2%E5%AD%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>å…³äºå†™åšå®¢çš„å¿ƒè·¯å†ç¨‹</title>
    <link href="http://xuyajun.cn/2016/08/28/%E5%85%B3%E4%BA%8E%E5%86%99%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    <id>http://xuyajun.cn/2016/08/28/å…³äºå†™åšå®¢çš„å¿ƒè·¯å†ç¨‹/</id>
    <published>2016-08-28T14:23:12.000Z</published>
    <updated>2016-09-29T13:21:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾"><a href="#å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾" class="headerlink" title="å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾"></a>å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾</h2><p>&emsp;&emsp;è®¸ä¹…æ²¡å†™å­—ï¼Œå½“æ‰‹æ”¾åœ¨é”®ç›˜ä¸Šï¼Œä¸æ˜¯ä¸ºäº†æ•²ä»£ç ï¼ŒèŠå¤©ï¼Œè€Œæ˜¯ä¸ºäº†å†™æ–‡ç« ï¼Œå´å‘ç°ç å­—é€Ÿç‡éª¤é™ï¼Œå‡ åˆ†é’Ÿæ†‹ä¸å‡ºä¸€å¥è¯ã€‚å°±æ‹¿è¿™ç¯‡åšå®¢é¢˜ç›®æ¥è¯´ï¼Œæˆ‘æƒ³æ‰¯ä¸‹è‡ªå·±å†™åšå®¢çš„æ€æƒ³æ–—äº‰ï¼Œäºæ˜¯å¾ˆè‡ªç„¶çš„å†™ä¸Šâ€œå…³äºå†™åšå®¢çš„å¿ƒå†è·¯ç¨‹â€è¿™ä¸ªé¢˜ç›®ï¼Œä½†æ˜¯å†™å®Œä¹‹åæ€»æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œå¿ƒå†è·¯ç¨‹ï¼Ÿæ˜¯è¿™ä¸ªè¯è¯­å—ï¼Ÿäºæ˜¯åˆå¾ˆè‡ªç„¶çš„æœç´¢äº†ä¸€æŠŠï¼Œæœç„¶ï¼Œåº”è¯¥æ˜¯â€œå¿ƒè·¯å†ç¨‹â€ã€‚ğŸ˜“</p>
<h2 id="ä¸ºå˜›å†™åšå®¢"><a href="#ä¸ºå˜›å†™åšå®¢" class="headerlink" title="ä¸ºå˜›å†™åšå®¢"></a>ä¸ºå˜›å†™åšå®¢</h2><a id="more"></a>
<h3 id="æ–‡ç¬”"><a href="#æ–‡ç¬”" class="headerlink" title="æ–‡ç¬”"></a>æ–‡ç¬”</h3><p>&emsp;&emsp;è™½ç„¶çˆ±çœ‹ä¹¦å’Œæ–‡ç¬”å¥½æ²¡æœ‰ä¹Ÿä¸éœ€è¦æœ‰å¿…ç„¶çš„å…³ç³»ï¼Œä½†æ˜¯å½“ä½ çœ‹åˆ°æ–‡å­—çš„åŠ›é‡åï¼Œä½ ä¸æƒ³æŒæ¡è¿™ç§åŠ›é‡å—ï¼Ÿ</p>
<h3 id="å›å¿†"><a href="#å›å¿†" class="headerlink" title="å›å¿†"></a>å›å¿†</h3><p>&emsp;&emsp;ä½ è¯´ä½ çƒ­çˆ±æŠ€æœ¯ï¼Œå–œæ¬¢çœ‹å“²å­¦å®¶åµæ¶ï¼Œä½†æ˜¯å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ã€‚ä½ è¿ä¸ºå®ƒæ•²æ•²é”®ç›˜éƒ½ä¸æ„¿æ„ï¼Œå‡­ä»€ä¹ˆè¯´çˆ±å®ƒï¼Ÿæ‰€ä»¥ï¼Œå¹´è½»äººï¼Œç•™ä¸‹ç‚¹ä»¥åèƒ½è®©è‡ªå·±å’Œä»–äººå›å¿†çš„ä¸œè¥¿å§ã€‚</p>
<h3 id="æ‰“èµ"><a href="#æ‰“èµ" class="headerlink" title="æ‰“èµ"></a>æ‰“èµ</h3><p>&emsp;&emsp;ä¸Šé¢éƒ½æ˜¯è‡ªå·±æ‰¾çš„ç²¾ç¥å±‚é¢çš„å¿½æ‚ ç†ç”±ï¼Œä½†æ˜¯æ„Ÿè§‰ä»å°‘äº†ä»€ä¹ˆã€‚æˆ‘è™½æ¨å´‡å½“ä»£äººå»è¿½æ±‚ç²¾ç¥å»ºè®¾ï¼Œä½†æ˜¯é‚£æ˜¯å› ä¸ºå½“ä»£äººå·²ç»è¿‡å¤šçš„è¿½æ±‚ç‰©è´¨äº†ã€‚æ‰€ä»¥ï¼Œç‰©è´¨ä¹Ÿæ˜¯å¿…ä¸å¯å°‘ã€‚ä¸ºäº†è¿›ä¸€æ­¥å¿½æ‚ è‡ªå·±ï¼Œç»™åšå®¢å¼€é€šäº†æ‰“èµåŠŸèƒ½ï¼Œå¼ºè¡Œé¼“åŠ±è‡ªå·±â€œåªè¦åšå®¢å†™å¾—å¥½ï¼Œå°±ä¼šæˆä¸ºSlashé’å¹´â€ã€‚</p>
<h2 id="åšå®¢è§„åˆ’"><a href="#åšå®¢è§„åˆ’" class="headerlink" title="åšå®¢è§„åˆ’"></a>åšå®¢è§„åˆ’</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>&emsp;&emsp;æŠ€æœ¯æ¯•ç«Ÿæ˜¯è€æœ¬è¡Œï¼Œå¾ˆåº†å¹¸è‡ªå·±èƒ½ä»äº‹è‡ªå·±æœ€æ„Ÿå…´è¶£çš„èŒä¸šã€‚ä¸ºäº†è®©è‡ªå·±æ—¶åˆ»ä¿æŒç«äº‰åŠ›ï¼Œå°†å¯¹å½“ä¸‹æœ€ç«çš„å¼€æºé¡¹ç›®è¿›è¡Œæºç åˆ†æï¼Œå­¦ä¹ å…¶è®¾è®¡æ€æƒ³å’Œç¼–ç é£æ ¼ã€‚æä¸Šåˆ†ææ—¥ç¨‹çš„é¡¹ç›®æ˜¯ï¼šspringï¼Œtomcatï¼Œkafkaï¼Œdiamondã€‚ä¹‹å‰å·²ç»æˆ–å¤šæˆ–å°‘çš„çœ‹è¿‡å…¶æºç ï¼Œä½†æ²¡æœ‰ä»ç³»ç»Ÿæ¶æ„å±‚é¢ä¸Šå»æ¬£èµã€‚å¸Œæœ›è‡ªå·±èƒ½åšæŒï¼Œè«æ±‚å†™å‡ºæœ€æœ‰æ·±åº¦çš„æºç åˆ†æï¼Œä½†è¡Œçˆ±å¥½ä¹‹äº‹ã€‚</p>
<h3 id="å“²å­¦"><a href="#å“²å­¦" class="headerlink" title="å“²å­¦"></a>å“²å­¦</h3><p>&emsp;&emsp;å“²å­¦å®¶å¤§å¤šéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯é’±å¤šï¼Œä¸å¿…ä¸ºç”Ÿè®¡çƒ¦æ¼ï¼Œé—²çš„è›‹ç–¼ï¼Œå¦ä¸€ä¸ªæ˜¯æ™ºå•†é«˜ï¼Œæ€è€ƒæ™®é€šçš„é—®é¢˜æ²¡æ³•æ»¡è¶³è‡ªå·±ï¼Œå°±æ•´å¤©æŠ˜è…¾é‚£äº›å½¢è€Œä¸Šå­¦çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œæˆ‘ä¸€ä¸ªæ¡ä»¶éƒ½æ²¾ä¸ä¸Šè¾¹ï¼Œä½†å¹¶ä¸å¦¨ç¢æˆ‘çœ‹çƒ­é—¹å•Šï¼Œå“²å­¦å®¶ä¹‹é—´çš„å”‡æªèˆŒå‰‘è¿˜æ˜¯æŒºæœ‰æ„æ€ã€‚è™½ç„¶çœ‹èµ·æ¥å¯¹å·¥ä½œï¼Œå¯¹ç‰©è´¨æå‡æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œä½†æ˜¯ä½ æ•¢è¯´è‡ªå·±æ²¡æœ‰åœ¨å¤œæ™šæˆ–æ˜¯çœ‹ç€æ˜Ÿç©ºï¼Œæˆ–æ˜¯åœ¨é»‘æš—ä¸­é—®è‡ªå·±â€œäººæ´»ç€æ˜¯ä¸ºäº†ä»€ä¹ˆâ€è¿™ç§é—®é¢˜ï¼Ÿæˆ‘ä¸æå€¡ä¹Ÿä¸å¸Œæœ›è‡ªå·±è¿‡åº¦è¿·æ‹æŸç§ä¿¡ä»°ï¼Œå˜æˆæŸä¸ªå®—æ•™çš„ä¿¡å¾’ï¼Œä½†æ˜¯å¦‚æœé€‰æ‹©æŸç§å“²å­¦æ€æƒ³ï¼Œèµ‹äºˆæ—¶ä»£æ„ä¹‰ï¼Œä½œä¸ºè‡ªå·±çš„äººç”Ÿå“²å­¦ï¼Œæ‰¾åˆ°è‡ªå·±çš„äººç”Ÿæ„ä¹‰ï¼Œé‚£å¿…ç„¶æ˜¯å—ç›Šç»ˆç”Ÿã€‚</p>
<h3 id="è¯»ä¹¦ç¬”è®°"><a href="#è¯»ä¹¦ç¬”è®°" class="headerlink" title="è¯»ä¹¦ç¬”è®°"></a>è¯»ä¹¦ç¬”è®°</h3><p>&emsp;&emsp;å¾ˆåº†å¹¸æ»¨æ±Ÿå›¾ä¹¦é¦†å°±åœ¨èº«è¾¹ï¼ŒæŠ€æœ¯ï¼Œå“²å­¦ï¼Œç»æµï¼Œå›½å­¦ç­‰åº”æœ‰å°½æœ‰ã€‚æ¯ä¸ªå‘¨æœ«æ€»ä¼šæŠ½ä¸€å¤©æ¥è¿™é‡Œåº¦è¿‡ï¼Œå¿˜å´ç¹åï¼Œå“å‘³ä¹¦é¦™ã€‚è¯»æŠ€æœ¯ä¹¦ï¼Œæå‡ä¸“ä¸šæŠ€èƒ½ï¼›è¯»å“²å­¦ï¼Œå¥å…¨äººç”Ÿä»·å€¼è§‚ï¼›è¯»ç»æµå­¦ï¼Œæ´å¯Ÿæ—¶ä¸‹ç¤¾ä¼šï¼›è¯»å›½å­¦ï¼Œä¼ æ‰¿äº”åƒå¹´æ–‡åŒ–ã€‚è¯»è¿‡çš„æ¯æœ¬ä¹¦å¯èƒ½æ— æ³•å†™å‡ºæ·±åˆ»ä½“ä¼šæˆ–åŠ ä»¥æ‹“å±•ï¼Œä½†éšç€ä¸æ–­å€ŸåŠ©å·¨äººçš„è‚©è†€ï¼Œå¿…ç„¶èƒ½çœ‹åˆ°é«˜å¤„ä¸åŒçš„é£æ™¯å¹¶ç•™ä¸‹è‡ªå·±çš„è„šå°ã€‚</p>
<h3 id="æ‰¯æ·¡"><a href="#æ‰¯æ·¡" class="headerlink" title="æ‰¯æ·¡"></a>æ‰¯æ·¡</h3><p>&emsp;&emsp;æˆ‘ä¸æƒ³æŠŠè¿™ä¸ªå°ç«™å®šä½æˆæŠ€æœ¯åšå®¢ç«™ï¼Œæˆ‘å¸Œæœ›æŠŠå®ƒæ‰“ç†æˆåƒè‡ªå·±çš„å†…å¿ƒä¸–ç•Œä¸€æ ·ä¸°å¯Œå¤šå½©ã€‚è¿™ä¹Ÿæ˜¯æˆ‘åšæŒå†™å­—çš„æœ€å¤§åŠ¨åŠ›ã€‚äººæ˜¯æœ€é­”æ€§çš„åŠ¨ç‰©ï¼Œä¸€æƒ³åˆ°æ¯ä¸ªäººéƒ½æœ‰å…¶è‡ªå·±çš„æ•…äº‹å’Œç‹¬ç‰¹æ€æƒ³ï¼Œå°±è§‰å¾—å¾ˆæœ‰è¶£ä¸æ˜¯å—ã€‚æ€»ä¹‹ï¼Œæ— è®ºæ˜¯åæ§½ï¼Œè¿˜æ˜¯ä¸€æ—¶å…´èµ·ï¼Œåªè¦æœ‰æ„ä¹‰ï¼Œæˆ‘éƒ½ä¼šå†™ä¸‹æ¥ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾&quot;&gt;&lt;a href=&quot;#å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾&quot; class=&quot;headerlink&quot; title=&quot;å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾&quot;&gt;&lt;/a&gt;å–ä¸ªé¢˜ç›®éƒ½å¥½éš¾&lt;/h2&gt;&lt;p&gt;&amp;emsp;&amp;emsp;è®¸ä¹…æ²¡å†™å­—ï¼Œå½“æ‰‹æ”¾åœ¨é”®ç›˜ä¸Šï¼Œä¸æ˜¯ä¸ºäº†æ•²ä»£ç ï¼ŒèŠå¤©ï¼Œè€Œæ˜¯ä¸ºäº†å†™æ–‡ç« ï¼Œå´å‘ç°ç å­—é€Ÿç‡éª¤é™ï¼Œå‡ åˆ†é’Ÿæ†‹ä¸å‡ºä¸€å¥è¯ã€‚å°±æ‹¿è¿™ç¯‡åšå®¢é¢˜ç›®æ¥è¯´ï¼Œæˆ‘æƒ³æ‰¯ä¸‹è‡ªå·±å†™åšå®¢çš„æ€æƒ³æ–—äº‰ï¼Œäºæ˜¯å¾ˆè‡ªç„¶çš„å†™ä¸Šâ€œå…³äºå†™åšå®¢çš„å¿ƒå†è·¯ç¨‹â€è¿™ä¸ªé¢˜ç›®ï¼Œä½†æ˜¯å†™å®Œä¹‹åæ€»æ„Ÿè§‰æ€ªæ€ªçš„ï¼Œå¿ƒå†è·¯ç¨‹ï¼Ÿæ˜¯è¿™ä¸ªè¯è¯­å—ï¼Ÿäºæ˜¯åˆå¾ˆè‡ªç„¶çš„æœç´¢äº†ä¸€æŠŠï¼Œæœç„¶ï¼Œåº”è¯¥æ˜¯â€œå¿ƒè·¯å†ç¨‹â€ã€‚ğŸ˜“&lt;/p&gt;
&lt;h2 id=&quot;ä¸ºå˜›å†™åšå®¢&quot;&gt;&lt;a href=&quot;#ä¸ºå˜›å†™åšå®¢&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºå˜›å†™åšå®¢&quot;&gt;&lt;/a&gt;ä¸ºå˜›å†™åšå®¢&lt;/h2&gt;
    
    </summary>
    
      <category term="æ‰¯æ·¡" scheme="http://xuyajun.cn/categories/%E6%89%AF%E6%B7%A1/"/>
    
    
  </entry>
  
</feed>
